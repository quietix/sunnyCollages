class TColorPicker{constructor(t,e){if(e="[object Object]"===Object.prototype.toString.call(e)?e:{},!(t instanceof Element||e.inputReplacement instanceof Element))throw new TypeError("TColorPicker input is not an Element");this._config={letterCase:["lowercase","uppercase"].includes(e.letterCase)?e.letterCase:"uppercase",format:["hex","rgb","hsl"].includes(e.format)?e.format:"hex",isOpacityEnabled:!!e.isOpacityEnabled,isGradientsEnabled:!!e.isGradientsEnabled,position:["bottom-left","top-left","right-top","left-top","bottom-right"].includes(e.position)?e.position:"bottom-left",swatchesKey:e.swatchesKey||null,theme:["light","dark"].includes(e.theme)?e.theme:"light",panelZIndex:isNaN(e.panelZIndex)?99999:e.panelZIndex,emptyColorKeywords:Array.isArray(e.emptyColorKeywords)?e.emptyColorKeywords:[],noDocumentColors:!!e.noDocumentColors,swatchSize:!isNaN(e.swatchSize)&&0<=e.swatchSize?e.swatchSize:35,swatchGap:!isNaN(e.swatchGap)&&0<=e.swatchGap?e.swatchGap:15,panelGap:!isNaN(e.panelGap)&&0<=e.panelGap?e.panelGap:-3,lang:["RU","EN"].includes(e.lang)?e.lang:["RU","EN"].includes(window.lang)?window.lang:"EN",inputReplacement:e.inputReplacement instanceof Element?e.inputReplacement:null,disablePanelToggleOnInputReplacementClick:!!e.disablePanelToggleOnInputReplacementClick,colorChangeDelay:!isNaN(e.colorChangeDelay)&&0<=e.colorChangeDelay?e.colorChangeDelay:50,isGradientOpacityOnly:!!e.isGradientOpacityOnly,bottomGap:!isNaN(e.bottomGap)&&0<=e.bottomGap?e.bottomGap:0,isTextContrastCheckEnabled:!!e.isTextContrastCheckEnabled},this._classNames={container:"tcolors",containerThemeDark:"tcolors_dark",input:"tcolors__input",swatch:"tcolors__swatch",panel:"tcolors-panel",gradientPlaceholder:"tcolors__gradient-placeholder"},this._input=t||null,this._container=null,this._swatch=null,this._currentColor=null,this._currentOpacity=1,this._currentGradient=null,this._panel=null,this._eventColor=null,this._handleDocClick=this._handleDocClick.bind(this),this._handleInputKeyUp=this._handleInputKeyUp.bind(this),this._handleInputBlur=this._handleInputBlur.bind(this),this._handleInputPaste=this._handleInputPaste.bind(this),this._handleInput=this._handleInput.bind(this),this._handleDocKeyDown=this._handleDocKeyDown.bind(this),this._handleSwatchClick=this._handleSwatchClick.bind(this),this._dispatchColorChangeEvent=TColorPanel.throttle(this._dispatchColorChangeEvent.bind(this),this._config.colorChangeDelay),this._handleInputReplacementClick=this._handleInputReplacementClick.bind(this)}static parseColor(e){if(!e)return[0,0,0];e=String(e).toLowerCase();t=e,(s=TColorPicker.getColorByWord(t))&&(e=t=s);var t,s=t.startsWith("rgba")?"rgba":t.startsWith("rgb")?"rgb":t.startsWith("hsl")?"hsl":"hex";if("rgb"==s){let t=e.replace(/[^0-9,.]/g,"").split(",");return t.splice(3,t.length),t.length?(1===(t=t.map(t=>{t=parseFloat(t)||0;return 255<t?255:t})).length&&t.push(0,0),2===t.length&&t.push(0),TColorPicker.rgbToHSL(t)):[0,0,0]}if("rgba"==s){let t=e.replace(/[^0-9,.]/g,"").split(",");return t.splice(4,t.length),t.length?(1===t.length&&t.push(0,0,1),2===t.length&&t.push(0,1),3===t.length&&t.push(1),t=t.map((t,e)=>{return 3===e?(e=parseFloat(t),1<(e=isNaN(e)?1:e)?1:e<0?0:e):255<(e=parseInt(t,10)||0)?255:e<0?0:e}),[...TColorPicker.rgbToHSL([t[0],t[1],t[2]]),t[3]]):[0,0,0,1]}if("hsl"==s){let t=e.replace(/[^0-9,.]/g,"").split(",");return t.splice(3,t.length),t.length?(1===(t=t.map((t,e)=>{t=parseFloat(t)||0;return e?100<t?1:t/100:360<t?1:t/360})).length&&t.push(0,0),2===t.length&&t.push(0),t):[0,0,0]}if("hex"!=s)return[0,0,0];{let t=e.replace(/[^0-9a-fA-F]/g,"").substring(0,6).toLowerCase();return t.length?6===t.length?TColorPicker.hexToHSL(t):(t=3<t.length?t.substring(0,3):t).length<3?(t=t.padEnd(6,t),TColorPicker.hexToHSL(t)):TColorPicker.hexToHSL(t[0]+t[0]+t[1]+t[1]+t[2]+t[2]):TColorPicker.hexToHSL("000000")}}static parseGradient(s){if(!s)return!1;s=String(s).toLowerCase().replace(/\s{2,}/g,"").replace(/^\s/,"").replace(/\s$/,"");if(s.startsWith("linear-gradient")){var i=s;if(!(i=i.match(/^linear-gradient\((.+)\)$/)))return!1;if(!(i=i[1]))return!1;if((i=i.split(/,(?![^(]*\))/)).length<2)return!1;let t=i[0],n;var a=t.includes("deg")||t.includes("turn")||t.includes("rad");n=a?(a=t.includes("deg")?"deg":t.includes("turn")?"turn":"rad",t=t.replace(/\s/g,"").replace(/[a-z]/g,""),t=parseFloat(t),t=isNaN(t)?0:t,"deg"==a&&(t/=360),"rad"==a&&(t/=2*Math.PI),t=0<=t&&t<=1?t:1,i.splice(1)):(t=0,i);let e=!1;return n.splice(15),n=n.map((s,i)=>{s=(s=s.replace(/^\s/,"").replace(/\s$/,"")).split(/\s(?![^(]*\))/);if(!(2<s.length)){var a=TColorPicker.parseColor(s[0]);let t=1;4===a.length&&(t=a[3],a.splice(3));let e;return s[1]?(e=s[1].replace(/[^0-9.]/g,""),e=parseFloat(e),e=!isNaN(e)&&0<=e&&e<=100?e:0,e/=100):e=i/(n.length-1),{color:a,position:e,opacity:t}}e=!0}),!e&&{type:"linear",stops:n,angle:t}}return!!s.startsWith("radial-gradient")&&(t=>{t=t.match(/^radial-gradient\((.+)\)$/)[1];if(!t)return!1;t=t.split(/,(?![^(]*\))/);if(t.length<2)return!1;let n,e=(n=t[0].includes("circle")||t[0].includes("ellipse")||t[0].includes("side")||t[0].includes("corner")?t.splice(1):t,!1);return n.splice(15),n=n.map((s,i)=>{s=(s=s.replace(/^\s/,"").replace(/\s$/,"")).split(/\s(?![^(]*\))/);if(!(2<s.length)){var a=TColorPicker.parseColor(s[0]);let t=1;4===a.length&&(t=a[3],a.splice(3));let e;return s[1]?(e=s[1].replace(/[^0-9.]/g,""),e=parseFloat(e),e=!isNaN(e)&&0<=e&&e<=100?e:0,e/=100):e=i/(n.length-1),{color:a,position:e,opacity:t}}e=!0}),!e&&{type:"radial",stops:n,angle:0}})(s)}static hexToRGB(t){return t=t.replace(/#/g,""),[parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16)]}static hexToHSL(t){return TColorPicker.rgbToHSL(TColorPicker.hexToRGB(t))}static hslToRGB(t){var[t,e,s]=t,e=(t*=360,(1-Math.abs(2*s-1))*e),t=t/60,i=e*(1-Math.abs(t%2-1));let a;var s=s-e/2,[t,e,i]=a=0<=t&&t<1?[e,i,0]:1<=t&&t<2?[i,e,0]:2<=t&&t<3?[0,e,i]:3<=t&&t<4?[0,i,e]:4<=t&&t<5?[i,0,e]:[e,0,i],[t,e,i]=[t+s,e+s,i+s];return[Math.round(255*t),Math.round(255*e),Math.round(255*i)]}static hslToRGBA(t){var e=TColorPicker.hslToRGB(t),t=!isNaN(t[3])&&0<=t[3]&&t[3]<=1?t[3]:1;return[...e,t]}static rgbToHEX(t){return t.map(t=>{t=Number(t).toString(16);return 1===t.length?"0"+t:t}).join("")}static hslToHEX(t){return TColorPicker.rgbToHEX(TColorPicker.hslToRGB(t))}static rgbToHSL(t){var[t,e,s]=t,i=(t/=255,e/=255,s/=255,Math.max(t,e,s)),a=Math.min(t,e,s),n=i-a,a=(i+a)/2;let r,o;return 0==n?r=0:i===t?r=(e-s)/n%6*60:i===e?r=60*((s-t)/n+2):i===s&&(r=60*((t-e)/n+4)),o=0==a||1==a?0:(i-a)/Math.min(a,1-a),(r/=360)<0&&(r+=1),[r,o,a]}static hsvToHSL(t){var[t,e,s]=t,e=s*(1-e/2);return[t,0==e||1==e?0:(s-e)/Math.min(e,1-e),e]}static hslToHSV(t){var[t,e,s]=t,e=s+e*Math.min(s,1-s);return[t,0===e?0:2*(1-s/e),e]}static getColorByWord(t){var e,s;return t.toLowerCase().includes("gradient")||((e=document.createElement("div")).style.position="fixed",e.style.top="-9999px",e.style.left="-9999px",e.style.width="0px",e.style.height="0px",e.style.color=s="rgb(1, 1, 1)",e.style.color=t,document.body.appendChild(e),t=window.getComputedStyle(e).getPropertyValue("color"),e.remove(),t===s)?null:t}static calcContrastRatio(t,e){t=TColorPicker.calcRelativeLuminance(t),e=TColorPicker.calcRelativeLuminance(e),t=(Math.max(t,e)+.05)/(Math.min(t,e)+.05);return parseFloat(t.toFixed(2))}static calcRelativeLuminance(t){var[t,e,s]=TColorPicker.hslToRGB(t).map(t=>(t/=255)<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4));return.2126*t+.7152*e+.0722*s}static getRelatedElement(t){let e=t.name;if(!["text_color","title_color","descr_color","subtitle_color"].includes(e))return null;e=e.replace("_color","");var t=t.closest("[data-rec-id]");return t&&(t=t.getAttribute("data-rec-id"),document.querySelector(`#rec${t} [field="${e}"]`))||null}static getBgColor(t){let e=t,s=null;for(;e;){var i=window.getComputedStyle(e),a=i.getPropertyValue("background-color"),i=i.getPropertyValue("background-image");if("rgba(0, 0, 0, 0)"!==a&&"none"===i){s=TColorPicker.parseColor(a);break}if("none"!==i)break;e=e.parentElement}return s}static isLargeText(t){var t=window.getComputedStyle(t),e=t.getPropertyValue("font-size").replace(/[^0-9]/g,""),t=t.getPropertyValue("font-weight");return 24<=e||18.66<=e&&700<=t}init(){var t=this._config.inputReplacement;t?(t.classList.add(this._classNames.container),t.addEventListener("click",this._handleInputReplacementClick),"dark"===this._config.theme&&t.classList.add(this._classNames.containerThemeDark)):(this._input.classList.add(this._classNames.input),this._container=document.createElement("div"),this._container.classList.add(this._classNames.container),"dark"===this._config.theme&&this._container.classList.add(this._classNames.containerThemeDark),this._input.insertAdjacentElement("afterend",this._container),this._input.style.paddingLeft=this._config.swatchSize+this._config.swatchGap+"px",this._container.appendChild(this._input),this._swatch=document.createElement("div"),this._swatch.classList.add(this._classNames.swatch),this._swatch.style.width=this._config.swatchSize+"px",this._swatch.style.height=this._config.swatchSize+"px",this._container.appendChild(this._swatch),this._input.addEventListener("keyup",this._handleInputKeyUp),this._input.addEventListener("keydown",this._handleInputKeyDown),this._input.addEventListener("blur",this._handleInputBlur),this._input.addEventListener("paste",this._handleInputPaste),this._input.addEventListener("input",this._handleInput),this._swatch.addEventListener("click",this._handleSwatchClick)),this._panel=new TColorPanel({className:this._classNames.panel,position:this._config.position,swatchesKey:this._config.swatchesKey,isOpacityEnabled:this._config.isOpacityEnabled,isGradientsEnabled:this._config.isGradientsEnabled,anchorElement:this._input||t,onChange:this._handleColorChange.bind(this),zIndex:this._config.panelZIndex,input:this._input,container:t||this._container,noDocumentColors:this._config.noDocumentColors,lang:this._config.lang,panelGap:this._config.panelGap,isNoInputMode:!!t,isGradientOpacityOnly:this._config.isGradientOpacityOnly,bottomGap:this._config.bottomGap,isTextContrastCheckEnabled:this._config.isTextContrastCheckEnabled}),this._panel.init(),t||this._setColorByInput(!0),document.addEventListener("click",this._handleDocClick),document.addEventListener("keydown",this._handleDocKeyDown)}destroy(){var t=this._config.inputReplacement;t?(t.classList.remove(this._classNames.container),t.classList.remove(this._classNames.containerThemeDark),t.removeEventListener("click",this._handleInputReplacementClick)):(this._swatch.remove(),this._input.style.removeProperty("padding-left"),this._container.insertAdjacentElement("beforebegin",this._input),this._container.remove(),this._input.removeEventListener("keyup",this._handleInputKeyUp),this._input.removeEventListener("keydown",this._handleInputKeyDown),this._input.removeEventListener("blur",this._handleInputBlur),this._input.removeEventListener("paste",this._handleInputPaste),this._input.removeEventListener("input",this._handleInput),this._swatch.removeEventListener("click",this._handleSwatchClick)),document.removeEventListener("click",this._handleDocClick),document.removeEventListener("keydown",this._handleDocKeyDown),this._panel.destroy()}get panelElement(){return this._panel.panelElement}get panelState(){return this._panel.panelState}openPanel(){this._panel.open()}closePanel(){this._panel.close()}_setColorByInput(t){var e=this._input.value,s=this._input.value.replace(/[^0-9A-Za-z]/g,"");let i="";for(let t=0;t<this._config.emptyColorKeywords.length;t++)if(this._config.emptyColorKeywords[t]===e){i=e;break}if(e&&!i&&s){s=TColorPicker.parseGradient(e);if(this._config.isGradientsEnabled&&s)this._panel.gradient=s;else{s=TColorPicker.parseColor(e);let t=1;4===s.length?(this._config.isOpacityEnabled&&!this._config.isGradientOpacityOnly&&(t=s[3]),s.splice(3)):t=1,this._panel.color=s,this._panel.opacity=t}this._handleColorChange(t)}else this._panel.color=null,this._panel.opacity=1,this._handleColorChange(t),this._container.style.setProperty("--current-color","transparent"),this._input.value=i}_handleDocClick(t){this._container&&this._container.contains(t.target)&&!this._config.inputReplacement&&!this._input.disabled?this._panel.open():(this._container||this._config.inputReplacement).contains(t.target)||this._panel.close()}_handleInputReplacementClick(t){var e;this._config.disablePanelToggleOnInputReplacementClick||(e=document.activeElement,this._panel.panelElement.contains(t.target))||this._panel.panelElement===t.target||e!==this._config.inputReplacement||(this._panel.panelState?this._panel.close():this._panel.open())}_handleSwatchClick(){this._input.focus()}_handleDocKeyDown(t){var e=document.activeElement;"Tab"!==t.key||this._config.inputReplacement||this._input.disabled?("Enter"===t.key||"Space"===t.key)&&(this._container||this._config.inputReplacement).contains(e)&&this._config.inputReplacement!==e&&("button"===e.role||e instanceof HTMLSelectElement)&&(t.preventDefault(),e.dispatchEvent(new Event("click"))):this._container.contains(e)||this._container===e?this._panel.open():this._panel.close()}_handleInputKeyUp(t){"Enter"===t.key&&this._setColorByInput()}_handleInputKeyDown(t){"Enter"===t.key&&t.preventDefault()}_handleInputBlur(){var t=this._input.value.replace(/[^0-9A-Za-z]/g,"");this._input.value&&t?this._formatInputValue():this._setColorByInput()}_formatInputValue(e,s){if(!s){var i=this._input.value;for(let t=0;t<this._config.emptyColorKeywords.length;t++)if(this._config.emptyColorKeywords[t]===i)return}if(this._config.isGradientsEnabled&&this._currentGradient&&!e){s=TGradientPicker.gradientToCSS(this._currentGradient);this._input.value=s}else{e=this._config.format,s="uppercase"===this._config.letterCase;if("hex"===e){let t=TColorPicker.hslToHEX(this._currentColor);t=s?t.toUpperCase():t.toLowerCase(),this._input.value="#"+t}else if("rgb"===e){let t=TColorPicker.hslToRGB(this._currentColor);t=`rgb(${t.join(", ")})`,t=s?t.toUpperCase():t.toLowerCase(),this._input.value=t}else if("hsl"===e){var[e,a,n]=this._currentColor;let t=`hsl(${360*Math.round(e)}, ${Math.round(100*a)}%, ${Math.round(100*n)}%)`;t=s?t.toUpperCase():t.toLowerCase(),this._input.value=t}}}_handleInputPaste(){setTimeout(()=>{this._setColorByInput()},0)}_handleInput(){var t=this._input.value,e=this._input.selectionStart,s=this._input.selectionEnd;this._setColorByInput(),this._input.value=t,this._input.selectionStart=e,this._input.selectionEnd=s}_handleColorChange(t,s){if(this._config.inputReplacement)return t?void 0:(this._currentColor=this._panel.color,this._currentOpacity=this._panel.opacity,this._currentGradient=this._panel.gradient,this._eventColor=[s?null:this._currentColor,s?null:this._currentOpacity,s?null:this._currentGradient],void this._dispatchColorChangeEvent());var i=this._input.value;if(this._currentColor=this._panel.color,this._currentOpacity=this._panel.opacity,this._currentGradient=this._panel.gradient,this._formatInputValue(!1,!0),this._config.isGradientsEnabled&&this._currentGradient?(s=TGradientPicker.gradientToCSS(this._currentGradient),this._container.style.setProperty("--current-color",s)):(s=TColorPicker.hslToRGB(this._currentColor),this._container.style.setProperty("--current-color",`rgba(${s.join(", ")}, ${this._currentOpacity})`)),!t){let e="";for(let t=0;t<this._config.emptyColorKeywords.length;t++)if(this._config.emptyColorKeywords[t]===i){e=i;break}s=(!i||"#"===i||e)&&(!this._currentColor||TColorPicker.compareArrays(this._currentColor,[0,0,0]));this._eventColor=[s?null:this._currentColor,s?null:this._currentOpacity,s?null:this._currentGradient],this._dispatchColorChangeEvent()}}_dispatchColorChangeEvent(){var t=new TColorChangeEvent(...this._eventColor);(this._config.inputReplacement||this._input).dispatchEvent(t)}static compareArrays(e,s){let i=!0;if(e.length!==s.length)i=!1;else for(let t=0;t<e.length;t++)if(e[t]!==s[t]){i=!1;break}return i}get color(){return this._currentColor}get opacity(){return this._currentOpacity}get gradient(){return this._currentGradient}set color(e){var t=this._config.inputReplacement;let s="";for(let t=0;t<this._config.emptyColorKeywords.length;t++)if(this._config.emptyColorKeywords[t]===e){s=e;break}!e||s?t?(this._panel.color=null,this._panel.opacity=1):(this._input.value=s,this._setColorByInput(!0)):((e=TColorPicker.parseColor(e))&&4===e.length&&((this._config.isOpacityEnabled&&!this._config.isGradientOpacityOnly||1===e[3])&&(this._currentOpacity=e[3],this._panel.opacity=e[3]),e.splice(3)),this._panel.gradient=null,this._currentColor=e,this._panel.color=e,t||(this._formatInputValue(!0,!0),t=TColorPicker.hslToRGB(this._currentColor),this._container.style.setProperty("--current-color",`rgba(${t.join(", ")}, ${this._currentOpacity})`)))}set opacity(t){var e=this._config.inputReplacement;(this._config.isOpacityEnabled&&!this._config.isGradientOpacityOnly||1===t)&&(this._panel.gradient=null,this._currentGradient=null,this._panel.opacity=t,this._currentOpacity=t,e||(this._formatInputValue(!0,!0),t=TColorPicker.hslToRGB(this._currentColor),this._container.style.setProperty("--current-color",`rgba(${t.join(", ")}, ${this._currentOpacity})`)))}set gradient(t){this._config.isGradientsEnabled&&(t?(t.stops.forEach(t=>{this._config.isOpacityEnabled?t.opacity=!isNaN(t.opacity)&&0<=t.opacity&&t.opacity<=1?t.opacity:1:t.opacity=1}),this._currentGradient=t,this._panel.gradient=t,this._config.isOpacityEnabled&&(this._currentOpacity=t.stops[0].opacity,this._panel.opacity=t.stops[0].opacity)):(this._currentGradient=null,this._panel.gradient=null))}set theme(t){var e=this._config.inputReplacement;(this._container||e)&&("light"===t?(this._container||e).classList.remove(this._classNames.containerThemeDark):"dark"===t&&(this._container||e).classList.add(this._classNames.containerThemeDark))}}class TColorPanel{constructor(t){this._className=t.className,this._position=t.position,this._anchorElement=t.anchorElement,this._swatchesKey=t.swatchesKey,this._isOpacityEnabled=t.isOpacityEnabled,this._isGradientOpacityOnly=t.isGradientOpacityOnly,this._isGradientsEnabled=t.isGradientsEnabled,this._zIndex=t.zIndex,this._input=t.input,this._isNoInputMode=t.isNoInputMode,this._container=t.container,this._noDocumentColors=t.noDocumentColors,this._isTextContrastCheckEnabled=t.isTextContrastCheckEnabled,this._lang=t.lang,this._panelGap=t.panelGap,this._bottomGap=t.bottomGap,this._currentColor={color:[0,0,0],opacity:1,gradient:null,contrast:1},this._onChange=t.onChange,this._swatches=this._getSwatches(),this._documentColors=[],this._tildaColors=null,this._isPanelVisible=!1,this._isColorAreaDragStart=!1,this._isTcolorsNavDragStart=!1,this._isRangeInputStart=!1,this._anglePickerStart=!1,this._isEmptyColor=!0,this._tcolorsNavDragStartPos=null,this._colorAreaRect=null,this._anglePickerRect=null,this._contrastContainer=null,this._contrastRate=null,this._contrastValue=null,this._contrastRelatedElement=null,this._contrastBgColor=null,this._contrastIsLargeText=!1,this._modeContainers=[],this._libraryContainers=[],this._tcolorItems=[],this._tcolorsNavItems=[],this._tcolorsNavContainers=[],this._swatchElements=[],this._documentColorsElements=[],this._tooltips=[],this._sortable=null,this._isColorChangeByPanel=!1,this._gradientWrapper=null,this._gradientPicker=null,this._mode="hex",this._documentColorsContainer=null,this._opacityInputs=[],this._numberInputs=[],this._hexInput=null,this._redInput=null,this._greenInput=null,this._blueInput=null,this._hueInput=null,this._saturationInput=null,this._lightnessInput=null,this._hueRange=null,this._opacityRange=null,this._librarySelect=null,this._modsSelect=null,this._angleInput=null,this._anglePicker=null,this._eyeDropperBtn=null,this._colorArea=null,this._colorAreaPicker=null,this._tcolorsNav=null,this._addSwatchBtn=null,this._swatchesContainer=null,this._gradientSelect=null,this._gradientAngleContainer=null,this._documentColorsOption=null,this._clearBtn=null,this._applyBtn=null,this.close=this.close.bind(this),this.open=this.open.bind(this),this._handleClose=this._handleClose.bind(this),this._handleEyeDropper=this._handleEyeDropper.bind(this),this._handlePointerDown=this._handlePointerDown.bind(this),this._handlePointerMove=this._handlePointerMove.bind(this),this._handlePointerUp=this._handlePointerUp.bind(this),this._handleColorAreaChange=this._handleColorAreaChange.bind(this),this._handleHueRange=this._handleHueRange.bind(this),this._handleOpacityRange=this._handleOpacityRange.bind(this),this._handleModeSelect=this._handleModeSelect.bind(this),this._handleLibrarySelect=this._handleLibrarySelect.bind(this),this._handleTColorsNavClick=this._handleTColorsNavClick.bind(this),this._handleHexKeyDown=this._handleHexKeyDown.bind(this),this._handleNumberKeyDown=this._handleNumberKeyDown.bind(this),this._handleNumberBlur=this._handleNumberBlur.bind(this),this._handleHexBlur=this._handleHexBlur.bind(this),this._handleHexPaste=this._handleHexPaste.bind(this),this._handleNumberPaste=this._handleNumberPaste.bind(this),this._handleTColorsNavScroll=this._handleTColorsNavScroll.bind(this),this._handleTColorItemClick=this._handleTColorItemClick.bind(this),this._handleAddSwatchClick=this._handleAddSwatchClick.bind(this),this._handleAreaPickerKeyDown=this._handleAreaPickerKeyDown.bind(this),this._handleGradientSelect=this._handleGradientSelect.bind(this),this._handleGradientStopSelect=this._handleGradientStopSelect.bind(this),this._adjustAnglePicker=this._adjustAnglePicker.bind(this),this._handleAnglePickerClick=this._handleAnglePickerClick.bind(this),this._handleDocumentKeyUp=this._handleDocumentKeyUp.bind(this),this._handleDocumentClick=this._handleDocumentClick.bind(this),this._handleStorage=this._handleStorage.bind(this),this._handleSwatchesUpdate=this._handleSwatchesUpdate.bind(this),this._handleHexInput=this._handleHexInput.bind(this),this._handleNumberInput=this._handleNumberInput.bind(this),this._handleSelect=this._handleSelect.bind(this),this._handleSwatchKeyUp=this._handleSwatchKeyUp.bind(this),this._handleRangeKeyDown=this._handleRangeKeyDown.bind(this),this._handleApplyClick=this._handleApplyClick.bind(this),this._handleClearClick=this._handleClearClick.bind(this),this._dict={EN:{solid:"Solid",linear:"Linear",radial:"Radial",document_colors:"Colors on page",saved_colors:"Saved colors",tilda_colors:"Colors library",tilda_gradients:"Gradients library",save_color:"Save color",pick_color:"Pick color from screen",apply:"Apply",clear:"Clear",contrast_ratio:"Contrast",contrast_hint:"The contrast ratio gauges the level of accessibility of your website for individuals with visual impairments. A satisfactory contrast ratio is determined by the colors used for the foreground and background, as well as the size and weight of the font.",angle:"Angle"},RU:{solid:"Сплошной цвет",linear:"Линейный градиент",radial:"Радиальный градиент",document_colors:"Цвета на странице",saved_colors:"Сохранённые цвета",tilda_colors:"Библиотека цветов",tilda_gradients:"Библиотека градиентов",save_color:"Сохранить цвет",pick_color:"Выбрать цвет с экрана",apply:"Применить",clear:"Очистить",contrast_ratio:"Контраст",contrast_hint:"Коэффициент цветового контраста позволяет оценить доступность ваше сайта для людей с нарушением зрения. Он зависит от цвета текста и фона, а также от размера и насыщенности текста.",angle:"Угол"}}}_translate(t){return this._dict[this._lang][t]}_getSwatches(){var t;return this._swatchesKey&&(t=JSON.parse(localStorage.getItem("tMinicolors")))&&t[this._swatchesKey]||[]}_saveSwatches(){var t;this._swatchesKey&&((t=JSON.parse(localStorage.getItem("tMinicolors"))||{})[this._swatchesKey]=this._swatches,localStorage.setItem("tMinicolors",JSON.stringify(t)),document.dispatchEvent(new CustomEvent("swatchesupdate")),this._swatches.length<24)&&this._addSwatchBtn.style.removeProperty("display")}_updateSwatches(){this._swatchElements=Array.from(this._swatchesContainer.querySelectorAll("."+this._className+"__swatch")),this._swatches=this._swatchElements.map(t=>t.getAttribute("data-color")),this._saveSwatches()}_handleStorage(t){if(this._swatchesKey&&"tMinicolors"===t.key){var s=JSON.parse(t.newValue)[this._swatchesKey]||[];let e=!1;if(!(e=this._swatches.length!==s.length?!0:e))for(let t=0;t<s.length;t++)if(this._swatches[t]!==s[t]){e=!0;break}this._swatches=s,this._drawSwatches()}}_handleSwatchesUpdate(){this._swatches=this._getSwatches(),this._drawSwatches()}_getElementColors(t){var e,s=this._isOpacityEnabled&&!this._isGradientOpacityOnly,t=window.getComputedStyle(t),i=[],a=t.getPropertyValue("background-color"),n=t.getPropertyValue("color"),r=t.getPropertyValue("background-image"),o=t.getPropertyValue("border-color"),t=t.getPropertyValue("box-shadow").replace(/\).*/,")");return"none"!==a&&"rgba(0, 0, 0, 0)"!==a&&(a=TColorPicker.parseColor(a),e=(a=TColorPicker.hslToRGBA(a))[3],!s&&1!==e||i.push("rgba("+a.join(",")+")")),"none"===r||r.startsWith("url")||(e=TColorPicker.parseGradient(r))&&this._isGradientsEnabled&&(a=TGradientPicker.gradientToCSS(e),i.push(a)),"none"!==n&&"rgba(0, 0, 0, 0)"!==n&&(r=TColorPicker.parseColor(n),a=(e=TColorPicker.hslToRGBA(r))[3],!s&&1!==a||i.push("rgba("+e.join(",")+")")),"none"!==o&&"rgba(0, 0, 0, 0)"!==o&&(n=TColorPicker.parseColor(o),a=(r=TColorPicker.hslToRGBA(n))[3],!s&&1!==a||i.push("rgba("+r.join(",")+")")),"none"!==t&&"rgba(0, 0, 0, 0)"!==t&&(e=TColorPicker.parseColor(t),n=(o=TColorPicker.hslToRGBA(e))[3],!s&&1!==n||i.push("rgba("+o.join(",")+")")),i}_getDocumentColors(){const s=[];document.querySelectorAll(".t396 .tn-elem, .tn-artboard .tn-elem").forEach(t=>{var e=t.querySelector(".tn-atom");!e||"button"!==(t=t.getAttribute("data-elem-type"))&&"shape"!==t&&"text"!==t&&"image"!==t&&"video"!==t&&"tooltip"!==t||(t=this._getElementColors(e),s.push(...t))});document.querySelectorAll(['.record div[id^="rec"]','.record div[id^="rec"] [field="title"]','.record div[id^="rec"] [field="title"] *','.record div[id^="rec"] [field="descr"]','.record div[id^="rec"] [field="descr"] *','.record div[id^="rec"] [field="text"]','.record div[id^="rec"] [field="text"] *','.record div[id^="rec"] [field="subtitle"]','.record div[id^="rec"] [field="subtitle"] *','.record div[id^="rec"] .t-name','.record div[id^="rec"] .t-name *','.record div[id^="rec"] .t-menu__link-item','.record div[id^="rec"] .t-title','.record div[id^="rec"] .t-title *','.record div[id^="rec"] .t-descr','.record div[id^="rec"] .t-descr *','.record div[id^="rec"] .t-btn','.record div[id^="rec"] .t-btn *','.record div[id^="rec"] a','.record div[id^="rec"] a *'].join(",")).forEach(t=>{t=this._getElementColors(t);s.push(...t)});var t=new Set(s);return[...t]}async _getTildaColors(){const i=JSON.parse(window.localStorage.getItem("tildacolors"));if(i&&Date.now()-i.timestamp<864e5)return new Promise(t=>{t(i)});if(window.waitingTildaColorsRequests||(window.waitingTildaColorsRequests=[]),window.isTildaColorsLoading)return new Promise((t,e)=>{window.waitingTildaColorsRequests.push({resolve:t,reject:e})});if(window.isTildaColorsLoadFails)return new Promise((t,e)=>e());window.isTildaColorsLoading=!0,window.isTildaColorsLoadFails=!1;try{var t=await(await fetch("https://front.tildacdn.com/colors/colors/colors.json")).json();for(t.timestamp=Date.now(),window.localStorage.setItem("tildacolors",JSON.stringify(t)),window.isTildaColorsLoading=!1;window.waitingTildaColorsRequests.length;){var e=window.waitingTildaColorsRequests.shift()["resolve"];e(t)}return t}catch(s){for(window.isTildaColorsLoading=!1,i||(window.isTildaColorsLoadFails=!0);window.waitingTildaColorsRequests.length;){var{resolve:a,reject:n}=window.waitingTildaColorsRequests.shift();i?a(i):n(s)}return new Promise((t,e)=>{i?t(i):e(s)})}}init(){this._draw(),this._addEvents()}destroy(){this._eyeDropperBtn.removeEventListener("click",this._handleEyeDropper),document.removeEventListener("pointerdown",this._handlePointerDown),document.removeEventListener("pointermove",this._handlePointerMove),document.removeEventListener("pointerup",this._handlePointerUp),document.removeEventListener("keyup",this._handleDocumentKeyUp),document.removeEventListener("click",this._handleDocumentClick),document.removeEventListener("swatchesupdate",this._handleSwatchesUpdate),this._colorArea.removeEventListener("colorareachange",this._handleColorAreaChange),this._hueRange.removeEventListener("input",this._handleHueRange),this._opacityRange.removeEventListener("input",this._handleOpacityRange),this._hueRange.removeEventListener("keydown",this._handleRangeKeyDown),this._opacityRange.removeEventListener("keydown",this._handleRangeKeyDown),this._gradientSelect.removeEventListener("change",this._handleGradientSelect),this._gradientSelect.removeEventListener("change",this._handleSelect),this._modsSelect.removeEventListener("change",this._handleModeSelect),this._modsSelect.removeEventListener("change",this._handleSelect),this._librarySelect.removeEventListener("change",this._handleLibrarySelect),this._librarySelect.removeEventListener("change",this._handleSelect),this._tcolorsNav.removeEventListener("scroll",this._handleTColorsNavScroll),this._addSwatchBtn.removeEventListener("click",this._handleAddSwatchClick),this._anglePicker.removeEventListener("click",this._handleAnglePickerClick),this._gradientPicker.element.removeEventListener("tGradientStopSelect",this._handleGradientStopSelect),window.removeEventListener("storage",this._handleStorage),this._hexInput.removeEventListener("beforeinput",this._handleHexBeforeInput),this._hexInput.removeEventListener("keydown",this._handleHexKeyDown),this._hexInput.removeEventListener("blur",this._handleHexBlur),this._hexInput.removeEventListener("paste",this._handleHexPaste),this._hexInput.removeEventListener("input",this._handleHexInput),this._numberInputs.forEach(t=>{t.removeEventListener("beforeinput",this._handleNumberBeforeInput),t.removeEventListener("keydown",this._handleNumberKeyDown),t.removeEventListener("blur",this._handleNumberBlur),t.removeEventListener("paste",this._handleNumberPaste),t.removeEventListener("input",this._handleNumberInput)}),this._colorAreaPicker.removeEventListener("keydown",this._handleAreaPickerKeyDown),this._tcolorsNavItems.forEach(t=>{t.removeEventListener("click",this._handleTColorsNavClick)}),this._tcolorItems.forEach(t=>{t.removeEventListener("click",this._handleTColorItemClick)}),this._swatchElements.forEach(t=>{t.removeEventListener("click",this._handleTColorItemClick),t.removeEventListener("keyup",this._handleSwatchKeyUp)}),this._documentColorsElements.forEach(t=>{t.removeEventListener("click",this._handleTColorItemClick)}),this._gradientPicker&&this._gradientPicker.destroy(),this._sortable&&this._sortable.destroy(),this._tooltips.forEach(t=>t.destroy())}_getScrollContainer(){let t=this._container;for(var e=["auto","scroll","overlay"];t&&t!==document.documentElement;){var s=window.getComputedStyle(t).getPropertyValue("overflow-y");if(e.includes(s))break;t=t.parentElement}return t||document.documentElement}_updatePanelPosition(){var t=this._panel,e=this._isNoInputMode?0:this._anchorElement.offsetTop,s=this._isNoInputMode?0:this._anchorElement.offsetLeft,i=this._anchorElement.offsetWidth,a=this._panelGap,n=this._anchorElement.getBoundingClientRect(),r=document.body.offsetWidth-n.left-191,o=n.left-191,l=document.body.offsetWidth-n.left-i-191,r=Math.min(0,r),o=Math.min(0,o),l=Math.min(0,l),h=this._anchorElement.offsetHeight;"bottom-left"===this._position||"bottom-right"===this._position?(t.style.top=e+h+a+"px","bottom-left"===this._position?t.style.left=s+r+"px":t.style.left=s+i-191+"px"):"top-left"===this._position?(h=this._getScrollContainer().scrollTop+n.top-a-597,h=Math.min(0,h),t.style.top=e-h+"px",t.style.transform="translateY(-100%)",t.style.left=s+r+"px"):"left-top"===this._position?(t.style.top=e+"px",t.style.left=s-o-a+"px",t.style.transform="translateX(-100%)"):"right-top"===this._position&&(t.style.top=e+"px",t.style.left=s+i+a+l+"px")}_draw(){const a=t=>{this._eyeDropperBtn=document.createElement("div"),this._eyeDropperBtn.tabIndex=0,this._eyeDropperBtn.role="button",this._eyeDropperBtn.classList.add(this._className+"__eyedropper"),"function"!=typeof window.EyeDropper&&(this._eyeDropperBtn.style.display="none"),t.appendChild(this._eyeDropperBtn)};var t,e,s,i=()=>{var t=document.createElement("div");return t.classList.add(this._className+"__btns"),this._clearBtn=document.createElement("div"),this._clearBtn.classList.add(this._className+"__action-btn",this._className+"__action-btn_clear"),this._clearBtn.tabIndex=0,this._clearBtn.role="button",this._clearBtn.textContent=this._translate("clear"),this._applyBtn=document.createElement("div"),this._applyBtn.classList.add(this._className+"__action-btn",this._className+"__action-btn_apply"),this._applyBtn.tabIndex=0,this._applyBtn.role="button",this._applyBtn.textContent=this._translate("apply"),t.append(this._clearBtn,this._applyBtn),t},n=((s=document.createElement("div")).classList.add(this._className),s.style.setProperty("--current-color",`hsl(${this._currentColor.color[0]}turn, ${100*this._currentColor.color[1]}%, ${100*this._currentColor.color[2]}%)`),s.style.setProperty("--current-opacity",this._currentColor.opacity),s.style.setProperty("--current-hue",this._currentColor.color[0]+"turn"),s.style.zIndex=this._zIndex,(()=>{const t=document.createElement("div");t.classList.add(this._className+"__head"),this._isGradientsEnabled||t.classList.add(this._className+"__head_hidden");return this._gradientSelect=document.createElement("select"),this._gradientSelect.classList.add(this._className+"__gradient-select",this._className+"__select"),["solid","linear","radial"].forEach(t=>{var e=document.createElement("option");e.value=t,e.innerText=this._translate(t),"solid"===t&&(e.selected=!0),this._gradientSelect.appendChild(e)}),t.appendChild(this._gradientSelect),t})()),r=((l=document.createElement("div")).classList.add(this._className+"__gradients"),(e=document.createElement("div")).classList.add(this._className+"__gradient-wrapper"),e.style.display="none",this._gradientWrapper=e,this._gradientPicker=new TGradientPicker(this._currentColor.gradient,this._handleGradientStopsChange.bind(this)),this._gradientPicker.init(),(o=document.createElement("div")).classList.add(this._className+"__angle"),this._gradientAngleContainer=o,(r=document.createElement("label")).classList.add(this._className+"__angle-label"),(t=document.createElement("span")).classList.add(this._className+"__angle-span"),t.innerText=this._translate("angle"),(h=document.createElement("input")).classList.add(this._className+"__angle-input",this._className+"__input"),h.type="text",h.maxLength=3,h.setAttribute("data-type","angle"),h.setAttribute("data-min",0),h.setAttribute("data-max",360),h.value="0",this._angleInput=h,this._numberInputs.push(h),r.appendChild(t),r.appendChild(h),(t=document.createElement("div")).classList.add(this._className+"__angle-picker"),t.style.setProperty("--angle","0turn"),this._anglePicker=t,o.appendChild(r),o.appendChild(t),h=o,e.appendChild(this._gradientPicker.element),e.appendChild(h),l.appendChild(e),l),o=(this._colorArea=document.createElement("div"),this._colorArea.classList.add(this._className+"__area"),(t=document.createElement("div")).classList.add(this._className+"__area-inner"),this._colorAreaPicker=document.createElement("div"),this._colorAreaPicker.classList.add(this._className+"__area-picker"),this._colorAreaPicker.tabIndex=0,this._colorArea.appendChild(t),this._colorArea.appendChild(this._colorAreaPicker),(()=>{const t=document.createElement("div"),e=(t.classList.add(this._className+"__inputs"),document.createElement("div"));e.classList.add(this._className+"__range-outer"),t.appendChild(e);const i=document.createElement("div");{const s=document.createElement("div");s.classList.add(this._className+"__range-container"),this._hueRange=document.createElement("input"),this._hueRange.classList.add(this._className+"__range",this._className+"__range_hue"),this._hueRange.type="range",this._hueRange.min=0,this._hueRange.max=1,this._hueRange.step=.001,this._hueRange.value=this._currentColor.color[0],s.appendChild(this._hueRange),this._opacityRange=document.createElement("input"),this._opacityRange.classList.add(this._className+"__range",this._className+"__range_opacity"),this._opacityRange.type="range",this._opacityRange.min=0,this._opacityRange.max=1,this._opacityRange.step=.01,this._opacityRange.value=this._currentColor.opacity,this._isOpacityEnabled&&!this._isGradientOpacityOnly||(this._opacityRange.style.display="none"),s.appendChild(this._opacityRange),e.appendChild(s)}return i.classList.add(this._className+"__modes"),this._modsSelect=document.createElement("select"),this._modsSelect.classList.add(this._className+"__modes-select",this._className+"__select"),this._modsSelect.setAttribute("data-mode","hex"),["hex","rgb","hsl"].forEach(t=>{var e=document.createElement("option");e.value=t,e.innerText=t.toUpperCase(),"hex"===t&&(e.selected=!0),this._modsSelect.appendChild(e)}),i.appendChild(this._modsSelect),["hex","rgb","hsl"].forEach(t=>{var e,s=document.createElement("div");this._modeContainers.push(s),s.classList.add(this._className+"__modes-inputs"),s.setAttribute("data-mode",t),"hex"!==t&&(s.style.display="none"),"hex"===t?(this._hexInput=document.createElement("input"),this._hexInput.classList.add(this._className+"__input"),this._hexInput.type="text",this._hexInput.maxLength=7,this._hexInput.value="#"+TColorPicker.hslToHEX(this._currentColor.color).toUpperCase(),(e=document.createElement("input")).classList.add(this._className+"__input",this._className+"__input_opacity"),e.type="text",e.maxLength=3,this._numberInputs.push(e),this._isOpacityEnabled&&!this._isGradientOpacityOnly||(e.style.display="none"),this._opacityInputs.push(e),s.appendChild(this._hexInput),s.appendChild(e)):"rgb"===t?(e=TColorPicker.hslToRGB(this._currentColor.color),this._redInput=document.createElement("input"),this._redInput.classList.add(this._className+"__input"),this._redInput.type="text",this._redInput.setAttribute("data-min",0),this._redInput.setAttribute("data-max",255),this._redInput.setAttribute("data-type","red"),this._redInput.maxLength=3,this._redInput.value=e[0],this._numberInputs.push(this._redInput),this._greenInput=document.createElement("input"),this._greenInput.classList.add(this._className+"__input"),this._greenInput.type="text",this._greenInput.setAttribute("data-min",0),this._greenInput.setAttribute("data-max",255),this._greenInput.setAttribute("data-type","green"),this._greenInput.maxLength=3,this._greenInput.value=e[1],this._numberInputs.push(this._greenInput),this._blueInput=document.createElement("input"),this._blueInput.classList.add(this._className+"__input"),this._blueInput.type="text",this._blueInput.setAttribute("data-min",0),this._blueInput.setAttribute("data-max",255),this._blueInput.setAttribute("data-type","blue"),this._blueInput.maxLength=3,this._blueInput.value=e[2],this._numberInputs.push(this._blueInput),(e=document.createElement("input")).classList.add(this._className+"__input",this._className+"__input_opacity"),e.type="text",e.maxLength=3,this._numberInputs.push(e),this._isOpacityEnabled&&!this._isGradientOpacityOnly||(e.style.display="none"),this._opacityInputs.push(e),s.appendChild(this._redInput),s.appendChild(this._greenInput),s.appendChild(this._blueInput),s.appendChild(e)):"hsl"===t&&(e=this._currentColor.color,e=[Math.round(360*e[0]),Math.round(100*e[0]),Math.round(100*e[0])],this._hueInput=document.createElement("input"),this._hueInput.classList.add(this._className+"__input"),this._hueInput.type="text",this._hueInput.setAttribute("data-min",0),this._hueInput.setAttribute("data-max",360),this._hueInput.setAttribute("data-type","hue"),this._hueInput.maxLength=3,this._hueInput.value=e[0],this._numberInputs.push(this._hueInput),this._saturationInput=document.createElement("input"),this._saturationInput.classList.add(this._className+"__input"),this._saturationInput.type="text",this._saturationInput.setAttribute("data-min",0),this._saturationInput.setAttribute("data-max",100),this._saturationInput.setAttribute("data-type","saturation"),this._saturationInput.maxLength=3,this._saturationInput.value=e[1],this._numberInputs.push(this._saturationInput),this._lightnessInput=document.createElement("input"),this._lightnessInput.classList.add(this._className+"__input"),this._lightnessInput.type="text",this._lightnessInput.setAttribute("data-min",0),this._lightnessInput.setAttribute("data-max",100),this._lightnessInput.setAttribute("data-type","lightness"),this._lightnessInput.maxLength=3,this._lightnessInput.value=e[2],this._numberInputs.push(this._lightnessInput),(t=document.createElement("input")).classList.add(this._className+"__input",this._className+"__input_opacity"),t.type="text",t.maxLength=3,this._numberInputs.push(t),this._isOpacityEnabled&&!this._isGradientOpacityOnly||(t.style.display="none"),this._opacityInputs.push(t),s.appendChild(this._hueInput),s.appendChild(this._saturationInput),s.appendChild(this._lightnessInput),s.appendChild(t)),i.appendChild(s)}),this._opacityInputs.forEach(t=>{t.value=Math.round(100*this._currentColor.opacity),t.setAttribute("data-min",0),t.setAttribute("data-max",100),t.setAttribute("data-type","opacity")}),t.appendChild(i),this._isOpacityEnabled&&!this._isGradientOpacityOnly?a(e):(i.classList.add(this._className+"__modes_eyedropper"),a(i)),t})()),l=(this._contrastContainer=document.createElement("div"),this._contrastContainer.classList.add(this._className+"__contrast"),this._contrastContainer.style.display="none",(h=document.createElement("div")).classList.add(this._className+"__contrast-label"),h.innerText=this._translate("contrast_ratio"),this._contrastRate=document.createElement("div"),this._contrastRate.classList.add(this._className+"__contrast-rate"),this._contrastValue=document.createElement("div"),this._contrastValue.classList.add(this._className+"__contrast-value"),(e=document.createElement("div")).innerText="?",e.classList.add(this._className+"__contrast-hint"),this._tooltips.push(new TTooltip({element:e,zIndex:this._zIndex+1,text:this._translate("contrast_hint"),parent:this._container})),this._contrastContainer.append(h,e,this._contrastRate,this._contrastValue),(()=>{const t=document.createElement("div");t.classList.add(this._className+"__library");var e,s,i;this._librarySelect=document.createElement("select"),this._librarySelect.classList.add(this._className+"__select",this._className+"__library-select"),(e=document.createElement("option")).value="swatches",e.innerText=this._translate("saved_colors"),this._noDocumentColors&&(e.selected=!0),(a=document.createElement("option")).value="document-colors",a.innerText=this._translate("document_colors"),this._noDocumentColors||(a.selected=!0),this._documentColorsOption=a,(s=document.createElement("option")).value="tilda",s.innerText=this._translate("tilda_colors"),(i=document.createElement("option")).value="tilda-gradients",i.innerText=this._translate("tilda_gradients"),this._noDocumentColors||this._librarySelect.appendChild(a),this._librarySelect.appendChild(e),this._librarySelect.appendChild(s),this._isGradientsEnabled&&this._librarySelect.appendChild(i),t.appendChild(this._librarySelect),this._swatchesContainer=document.createElement("div"),this._libraryContainers.push(this._swatchesContainer),this._swatchesContainer.classList.add(this._className+"__swatches"),this._noDocumentColors||(this._swatchesContainer.style.display="none"),this._swatchesContainer.setAttribute("data-library","swatches"),this._addSwatchBtn=document.createElement("div"),this._addSwatchBtn.tabIndex=0,this._addSwatchBtn.role="button",this._addSwatchBtn.classList.add(this._className+"__add-swatch"),this._swatchesContainer.appendChild(this._addSwatchBtn),t.appendChild(this._swatchesContainer),this._drawSwatches(),this._documentColorsContainer=document.createElement("div"),this._libraryContainers.push(this._documentColorsContainer),this._documentColorsContainer.classList.add(this._className+"__swatches"),this._documentColorsContainer.setAttribute("data-library","document-colors"),this._noDocumentColors||t.appendChild(this._documentColorsContainer);{const n=document.createElement("div"),r=(this._libraryContainers.push(n),n.classList.add(this._className+"__tcolors",this._className+"__tcolors_status"),n.setAttribute("data-library","tilda"),n.style.display="none",document.createElement("div")),o=(r.classList.add(this._className+"__tcolors-status"),r.innerText="Loading...",document.createElement("div"));o.classList.add(this._className+"__tcolors-wrapper");var a=document.createElement("div");a.classList.add(this._className+"__tcolors-nav-wrapper"),this._tcolorsNav=document.createElement("div"),this._tcolorsNav.classList.add(this._className+"__tcolors-nav"),a.appendChild(this._tcolorsNav),o.appendChild(a),n.appendChild(r),n.appendChild(o),this._getTildaColors().then(t=>{n.classList.remove(this._className+"__tcolors_status"),this._tildaColors=t.colors[0];["blue","aqua","mintgreen","green","lightgreen","yellow","peach","orange","pink","red","purple","violet","darkgray","lightgray","grayshades"].forEach((t,e)=>{var s=this._tildaColors[t],i=document.createElement("div");i.tabIndex=0,i.role="button",this._tcolorsNavItems.push(i),i.classList.add(this._className+"__tcolors-nav-item"),e||i.classList.add(this._className+"__tcolors-nav-item_active"),i.innerText="RU"===this._lang?s.name:s.name_en,i.setAttribute("data-color-group",t),this._tcolorsNav.appendChild(i);const a=document.createElement("div");this._tcolorsNavContainers.push(a),a.classList.add(this._className+"__tcolors-list"),a.setAttribute("data-color-group",t),e&&(a.style.display="none"),s.hex.forEach(t=>{var e=document.createElement("div");e.tabIndex=0,e.role="button",this._tcolorItems.push(e),e.classList.add(this._className+"__tcolors-item"),e.setAttribute("data-color",t),e.style.background=t,a.appendChild(e)}),o.appendChild(a)}),this._tcolorsNavItems.forEach(t=>{t.addEventListener("click",this._handleTColorsNavClick)}),this._tcolorItems.forEach(t=>{t.addEventListener("click",this._handleTColorItemClick)})}).catch(()=>{r.innerText="Failed to load data"}),t.appendChild(n)}{const l=document.createElement("div"),h=(this._libraryContainers.push(l),l.classList.add(this._className+"__tcolors",this._className+"__tcolors_status"),l.setAttribute("data-library","tilda-gradients"),l.style.display="none",document.createElement("div")),c=(h.classList.add(this._className+"__tcolors-status"),h.innerText="Loading...",document.createElement("div"));c.classList.add(this._className+"__tcolors-wrapper"),l.appendChild(h),l.appendChild(c),this._getTildaColors().then(t=>{l.classList.remove(this._className+"__tcolors_status");t=t.gradients.map(t=>{t={type:"linear",stops:[{color:TColorPicker.hexToHSL(t.hex1),position:0,opacity:1},{color:TColorPicker.hexToHSL(t.hex2),position:1,opacity:1}],angle:0};return TGradientPicker.gradientToCSS(t)});const s=document.createElement("div");s.classList.add(this._className+"__tcolors-list",this._className+"__tcolors-list_gradients"),t.forEach(t=>{var e=document.createElement("div");e.tabIndex=0,e.role="button",this._tcolorItems.push(e),e.classList.add(this._className+"__tcolors-item"),e.setAttribute("data-color",t),e.style.background=t,s.appendChild(e),e.addEventListener("click",this._handleTColorItemClick)}),c.appendChild(s)}).catch(()=>{h.innerText="Failed to load data"}),t.appendChild(l)}return t})()),h=((t=document.createElement("div")).classList.add(this._className+"__bottom-gap"),t.style.height=this._bottomGap+"px",t);s.appendChild(n),s.appendChild(r),s.appendChild(this._colorArea),s.appendChild(o),s.appendChild(this._contrastContainer),s.appendChild(l),this._isNoInputMode&&(e=i(),s.appendChild(e)),s.appendChild(h),this._panel=s}_drawSwatches(){this._swatchElements.forEach(t=>{t.removeEventListener("click",this._handleTColorItemClick),t.remove()}),this._swatchElements=[];this._swatches.forEach((t,e)=>{this._addSwatchBtn.style.removeProperty("display");var s=document.createElement("div"),i=(s.tabIndex=0,s.role="button",s.classList.add(this._className+"__swatch"),s.style.background=t,s.setAttribute("data-color",t),s.addEventListener("click",this._handleTColorItemClick),s.addEventListener("keyup",this._handleSwatchKeyUp),t.includes("gradient"));let a=!1;if(i){var n=TColorPicker.parseGradient(t);for(let t=0;t<n.stops.length;t++)if(n.stops[t].opacity<1){a=!0;break}}t=t.includes("rgba")&&!i&&1!==TColorPicker.parseColor(t)[3]||a;(!this._isGradientsEnabled&&i||(!this._isOpacityEnabled||this._isGradientOpacityOnly)&&!i&&t||i&&!this._isOpacityEnabled&&t)&&(s.style.display="none"),this._addSwatchBtn.insertAdjacentElement("beforebegin",s),this._swatchElements.push(s),23<=e&&(this._addSwatchBtn.style.display="none")})}_drawDocumentColors(){this._documentColors=this._getDocumentColors(),this._documentColorsElements.forEach(t=>{t.removeEventListener("click",this._handleTColorItemClick),t.remove()}),this._documentColorsElements=[];for(let t=0;t<this._documentColors.length&&t<24;t++){var e=this._documentColors[t],s=document.createElement("div");s.tabIndex=0,s.role="button",s.classList.add(this._className+"__swatch"),s.style.background=e,s.setAttribute("data-color",e),s.addEventListener("click",this._handleTColorItemClick),this._documentColorsElements.push(s),this._documentColorsContainer.appendChild(s)}this._documentColorsElements.length?this._documentColorsOption.disabled=!1:(this._librarySelect.value="swatches",this._swatchesContainer.removeAttribute("style"),this._documentColorsContainer.style.display="none",this._documentColorsOption.disabled=!0)}_addEvents(){this._eyeDropperBtn.addEventListener("click",this._handleEyeDropper),document.addEventListener("pointerdown",this._handlePointerDown),document.addEventListener("pointermove",this._handlePointerMove),document.addEventListener("pointerup",this._handlePointerUp),document.addEventListener("keyup",this._handleDocumentKeyUp),document.addEventListener("click",this._handleDocumentClick),document.addEventListener("swatchesupdate",this._handleSwatchesUpdate),this._colorArea.addEventListener("colorareachange",this._handleColorAreaChange),this._hueRange.addEventListener("input",this._handleHueRange),this._opacityRange.addEventListener("input",this._handleOpacityRange),this._hueRange.addEventListener("keydown",this._handleRangeKeyDown),this._opacityRange.addEventListener("keydown",this._handleRangeKeyDown),this._gradientSelect.addEventListener("change",this._handleGradientSelect),this._gradientSelect.addEventListener("change",this._handleSelect),this._modsSelect.addEventListener("change",this._handleModeSelect),this._modsSelect.addEventListener("change",this._handleSelect),this._librarySelect.addEventListener("change",this._handleLibrarySelect),this._librarySelect.addEventListener("change",this._handleSelect),this._tcolorsNav.addEventListener("scroll",this._handleTColorsNavScroll),this._addSwatchBtn.addEventListener("click",this._handleAddSwatchClick),this._anglePicker.addEventListener("click",this._handleAnglePickerClick),this._gradientPicker.element.addEventListener("tGradientStopSelect",this._handleGradientStopSelect),window.addEventListener("storage",this._handleStorage),this._hexInput.addEventListener("beforeinput",this._handleHexBeforeInput),this._hexInput.addEventListener("keydown",this._handleHexKeyDown),this._hexInput.addEventListener("blur",this._handleHexBlur),this._hexInput.addEventListener("paste",this._handleHexPaste),this._hexInput.addEventListener("input",this._handleHexInput),this._numberInputs.forEach(t=>{t.addEventListener("beforeinput",this._handleNumberBeforeInput),t.addEventListener("keydown",this._handleNumberKeyDown),t.addEventListener("blur",this._handleNumberBlur),t.addEventListener("paste",this._handleNumberPaste),t.addEventListener("input",this._handleNumberInput)}),this._colorAreaPicker.addEventListener("keydown",this._handleAreaPickerKeyDown),this._connectTSortableLite(()=>{if("function"==typeof TSortableLite){let o;this._sortable=new TSortableLite(this._swatchesContainer,{selector:"."+this._className+"__swatch",handleSelector:"."+this._className+"__swatch",autoScroll:{container:this._swatchesContainer,speedIndex:.4},isAutoUpdateEnabled:!0,ghost:{className:"."+this._className+"__swatch_ghost"},dragImage:{zIndex:99999},onStart:()=>{o=this._panel.getBoundingClientRect()},onMove:t=>{var e=t.draggingElement,s=t.originalEvent.clientX,t=t.originalEvent.clientY,i=o.left,a=i+o.width,n=o.top,r=n+o.height;i<=s&&s<=a&&n<=t&&t<=r?(document.documentElement.style.removeProperty("cursor"),this._sortable._dragImage.style.removeProperty("cursor"),e.classList.remove(this._className+"__swatch_del")):(document.documentElement.style.cursor="no-drop",e.classList.add(this._className+"__swatch_del"),this._sortable._dragImage.style.cursor="no-drop")},onDrop:t=>{t=t.draggingElement;t.classList.contains(this._className+"__swatch_del")&&t.remove(),this._updateSwatches()},onEnd:t=>{t=t.draggingElement;document.documentElement.style.removeProperty("cursor"),t.classList.contains(this._className+"__swatch_del")&&(t.remove(),this._updateSwatches())}}),this._sortable.init()}}),setTimeout(()=>{this._tooltips.push(new TTooltip({element:this._addSwatchBtn,zIndex:this._zIndex+1,text:this._translate("save_color"),parent:this._container})),this._tooltips.push(new TTooltip({element:this._eyeDropperBtn,zIndex:this._zIndex+1,text:this._translate("pick_color"),parent:this._container})),this._tooltips.forEach(t=>t.init())},0),this._isNoInputMode&&(this._applyBtn.addEventListener("click",this._handleApplyClick),this._clearBtn.addEventListener("click",this._handleClearClick))}_handleApplyClick(){this._onChange.call(null,!1),this.close()}_handleClearClick(){this._updateOpacity(1,!0),this._updateColor(null,!0),this._onChange.call(null,!1,!0),this.close()}_handleClose(t){t.stopPropagation(),this.close()}_handleDocumentKeyUp(t){"Escape"===t.key&&this.close(),"Tab"===t.key&&(t=document.activeElement,this._panel.querySelectorAll("."+this._className+"__select_focus").forEach(t=>t.classList.remove(this._className+"__select_focus")),t.matches("."+this._className+"__select"))&&t.classList.add(this._className+"__select_focus")}_handleDocumentClick(){this._panel.querySelectorAll("."+this._className+"__select_focus").forEach(t=>t.classList.remove(this._className+"__select_focus"))}_handleEyeDropper(){"function"==typeof window.EyeDropper&&(new window.EyeDropper).open().then(t=>{this._isColorChangeByPanel=!0,this._updateColor(TColorPicker.hexToHSL(t.sRGBHex))}).catch(()=>{})}_handlePointerDown(t){this._colorArea.contains(t.target)&&(this._isColorAreaDragStart=!0,this._colorAreaRect=this._colorArea.getBoundingClientRect(),this._adjustColorAreaPicker(t.clientX,t.clientY),document.documentElement.style.setProperty("user-select","none")),(this._hueRange.contains(t.target)||this._opacityRange.contains(t.target))&&(this._isRangeInputStart=!0),!this._anglePicker.contains(t.target)&&this._anglePicker!==t.target||(this._anglePickerRect=this._anglePicker.getBoundingClientRect(),this._anglePickerStart=!0,document.documentElement.style.setProperty("user-select","none")),!this._tcolorsNav.contains(t.target)&&this._tcolorsNav!==t.target||(this._isTcolorsNavDragStart=!0,this._tcolorsNavDragStartPos=t.clientX,document.documentElement.style.setProperty("user-select","none"))}_handlePointerMove(t){this._isColorAreaDragStart&&this._adjustColorAreaPicker(t.clientX,t.clientY),this._anglePickerStart&&this._adjustAnglePicker(t.clientX,t.clientY,t.shiftKey),this._isTcolorsNavDragStart&&this._adjustTcolorsNavScroll(t.clientX)}_handlePointerUp(){this._isColorAreaDragStart&&(document.documentElement.style.removeProperty("user-select"),this._colorAreaPicker.style.removeProperty("will-change"),this._setColorAreaValue(this._currentColor.color),setTimeout(()=>{this._isColorAreaDragStart=!1,this._colorAreaPicker.focus()},0)),this._isRangeInputStart&&setTimeout(()=>{this._isRangeInputStart=!1},0),this._anglePickerStart&&setTimeout(()=>{document.documentElement.style.removeProperty("user-select"),this._anglePickerStart=!1},0),this._isTcolorsNavDragStart&&setTimeout(()=>{this._isTcolorsNavDragStart=!1,this._tcolorsNavDragStartPos=null,document.documentElement.style.removeProperty("user-select")},0)}_adjustTcolorsNavScroll(t){var e=this._tcolorsNavDragStartPos-t;this._tcolorsNavDragStartPos=t,this._tcolorsNav.scrollLeft+=e}_handleColorAreaChange(t){var e=t.value[0],t=t.value[1],s=this._currentColor.color[0];this._isColorChangeByPanel=!0,"hsl"===this._mode?this._updateColor([s,e,1-t]):(t=1-t,this._updateColor(TColorPicker.hsvToHSL([s,e,t])))}_handleAreaPickerKeyDown(i){var a=i.key;if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(a)){i.preventDefault();i=i.shiftKey?.05:.01;if(this._isColorChangeByPanel=!0,"hsl"===this._mode){let[t,e,s]=this._currentColor.color;"ArrowUp"===a?s=1<(s+=i)?1:s:"ArrowRight"===a?e=1<(e+=i)?1:e:"ArrowDown"===a?s=(s-=i)<0?0:s:"ArrowLeft"===a&&(e=(e-=i)<0?0:e),this._updateColor([t,e,s])}else{let[t,e,s]=TColorPicker.hslToHSV(this._currentColor.color);"ArrowUp"===a?s=1<(s+=i)?1:s:"ArrowRight"===a?e=1<(e+=i)?1:e:"ArrowDown"===a?s=(s-=i)<0?0:s:"ArrowLeft"===a&&(e=(e-=i)<0?0:e);a=TColorPicker.hsvToHSL([t,e,s]);this._updateColor(a)}}}_handleHueRange(){var t=parseFloat(this._hueRange.value),e=this._currentColor.color;this._isColorChangeByPanel=!0,this._updateColor([t,e[1],e[2]])}_handleOpacityRange(){var t=parseFloat(this._opacityRange.value);this._isColorChangeByPanel=!0,this._updateOpacity(t)}_handleRangeKeyDown(e){if(["ArrowRight","ArrowLeft"].includes(e.key)){e.preventDefault();var s=e.target,i=e.shiftKey?.05:.01,a=parseFloat(s.value),n=parseFloat(s.min),r=parseFloat(s.max);let t=a;"ArrowRight"==e.key?t+=i:t-=i,t=Math.max(n,t),t=Math.min(r,t),s.value=t,s.dispatchEvent(new Event("input"))}}_handleSelect(t){const e=t.target;t=e.selectedOptions[0];const s=document.createElement("div");s.classList.add("select-helper"),s.style.position="fixed",s.style.top="-9999px",s.style.left="-9999px",s.style.width="max-content",s.innerText=t.innerText,this._panel.appendChild(s),setTimeout(()=>{e.style.width=s.offsetWidth+"px",s.remove()},0)}_showGradient(t){this._gradientSelect.value=t,this._handleSelect({target:this._gradientSelect}),"solid"===t?(this._gradientWrapper.style.display="none",this._isOpacityEnabled&&this._isGradientOpacityOnly&&(this._opacityInputs.forEach(t=>t.style.display="none"),this._opacityRange.style.display="none",this._panel.querySelector("."+this._className+"__modes").insertAdjacentElement("beforeend",this._eyeDropperBtn))):("linear"===t?this._gradientAngleContainer.style.removeProperty("display"):this._gradientAngleContainer.style.display="none",this._gradientWrapper.style.removeProperty("display"),this._isOpacityEnabled&&this._isGradientOpacityOnly&&(this._opacityInputs.forEach(t=>t.style.removeProperty("display")),this._opacityRange.style.removeProperty("display"),this._panel.querySelector("."+this._className+"__range-outer").insertAdjacentElement("beforeend",this._eyeDropperBtn)))}_handleGradientSelect(t,e){var s,i=this._gradientSelect.value;"solid"===i?this._currentColor.gradient=null:this._currentColor.gradient?((s=this._currentColor.gradient).type=i,s.angle||(s.angle=0)):this._currentColor.gradient={type:i,angle:"linear"===i?0:null,stops:[{color:this._currentColor.color,position:0,opacity:this._currentColor.opacity},{color:this._isOpacityEnabled?this._currentColor.color:[0,0,0],position:1,opacity:this._isOpacityEnabled?0:1}]},this._updateGradient(e)}_handleModeSelect(){const e=this._modsSelect.value;this._mode=e,this._modeContainers.forEach(t=>{t.getAttribute("data-mode")===e?t.style.removeProperty("display"):t.style.display="none"}),"hsl"===e?this._colorArea.classList.add(this._className+"__area_hsl"):this._colorArea.classList.remove(this._className+"__area_hsl"),this._setColorAreaValue(this._currentColor.color)}_handleGradientStopSelect(t){var e=t.stop.color,t=t.stop.opacity;this._updateColor(e),this._updateOpacity(t)}_handleLibrarySelect(){const e=this._librarySelect.value;var t;this._libraryContainers.forEach(t=>{t.getAttribute("data-library")===e?(window.localStorage.setItem("tColorpickerLibrary",e),t.style.removeProperty("display")):t.style.display="none"}),"tilda"===e&&(t=this._panel.querySelector("."+this._className+"__tcolors-nav-item_active"))&&(this._tcolorsNav.scrollLeft=t.offsetLeft)}_handleAddSwatchClick(){let t;t=this._isGradientsEnabled&&this._currentColor.gradient?TGradientPicker.gradientToCSS(this._currentColor.gradient):(e=this._currentColor.color,(s=this._currentColor.opacity)<1?`rgba(${TColorPicker.hslToRGB(e).join(", ")}, ${s})`:"#"+TColorPicker.hslToHEX(e));var e,s=document.createElement("div");s.tabIndex=0,s.role="button",s.classList.add(this._className+"__swatch"),s.style.background=t,s.setAttribute("data-color",t),this._addSwatchBtn.insertAdjacentElement("beforebegin",s),this._swatchElements.push(s),this._swatches.push(t),s.addEventListener("click",this._handleTColorItemClick),s.addEventListener("keyup",this._handleSwatchKeyUp),this._swatchesContainer.scrollTop=this._swatchesContainer.scrollHeight,this._saveSwatches()}_handleTColorsNavClick(t){const i=t.target.closest("."+this._className+"__tcolors-nav-item"),s=i.getAttribute("data-color-group");this._tcolorsNavItems.forEach(t=>{var e,s;t===i?(e=i.parentElement,t.classList.add(this._className+"__tcolors-nav-item_active"),s=t.offsetLeft,TColorPanel.scrollTo({endX:s,endY:0},e)):t.classList.remove(this._className+"__tcolors-nav-item_active")}),this._tcolorsNavContainers.forEach(t=>{var e=t.getAttribute("data-color-group");s===e?t.style.removeProperty("display"):t.style.display="none"})}_handleTColorsNavScroll(){var t=this._tcolorsNav.scrollWidth,e=this._tcolorsNav.clientWidth;t-1<=this._tcolorsNav.scrollLeft+e?this._tcolorsNav.parentElement.classList.add(this._className+"__tcolors-nav-wrapper_scrolled"):this._tcolorsNav.parentElement.classList.remove(this._className+"__tcolors-nav-wrapper_scrolled")}_handleTColorItemClick(t){var e=t.target.getAttribute("data-color"),s=e.includes("gradient");this._isColorChangeByPanel=!0,s?(this._currentColor.gradient=TColorPicker.parseGradient(e)||null,this._updateGradient()):"#"===e[0]?(s=TColorPicker.hexToHSL(e),this._currentColor.gradient&&t.shiftKey&&(this._gradientSelect.value="solid",this._handleGradientSelect()),this._updateColor(s),this._updateOpacity(1)):e.includes("rgba")&&(s=TColorPicker.parseColor(e),e=isNaN(s[3])?1:s[3],s.splice(3),this._currentColor.gradient&&t.shiftKey&&(this._gradientSelect.value="solid",this._handleGradientSelect()),this._updateColor(s),this._updateOpacity(e))}_handleSwatchKeyUp(t){"Delete"!==t.key&&"Backspace"!==t.key||(t.target.remove(),this._updateSwatches())}_handleHexBeforeInput(t){var e=t.data;e&&/[^a-zA-Z0-9#]/g.test(e)&&t.preventDefault()}_handleHexInput(t){var t=t.target,e=t.value,s=t.selectionStart,i=t.selectionEnd,a=TColorPicker.parseColor(t.value);this._updateColor(a),t.value=e,t.selectionStart=s,t.selectionEnd=i}_handleHexKeyDown(e){if(["ArrowUp","ArrowDown","Enter"].includes(e.key)){e.preventDefault();var s=e.target,s=TColorPicker.parseColor(s.value),s=TColorPicker.hslToRGB(s);let t;"ArrowUp"===e.key?t=s.map(t=>255===t?t:t+1):"ArrowDown"===e.key?t=s.map(t=>0===t?t:t-1):"Enter"===e.key&&(t=s);e=TColorPicker.rgbToHSL(t);this._updateColor(e)}}_handleHexBlur(t){t=t.target,t=TColorPicker.parseColor(t.value);this._isColorChangeByPanel=!0,this._updateColor(t)}_handleHexPaste(t){t.preventDefault();var e=t.target,s=e.value,t=(t.clipboardData||window.clipboardData).getData("text").replace(/[^a-zA-Z0-9#]/g,""),i=e.selectionStart,e=e.selectionEnd;let a=s.slice(0,i)+t+s.slice(e);a=a.slice(0,7);i=TColorPicker.parseColor(a);this._updateColor(i)}_handleNumberBeforeInput(t){var e=t.data;e&&/[^0-9]/g.test(e)&&t.preventDefault()}_handleNumberInput(t){var e=t.target,s=e.value,i=parseInt(s,10)||0,a=e.selectionStart,n=e.selectionEnd,r=parseInt(e.getAttribute("data-min"),10),o=parseInt(e.getAttribute("data-max"),10),i=Math.min(i,o),o=(i=Math.max(i,r),e.getAttribute("data-type"));if("opacity"===o)this._updateOpacity(i/100);else if("red"===o||"green"===o||"blue"===o){r=TColorPicker.hslToRGB(this._currentColor.color),r=(r[["red","green","blue"].indexOf(o)]=i,TColorPicker.rgbToHSL(r));this._updateColor(r)}else if("angle"===o){if("historyUndo"===t.inputType&&!this._currentColor.gradient)return;this._currentColor.gradient.angle=i/360,this._updateGradient()}else{r=this._currentColor.color,t=["hue","saturation","lightness"].indexOf(o),o=r;o[t]=t?i/100:i/360,this._updateColor(o)}e.value=s,e.selectionStart=a,e.selectionEnd=n}_handleNumberKeyDown(e){if(["ArrowUp","ArrowDown","Enter"].includes(e.key)){e.preventDefault();var s=e.target,i=parseInt(s.getAttribute("data-min"),10),a=parseInt(s.getAttribute("data-max"),10),n=s.getAttribute("data-type"),s=parseInt(s.value,10)||0;let t;t="ArrowUp"===e.key?s<a?s+1:s:"ArrowDown"===e.key&&i<s?s-1:s,"opacity"===n?this._updateOpacity(t/100):"red"===n||"green"===n||"blue"===n?((a=TColorPicker.hslToRGB(this._currentColor.color))[["red","green","blue"].indexOf(n)]=t,e=TColorPicker.rgbToHSL(a),this._updateColor(e)):"angle"===n?(this._currentColor.gradient.angle=t/360,this._updateGradient()):((i=this._currentColor.color)[s=["hue","saturation","lightness"].indexOf(n)]=s?t/100:t/360,this._updateColor(i))}}_handleNumberBlur(t){var t=t.target,e=parseInt(t.getAttribute("data-min"),10),s=parseInt(t.getAttribute("data-max"),10),i=t.getAttribute("data-type"),t=parseInt(t.value,10)||0;let a=t<e?e:s<t?s:t;this._isColorChangeByPanel=!0,"opacity"===i?this._updateOpacity(a/100):"red"===i||"green"===i||"blue"===i?((e=TColorPicker.hslToRGB(this._currentColor.color))[["red","green","blue"].indexOf(i)]=a,s=TColorPicker.rgbToHSL(e),this._updateColor(s)):"angle"===i?(this._currentColor.gradient.angle=a/360,this._updateGradient()):((t=this._currentColor.color)[e=["hue","saturation","lightness"].indexOf(i)]=e?a/100:a/360,this._updateColor(t))}_handleNumberPaste(t){t.preventDefault();var e=t.target,s=e.value,i=e.getAttribute("data-type"),t=(t.clipboardData||window.clipboardData).getData("text").replace(/[^0-9]/g,""),a=e.selectionStart,e=e.selectionEnd;let n=s.slice(0,a)+t+s.slice(e);n=parseInt(n.slice(0,3))||0,"opacity"===i?(n=100<n?100:n<0?0:n,this._updateOpacity(n/100)):"red"===i||"green"===i||"blue"===i?(n=255<n?255:n<0?0:n,(a=TColorPicker.hslToRGB(this._currentColor.color))[["red","green","blue"].indexOf(i)]=n,t=TColorPicker.rgbToHSL(a),this._updateColor(t)):"angle"===i?(this._currentColor.gradient.angle=n/360,this._updateGradient()):(s=this._currentColor.color,e=["hue","saturation","lightness"].indexOf(i),n=e?100<n?100:n<0?0:n:360<n?360:n<0?0:n,(a=s)[e]=e?n/100:n/360,this._updateColor(a))}_updateColor(t,e){t?(this._colorAreaPicker.style.removeProperty("display"),this._colorAreaPicker.tabIndex=0,this._isEmptyColor=!1):(t=[0,0,0],this._colorAreaPicker.style.display="none",this._colorAreaPicker.removeAttribute("tabindex"),this._isEmptyColor=!0),t.splice(3),this._panel.style.setProperty("--current-color",`hsl(${t[0]}turn, ${100*t[1]}%, ${100*t[2]}%)`),this._panel.style.setProperty("--current-hue",t[0]+"turn"),this._hexInput.value="#"+TColorPicker.hslToHEX(t).toUpperCase();var[s,i,a]=TColorPicker.hslToRGB(t),s=(this._redInput.value=s,this._greenInput.value=i,this._blueInput.value=a,Math.round(360*t[0])),i=Math.round(100*t[1]),a=Math.round(100*t[2]);this._hueInput.value=s,this._saturationInput.value=i,this._lightnessInput.value=a,this._isColorAreaDragStart||this._setColorAreaValue(t),this._isRangeInputStart||(this._hueRange.value=t[0]),this._currentColor.color=t,this._updateContrast(),this._isGradientsEnabled&&this._currentColor.gradient&&this._gradientPicker.updateSelectedColor(this._currentColor.color,null,e),!this._isColorChangeByPanel||this._currentColor.gradient||this._isNoInputMode?this._isColorChangeByPanel=!0:this._onChange.call(null,e)}_updateOpacity(e,t){this._isOpacityEnabled&&(this._panel.style.setProperty("--current-opacity",e),this._opacityInputs.forEach(t=>{t.value=Math.round(100*e)}),this._isRangeInputStart||(this._opacityRange.value=e),this._currentColor.opacity=e,this._isGradientsEnabled&&this._currentColor.gradient&&this._gradientPicker.updateSelectedColor(null,this._currentColor.opacity,t),!this._isColorChangeByPanel||this._currentColor.gradient||this._isNoInputMode?this._isColorChangeByPanel=!0:this._onChange.call(null,t))}_updateGradient(t){if(this._updateContrast(),this._currentColor.gradient){var e=this._currentColor.gradient.type,s=this._currentColor.gradient.angle||0,i=this._currentColor.gradient.stops;JSON.stringify(i)!==JSON.stringify(this._gradientPicker.stops)&&(this._gradientPicker.stops=i);const a=this._gradientPicker.selectedStop;this._updateColor(a.color,t),this._isOpacityEnabled&&this._updateOpacity(a.opacity,t),this._showGradient(e),this._anglePicker.style.setProperty("--angle",s+"turn"),this._angleInput.value=Math.round(360*s),this._isNoInputMode||this._onChange.call(null,t)}else{const a=this._gradientPicker.selectedStop;a&&(this._updateColor(a.color,t),this._isOpacityEnabled&&!this._isGradientOpacityOnly?this._updateOpacity(a.opacity,t):this._isGradientOpacityOnly&&this._updateOpacity(1,t),this._showGradient("solid")),void(this._gradientPicker.stops=[])}}_updateContrast(){if(this._currentColor.gradient||this._isEmptyColor||!this._contrastBgColor)this._contrastContainer.style.display="none";else{this._currentColor.contrast=TColorPicker.calcContrastRatio(this._currentColor.color,this._contrastBgColor);let t;t=this._contrastIsLargeText&&4.5<=this._currentColor.contrast||7<=this._currentColor.contrast?"AAA":this._contrastIsLargeText&&3<=this._currentColor.contrast||4.5<=this._currentColor.contrast?"AA":"Fail","Fail"===(this._contrastRate.innerText=t)?this._contrastRate.classList.add(this._className+"__contrast-rate_fail"):this._contrastRate.classList.remove(this._className+"__contrast-rate_fail"),this._contrastValue.innerText=this._currentColor.contrast.toFixed(2),this._contrastContainer.style.removeProperty("display")}}_handleGradientStopsChange(t,e){this._currentColor.gradient.stops=t,this._isNoInputMode||this._onChange.call(null,e)}_adjustColorAreaPicker(t,e){var s=this._colorAreaRect,t=Math.min(t-s.left,s.width),t=Math.max(0,t),e=Math.min(e-s.top,s.height),e=Math.max(0,e),t=(this._colorAreaPicker.style.willChange="transform",this._colorAreaPicker.style.transform=`translate(${t}px, ${e}px)`,t/s.width),e=e/s.height,s=new ColorAreaChangeEvent(t,e);this._colorArea.dispatchEvent(s)}_handleAnglePickerClick(t){this._anglePickerRect=this._anglePicker.getBoundingClientRect(),this._adjustAnglePicker(t.clientX,t.clientY)}_adjustAnglePicker(t,e,s){t-=this._anglePickerRect.left+this._anglePickerRect.width/2,e=-1*(e-(this._anglePickerRect.top+this._anglePickerRect.height/2));let i=180*Math.atan(t/e)/Math.PI;e<0?i+=180:t<0&&(i+=360),s&&(i=15*Math.round(i/15)),i/=360,this._currentColor.gradient.angle=i,this._updateGradient()}_setColorAreaValue(t){var e,s,i=this._colorArea.getBoundingClientRect();"hsl"===this._mode?(e=i.width*t[1],s=i.width*(1-t[2]),this._colorAreaPicker.style.transform=`translate(${e}px, ${s}px)`):(e=TColorPicker.hslToHSV(t),s=i.width*e[1],t=i.height*(1-e[2]),this._colorAreaPicker.style.transform=`translate(${s}px, ${t}px)`)}static throttle(e,s){let i=null;return(...t)=>{i=i||window.setTimeout(()=>{e.apply(this,t),window.clearTimeout(i),i=null},s)}}_connectTSortableLite(t){var e="https://front.tildacdn.com/plugins/sortable/t-sortable.min.css",s=document.head.querySelector('link[href*="'+e+'"]');s||((s=document.createElement("link")).href=e+(window.ver?"?v="+window.ver:""),s.rel="stylesheet",document.head.appendChild(s));let i=document.head.querySelector('script[src*="t-sortable-lite.min.js"]');i&&"function"==typeof t?"function"==typeof TSortableLite?t.call(this):i.addEventListener("load",t):i||((i=document.createElement("script")).src="https://front.tildacdn.com/plugins/sortable/t-sortable-lite.min.js"+(window.ver?"?v="+window.ver:""),i.async=!0,"function"==typeof t&&i.addEventListener("load",t),document.head.appendChild(i))}get panelElement(){return this._panel}get panelState(){return this._isPanelVisible}close(){!this._isPanelVisible||this._isColorAreaDragStart||this._isRangeInputStart||this._anglePickerStart||this._gradientPicker._isDragStarted||this._isTcolorsNavDragStart||(this._panel.remove(),this._isPanelVisible=!1,this._contrastRelatedElement=null,this._contrastBgColor=null,(this._input||this._container).dispatchEvent(new TColorPickerPanelToggleEvent(!1)))}open(){if(!this._isPanelVisible){this._container.appendChild(this._panel),this._isPanelVisible=!0,this._updatePanelPosition(),this._setColorAreaValue(this._currentColor.color),(this._input||this._container).dispatchEvent(new TColorPickerPanelToggleEvent(!0)),this._noDocumentColors||this._drawDocumentColors();let t=window.localStorage.getItem("tColorpickerLibrary");t&&("document-colors"!==t||this._documentColors.length&&!this._noDocumentColors?"tilda-gradients"!==t||this._isGradientsEnabled||(t=this._documentColors.length&&!this._noDocumentColors?"document-colors":"swatches"):t="swatches",this._librarySelect.value=t,this._librarySelect.dispatchEvent(new Event("change"))),!this._isNoInputMode&&this._isTextContrastCheckEnabled&&(this._contrastRelatedElement=TColorPicker.getRelatedElement(this._anchorElement)),this._contrastRelatedElement&&(this._contrastBgColor=TColorPicker.getBgColor(this._contrastRelatedElement),this._contrastIsLargeText=TColorPicker.isLargeText(this._contrastRelatedElement)),this._updateContrast();var e=this._panel.querySelector("."+this._className+"__tcolors-nav-item_active");e&&(this._tcolorsNav.scrollLeft=e.offsetLeft),this._handleSelect({target:this._gradientSelect}),this._handleSelect({target:this._modsSelect}),this._handleSelect({target:this._librarySelect})}}set color(t){this._isColorChangeByPanel=!1,"solid"!==this._gradientSelect.value&&(this._gradientSelect.value="solid",this._handleGradientSelect(null,!0)),this._updateColor(t,!0)}get color(){return this._currentColor.color}set opacity(t){this._isColorChangeByPanel=!1,this._updateOpacity(t,!0)}get opacity(){return this._currentColor.opacity}set gradient(t){this._isColorChangeByPanel=!1;t=(this._currentColor.gradient=t)?t.type:"solid";this._gradientSelect.value=t,this._handleGradientSelect(null,!0)}get gradient(){return this._currentColor.gradient}static scrollTo(t,e){const{endX:s,endY:i}=t,a=e.scrollLeft,n=e.scrollTop;let r;const o=t=>{void 0===r&&(r=performance.now());t=(t=(t-r)/300)<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2;e.scrollLeft=a+t*(s-a),e.scrollTop=n+t*(i-n),t<1?requestAnimationFrame(o):(e.scrollLeft=s,e.scrollTop=i)};requestAnimationFrame(o)}}class ColorAreaChangeEvent extends CustomEvent{constructor(t,e){super("colorareachange"),this.value=[t,e]}}class TColorChangeEvent extends CustomEvent{constructor(t,e,s){super("colorchange"),s&&(s.css=TGradientPicker.gradientToCSS(s)),this.currentColor={hex:null!==t?"#"+TColorPicker.hslToHEX(t):t,rgb:null!==t?TColorPicker.hslToRGB(t):t,hsl:t,opacity:e,gradient:s||null}}}class TGradientPicker{constructor(t,e){this._stops=t||[],this._element=null,this._className="tcolors-gradient",this._markers=[],this._isDragStarted=!1,this._selectedMarker=null,this._elementRect=null,this._onChange="function"==typeof e?e:new Function,this._handleMarkerSelect=this._handleMarkerSelect.bind(this),this._handlePointerDown=this._handlePointerDown.bind(this),this._handlePointerMove=this._handlePointerMove.bind(this),this._handlePointerUp=this._handlePointerUp.bind(this),this._handleKeyDown=this._handleKeyDown.bind(this),this._handleClick=this._handleClick.bind(this),this._handleAddMarkerClick=this._handleAddMarkerClick.bind(this)}init(){this._element=document.createElement("div"),this._element.classList.add(this._className);var t=TGradientPicker.gradientStopsToString(this._stops);this._element.style.setProperty("--current-gradient",t),this._drawMarkers(),document.addEventListener("pointerdown",this._handlePointerDown),document.addEventListener("pointermove",this._handlePointerMove),document.addEventListener("pointerup",this._handlePointerUp),document.addEventListener("click",this._handleClick),document.addEventListener("keydown",this._handleKeyDown),this._element.addEventListener("click",this._handleAddMarkerClick)}destroy(){document.removeEventListener("pointerdown",this._handlePointerDown),document.removeEventListener("pointermove",this._handlePointerMove),document.removeEventListener("pointerup",this._handlePointerUp),document.removeEventListener("click",this._handleClick),document.removeEventListener("keydown",this._handleKeyDown),this._element.removeEventListener("click",this._handleAddMarkerClick),this._markers.forEach(t=>{t.removeEventListener("focus",this._handleMarkerSelect)})}get element(){return this._element}set stops(t){this._stops=t||[],this._drawMarkers();t=TGradientPicker.gradientStopsToString(this._stops);this._element.style.setProperty("--current-gradient",t)}get stops(){return this._stops}get selectedStop(){var t;return this._selectedMarker&&this._stops.length?(t=parseInt(this._selectedMarker.getAttribute("data-id"),10),this._stops[t]):null}updateSelectedColor(t,e,s){var i;this._selectedMarker&&this._stops.length&&(i=parseInt(this._selectedMarker.getAttribute("data-id"),10),t&&(this._stops[i].color=t),e&&(this._stops[i].opacity=e),t=TGradientPicker.parseColorToRGBA(this._stops[i].color,this._stops[i].opacity),this._selectedMarker.style.setProperty("--marker-color",t),e=TGradientPicker.gradientStopsToString(this._stops),this._element.style.setProperty("--current-gradient",e),this._onChange.call(null,this._stops,s))}_drawMarkers(){this._markers.forEach(t=>{t.removeEventListener("focus",this._handleMarkerSelect),t.remove()}),this._markers=[],this._stops.forEach((t,e)=>{var s=document.createElement("div"),e=(s.classList.add(this._className+"__marker"),s.tabIndex=0,s.setAttribute("data-id",e),s.setAttribute("data-position",t.position),e||(s.classList.add(this._className+"__marker_selected"),this._selectedMarker=s),s.style.left=Math.round(100*t.position)+"%",TGradientPicker.parseColorToRGBA(t.color,t.opacity)),t=(s.style.setProperty("--marker-color",e),this._markers.push(s),document.createElement("div"));t.classList.add(this._className+"__marker-inner"),s.appendChild(t),this._element.appendChild(s)}),this._markers.forEach(t=>{t.addEventListener("focus",this._handleMarkerSelect)}),15<=this._stops.length?this._element.classList.add(this._className+"_disabled"):this._element.classList.remove(this._className+"_disabled")}_updateSelectedMarkerPosition(t){var e,s,i,a,n;this._selectedMarker&&((e=this._selectedMarker).style.left=100*t+"%",e.setAttribute("data-position",t),s=parseInt(e.getAttribute("data-id"),10),(i=this._stops[s]).position=t,a=this._stops[s-1],n=this._stops[s+1],a&&a.position>t?(a=this._markers[s-1],this._stops.splice(s,1),this._stops.splice(s-1,0,i),this._markers.splice(s,1),this._markers.splice(s-1,0,e),e.setAttribute("data-id",s-1),a.setAttribute("data-id",s),a.insertAdjacentElement("beforebegin",e)):n&&n.position<t&&(a=this._markers[s+1],this._stops.splice(s,1),this._stops.splice(s+1,0,i),this._markers.splice(s,1),this._markers.splice(s+1,0,e),e.setAttribute("data-id",s+1),a.setAttribute("data-id",s),a.insertAdjacentElement("afterend",e)),n=TGradientPicker.gradientStopsToString(this._stops),this._element.style.setProperty("--current-gradient",n),this._onChange.call(null,this._stops))}_removeSelectedMarker(){var t,e,s;!this._selectedMarker||this._markers.length<3||(this._element.classList.remove(this._className+"_disabled"),t=this._selectedMarker,s=parseInt(t.getAttribute("data-id"),10),t.remove(),t=this._markers[s-1],e=this._markers[s+1],this._stops.splice(s,1),this._markers.splice(s,1),this._markers.forEach((t,e)=>{t.setAttribute("data-id",e)}),t?t.focus():e&&e.focus(),s=TGradientPicker.gradientStopsToString(this._stops),this._element.style.setProperty("--current-gradient",s),this._onChange.call(null,this._stops))}_handleMarkerSelect(t){t=t.target,this._markers.forEach(t=>{t.classList.remove(this._className+"__marker_selected")}),t.classList.add(this._className+"__marker_selected"),this._selectedMarker=t,t=parseInt(t.getAttribute("data-id"),10),t=this._stops[t],t=new TGradientStopSelectEvent(t);this._element.dispatchEvent(t)}_handlePointerDown(e){for(let t=0;t<this._markers.length;t++){var s=this._markers[t];if(s.contains(e.target)||s===e.target){this._isDragStarted=!0,this._elementRect=this._element.getBoundingClientRect(),document.documentElement.style.setProperty("user-select","none");break}}}_handleClick(e){for(let t=0;t<this._markers.length;t++){var s=this._markers[t];if(s.contains(e.target)||s===e.target){e.preventDefault();break}}}_handleAddMarkerClick(t){if(!(t.target!==this._element||this._isDragStarted||15<=this._stops.length)){14===this._stops.length&&this._element.classList.add(this._className+"_disabled");var t=t.clientX,s=(this._elementRect=this._element.getBoundingClientRect(),this._elementRect.left),i=(t-s)/this._elementRect.width,i=Math.max(0,i);i=Math.min(1,i);let e=0;var a=this._stops.map(t=>t.position);for(let t=0;t<a.length;t++){var n=a[t],r=a[t+1];if(i<n){e=t;break}if(void 0===r||n<=i&&i<=r){e=t+1;break}}t={position:i,color:null,opacity:null};if(0===e)t.color=this._stops[0].color,t.opacity=this._stops[0].opacity,this._stops.unshift(t);else if(e===this._stops.length)t.color=this._stops[e-1].color,t.opacity=this._stops[e-1].opacity,this._stops.push(t);else{var s=this._stops[e-1],o=this._stops[e],l=(i-s.position)/(o.position-s.position),h=TColorPicker.hslToRGB(s.color),c=TColorPicker.hslToRGB(o.color),d=[];for(let t=0;t<3;t++){var _=h[t]+(c[t]-h[t])*l,_=Math.round(_);d.push(_)}t.color=TColorPicker.rgbToHSL(d),t.opacity=s.opacity+(o.opacity-s.opacity)*l,this._stops.splice(e,0,t)}this._drawMarkers();o=TGradientPicker.gradientStopsToString(this._stops);this._element.style.setProperty("--current-gradient",o),this._markers[e].focus(),this._onChange.call(null,this._stops)}}_handlePointerMove(s){if(this._isDragStarted){let e=(s.clientX-this._elementRect.left)/this._elementRect.width;if(e=Math.max(0,e),e=Math.min(1,e),s.shiftKey)e=e.toFixed(1);else{var s=this._markers.indexOf(this._selectedMarker),i=this._stops[s-1],s=this._stops[s+1];let t;t=(i&&(!s||Math.abs(s.position-e)>Math.abs(i.position-e))?i:s).position,Math.abs(e-t)<.03&&(e=t)}this._updateSelectedMarkerPosition(e)}}_handlePointerUp(){setTimeout(()=>{this._isDragStarted=!1,document.documentElement.style.removeProperty("user-select")},0)}_handleKeyDown(t){var e,s;!this._selectedMarker||this._selectedMarker&&document.activeElement!==document.body&&document.activeElement!==this._selectedMarker||!this._stops.length||this._isDragStarted||("ArrowLeft"===(e=t.key)?(t.preventDefault(),s=this._selectedMarker.getAttribute("data-position"),s=parseFloat(s),s-=t.shiftKey?.05:.01,s=Math.max(s,0),this._updateSelectedMarkerPosition(s)):"ArrowRight"===e?(t.preventDefault(),s=this._selectedMarker.getAttribute("data-position"),s=parseFloat(s),s+=t.shiftKey?.05:.01,s=Math.min(s,1),this._updateSelectedMarkerPosition(s)):"Backspace"===e&&this._removeSelectedMarker())}static gradientStopsToString(t){return 1<t.length?`linear-gradient(to right,${t.map(t=>{return`${TGradientPicker.parseColorToRGBA(t.color,t.opacity)} ${Math.round(100*t.position)}%`}).join(",")})`:"transparent"}static parseColorToRGBA(t,e){t=TColorPicker.hslToRGB(t),e=!isNaN(e)&&0<=e&&e<=1?e:1;return`rgba(${t.join(",")},${e})`}static gradientToCSS(t){var e=t.type,s=t.stops.map(t=>{return`${TGradientPicker.parseColorToRGBA(t.color,t.opacity)} ${Math.round(100*t.position)}%`}).join(",");return"linear"===e?`linear-gradient(${t.angle}turn,${s})`:"radial"===e?`radial-gradient(circle at center,${s})`:void 0}}class TGradientStopSelectEvent extends CustomEvent{constructor(t){super("tGradientStopSelect"),this.stop={color:t.color,opacity:t.opacity}}}class TColorPickerPanelToggleEvent extends CustomEvent{constructor(t){super("paneltoggle"),this.isOpen=t}}class TTooltip{constructor({element:t,text:e,zIndex:s,parent:i}){this.element=t,this.text=e,this.tooltip=null,this.timeoutDuration=400,this.zIndex=s,this.timeout=null,this.parent=i,this._handleShow=this._handleShow.bind(this),this._handleHide=this._handleHide.bind(this),this._handleKeyUp=this._handleKeyUp.bind(this)}init(){this.element.addEventListener("mouseenter",this._handleShow),this.element.addEventListener("mouseleave",this._handleHide),this.element.addEventListener("focus",this._handleShow),this.element.addEventListener("blur",this._handleHide),document.addEventListener("keyup",this._handleKeyUp)}destroy(){this.element.removeEventListener("mouseenter",this._handleShow),this.element.removeEventListener("mouseleave",this._handleHide),this.element.removeEventListener("focus",this._handleShow),this.element.removeEventListener("blur",this._handleHide),document.removeEventListener("keyup",this._handleKeyUp)}_draw(t,e){var s=document.createElement("div");s.classList.add("t-tooltip"),s.innerText=this.text,s.style.position="fixed",s.style.zIndex=this.zIndex,s.style.setProperty("--x",t+"px"),s.style.setProperty("--y",e+"px"),this.parent.appendChild(s),this.tooltip=s}_remove(){this.tooltip&&this.tooltip.remove(),this.tooltip=null}_handleShow(t){var e,s;this.tooltip||(this.timeout&&window.clearTimeout(this.timeout),t="mouseenter"===t.type?this.timeoutDuration:0,e=(s=this.element.getBoundingClientRect()).left+s.width/2,s=s.top-5,this.timeout=window.setTimeout(this._draw.bind(this,e,s),t))}_handleHide(){this.timeout&&window.clearTimeout(this.timeout),this.timeout=null,this._remove()}_handleKeyUp(t){"Escape"===t.key&&t.target===this.element&&this._handleHide()}}