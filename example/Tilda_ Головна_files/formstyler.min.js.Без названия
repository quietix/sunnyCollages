!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):e(jQuery)}(function(P){function l(e,t){this.element=e,this.options=P.extend({},s,t),this.init()}function N(e){var t,s;!P(e.target).parents().hasClass("jq-selectbox")&&"OPTION"!=e.target.nodeName&&P("div.jq-selectbox.opened").length&&(e=P("div.jq-selectbox.opened"),t=P("div.jq-selectbox__search input",e),s=P("div.jq-selectbox__dropdown",e),e.find("select").data("_"+o).options.onSelectClosed.call(e),t.length&&t.val("").keyup(),s.hide().find("li.sel").addClass("selected"),e.removeClass("focused opened dropup dropdown"))}var o="styler",s={wrapper:"form",idSuffix:"-styler",filePlaceholder:"Файл не выбран",fileBrowse:"Обзор...",selectPlaceholder:"Выберите...",selectSearch:!1,selectSearchLimit:10,selectSearchNotFound:"Совпадений не найдено",selectSearchPlaceholder:"Поиск...",selectVisibleOptions:0,singleSelectzIndex:"100",selectSmartPositioning:!0,onSelectOpened:function(){},onSelectClosed:function(){},onFormStyled:function(){}};l.prototype={init:function(){function T(){var e="",t="",s="",i="";void 0!==S.attr("id")&&""!==S.attr("id")&&(e=' id="'+S.attr("id")+A.idSuffix+'"'),void 0!==S.attr("title")&&""!==S.attr("title")&&(t=' title="'+S.attr("title")+'"'),void 0!==S.attr("class")&&""!==S.attr("class")&&(s=" "+S.attr("class"));var l,o=S.data();for(l in o)""!==o[l]&&"_styler"!==l&&(i+=" data-"+l+'="'+o[l]+'"');this.id=e+i,this.title=t,this.classes=s}var e,t,s,i,l,S=P(this.element),A=this.options,I=!(!navigator.userAgent.match(/(iPad|iPhone|iPod)/i)||navigator.userAgent.match(/(Windows\sPhone)/i)),o=!(!navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/(Windows\sPhone)/i));S.is(":checkbox")?((e=function(){var e=new T,t=P("<div"+e.id+' class="jq-checkbox'+e.classes+'"'+e.title+'><div class="jq-checkbox__div"></div></div>');S.css({position:"absolute",zIndex:"-1",opacity:0,margin:0,padding:0}).after(t).prependTo(t),t.attr("unselectable","on").css({"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","-o-user-select":"none","user-select":"none",display:"inline-block",position:"relative",overflow:"hidden"}),S.is(":checked")&&t.addClass("checked"),S.is(":disabled")&&t.addClass("disabled"),t.on("click.styler",function(){return t.is(".disabled")||(S.is(":checked")?(S.prop("checked",!1),t.removeClass("checked")):(S.prop("checked",!0),t.addClass("checked")),S.change()),!1}),S.closest("label").add('label[for="'+S.attr("id")+'"]').on("click.styler",function(e){P(e.target).is("a")||(t.click(),e.preventDefault())}),S.on("change.styler",function(){S.is(":checked")?t.addClass("checked"):t.removeClass("checked")}).on("keydown.styler",function(e){32==e.which&&t.click()}).on("focus.styler",function(){t.is(".disabled")||t.addClass("focused")}).on("blur.styler",function(){t.removeClass("focused")})})(),S.on("refresh",function(){S.off(".styler").parent().before(S).remove(),e()})):S.is(":radio")?((t=function(){var e=new T,t=P("<div"+e.id+' class="jq-radio'+e.classes+'"'+e.title+'><div class="jq-radio__div"></div></div>');S.css({position:"absolute",zIndex:"-1",opacity:0,margin:0,padding:0}).after(t).prependTo(t),t.attr("unselectable","on").css({"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","-o-user-select":"none","user-select":"none",display:"inline-block",position:"relative"}),S.is(":checked")&&t.addClass("checked"),S.is(":disabled")&&t.addClass("disabled"),t.on("click.styler",function(){return t.is(".disabled")||(t.closest(A.wrapper).find('input[name="'+S.attr("name")+'"]').prop("checked",!1).parent().removeClass("checked"),S.prop("checked",!0).parent().addClass("checked"),S.change()),!1}),S.closest("label").add('label[for="'+S.attr("id")+'"]').on("click.styler",function(e){P(e.target).is("a")||(t.click(),e.preventDefault())}),S.on("change.styler",function(){S.parent().addClass("checked")}).on("focus.styler",function(){t.is(".disabled")||t.addClass("focused")}).on("blur.styler",function(){t.removeClass("focused")})})(),S.on("refresh",function(){S.off(".styler").parent().before(S).remove(),t()})):S.is(":file")?(S.css({position:"absolute",top:0,right:0,width:"100%",height:"100%",opacity:0,margin:0,padding:0}),(s=function(){var e=new T,i=S.data("placeholder");void 0===i&&(i=A.filePlaceholder);var t=S.data("browse");void 0!==t&&""!==t||(t=A.fileBrowse);var l=P("<div"+e.id+' class="jq-file'+e.classes+'"'+e.title+' style="display: inline-block; position: relative; overflow: hidden"></div>'),o=P('<div class="jq-file__name">'+i+"</div>").appendTo(l);P('<div class="jq-file__browse">'+t+"</div>").appendTo(l),S.after(l).appendTo(l),S.is(":disabled")&&l.addClass("disabled"),S.on("change.styler",function(){var e=S.val();if(S.is("[multiple]"))for(var e="",t=S[0].files,s=0;s<t.length;s++)e+=(0<s?", ":"")+t[s].name;o.text(e.replace(/.+[\\\/]/,"")),""===e?(o.text(i),l.removeClass("changed")):l.addClass("changed")}).on("focus.styler",function(){l.addClass("focused")}).on("blur.styler",function(){l.removeClass("focused")}).on("click.styler",function(){l.removeClass("focused")})})(),S.on("refresh",function(){S.off(".styler").parent().before(S).remove(),s()})):S.is('input[type="number"]')?((i=function(){var e=P('<div class="jq-number"><div class="jq-number__spin minus"></div><div class="jq-number__spin plus"></div></div>');S.after(e).prependTo(e).wrap('<div class="jq-number__field"></div>'),S.is(":disabled")&&e.addClass("disabled");var i,l,o,t=null,s=null;void 0!==S.attr("min")&&(i=S.attr("min")),void 0!==S.attr("max")&&(l=S.attr("max")),o=void 0!==S.attr("step")&&P.isNumeric(S.attr("step"))?Number(S.attr("step")):Number(1);function a(e){var t,s=S.val();P.isNumeric(s)||(s=0,S.val("0")),e.is(".minus")?(t=parseInt(s,10)-o,0<o&&(t=Math.ceil(t/o)*o)):e.is(".plus")&&(t=parseInt(s,10)+o,0<o&&(t=Math.floor(t/o)*o)),P.isNumeric(i)&&P.isNumeric(l)?i<=t&&t<=l&&S.val(t):P.isNumeric(i)&&!P.isNumeric(l)?i<=t&&S.val(t):(P.isNumeric(i)||!P.isNumeric(l)||t<=l)&&S.val(t)}e.is(".disabled")||(e.on("mousedown.styler","div.jq-number__spin",function(){var e=P(this);a(e),t=setTimeout(function(){s=setInterval(function(){a(e)},40)},350)}).on("mouseup.styler mouseout.styler","div.jq-number__spin",function(){clearTimeout(t),clearInterval(s)}),S.on("focus.styler",function(){e.addClass("focused")}).on("blur.styler",function(){e.removeClass("focused")}))})(),S.on("refresh",function(){S.off(".styler").closest(".jq-number").before(S).remove(),i()})):S.is("select")?((l=function(){function q(e){e.off("mousewheel DOMMouseScroll").on("mousewheel DOMMouseScroll",function(e){var t=null;"mousewheel"==e.type?t=-1*e.originalEvent.wheelDelta:"DOMMouseScroll"==e.type&&(t=40*e.originalEvent.detail),t&&(e.stopPropagation(),e.preventDefault(),P(this).scrollTop(t+P(this).scrollTop()))})}function j(){for(var e=0;e<_.length;e++){var t=_.eq(e),s="",i="",l=s="",o="",a="",d="",n="",r="";t.prop("selected")&&(i="selected sel"),t.is(":disabled")&&(i="disabled"),t.is(":selected:disabled")&&(i="selected sel disabled"),void 0!==t.attr("id")&&""!==t.attr("id")&&(l=' id="'+t.attr("id")+A.idSuffix+'"'),void 0!==t.attr("title")&&""!==_.attr("title")&&(o=' title="'+t.attr("title")+'"'),void 0!==t.attr("class")&&(d=" "+t.attr("class"),r=' data-jqfs-class="'+t.attr("class")+'"');var c,h=t.data();for(c in h)""!==h[c]&&(a+=" data-"+c+'="'+h[c]+'"');""!==i+d&&(s=' class="'+i+d+'"'),s="<li"+r+a+s+o+l+">"+t.html()+"</li>",t.parent().is("optgroup")&&(void 0!==t.parent().attr("class")&&(n=" "+t.parent().attr("class")),s="<li"+r+a+' class="'+i+d+" option"+n+'"'+o+l+">"+t.html()+"</li>",t.is(":first-child")&&(s='<li class="optgroup'+n+'">'+t.parent().attr("label")+"</li>"+s)),k+=s}}var _=P("option",S),k="";S.is("[multiple]")?o||I||function(){var e=new T,t=P("<div"+e.id+' class="jq-select-multiple jqselect'+e.classes+'"'+e.title+' style="display: inline-block; position: relative"></div>');S.css({margin:0,padding:0}).after(t),j(),t.append("<ul>"+k+"</ul>");var s=P("ul",t).css({position:"relative","overflow-x":"hidden","-webkit-overflow-scrolling":"touch"}),l=P("li",t).attr("unselectable","on"),e=S.attr("size"),i=s.outerHeight(),o=l.outerHeight();void 0!==e&&0<e?s.css({height:o*e}):s.css({height:4*o}),i>t.height()&&(s.css("overflowY","scroll"),q(s),l.filter(".selected").length&&s.scrollTop(s.scrollTop()+l.filter(".selected").position().top)),S.prependTo(t).css({position:"absolute",left:0,top:0,width:"100%",height:"100%",opacity:0}),S.is(":disabled")?(t.addClass("disabled"),_.each(function(){P(this).is(":selected")&&l.eq(P(this).index()).addClass("selected")})):(l.filter(":not(.disabled):not(.optgroup)").click(function(e){S.focus();var t,s,i=P(this);e.ctrlKey||e.metaKey||i.addClass("selected"),e.shiftKey||i.addClass("first"),e.ctrlKey||e.metaKey||e.shiftKey||i.siblings().removeClass("selected first"),(e.ctrlKey||e.metaKey)&&(i.is(".selected")?i.removeClass("selected first"):i.addClass("selected first"),i.siblings().removeClass("first")),e.shiftKey&&(s=t=!1,i.siblings().removeClass("selected").siblings(".first").addClass("selected"),i.prevAll().each(function(){P(this).is(".first")&&(t=!0)}),i.nextAll().each(function(){P(this).is(".first")&&(s=!0)}),t&&i.prevAll().each(function(){return!P(this).is(".selected")&&void P(this).not(".disabled, .optgroup").addClass("selected")}),s&&i.nextAll().each(function(){return!P(this).is(".selected")&&void P(this).not(".disabled, .optgroup").addClass("selected")}),1==l.filter(".selected").length&&i.addClass("first")),_.prop("selected",!1),l.filter(".selected").each(function(){var e=P(this),t=e.index();e.is(".option")&&(t-=e.prevAll(".optgroup").length),_.eq(t).prop("selected",!0)}),S.change()}),_.each(function(e){P(this).data("optionIndex",e)}),S.on("change.styler",function(){l.removeClass("selected");var t=[];_.filter(":selected").each(function(){t.push(P(this).data("optionIndex"))}),l.not(".optgroup").filter(function(e){return-1<P.inArray(e,t)}).addClass("selected")}).on("focus.styler",function(){t.addClass("focused")}).on("blur.styler",function(){t.removeClass("focused")}),i>t.height()&&S.on("keydown.styler",function(e){38!=e.which&&37!=e.which&&33!=e.which||s.scrollTop(s.scrollTop()+l.filter(".selected").position().top-o),40!=e.which&&39!=e.which&&34!=e.which||s.scrollTop(s.scrollTop()+l.filter(".selected:last").position().top-s.innerHeight()+2*o)}))}():function(){var e=new T,t="",s=S.data("placeholder"),i=S.data("search"),l=S.data("search-limit"),o=S.data("search-not-found"),a=S.data("search-placeholder"),d=S.data("z-index"),n=S.data("smart-positioning");void 0===s&&(s=A.selectPlaceholder),void 0!==i&&""!==i||(i=A.selectSearch),void 0!==l&&""!==l||(l=A.selectSearchLimit),void 0!==o&&""!==o||(o=A.selectSearchNotFound),void 0===a&&(a=A.selectSearchPlaceholder),void 0!==d&&""!==d||(d=A.singleSelectzIndex),void 0!==n&&""!==n||(n=A.selectSmartPositioning);var r=P("<div"+e.id+' class="jq-selectbox jqselect'+e.classes+'" style="display: inline-block; position: relative; z-index:'+d+'"><div class="jq-selectbox__select"'+e.title+' style="position: relative"><div class="jq-selectbox__select-text"></div><div class="jq-selectbox__trigger"><div class="jq-selectbox__trigger-arrow"></div></div></div></div>');S.css({margin:0,padding:0}).after(r).prependTo(r);var c=P("div.jq-selectbox__select",r),h=P("div.jq-selectbox__select-text",r),e=_.filter(":selected");j(),i&&(t='<div class="jq-selectbox__search"><input type="search" autocomplete="off" placeholder="'+a+'"></div><div class="jq-selectbox__not-found">'+o+"</div>");var p=P('<div class="jq-selectbox__dropdown" style="position: absolute">'+t+'<ul style="position: relative; list-style: none; overflow: auto; overflow-x: hidden">'+k+"</ul></div>");r.append(p);var f=P("ul",p),u=P("li",p),v=P("input",p),m=P("div.jq-selectbox__not-found",p).hide();u.length<l&&v.parent().hide(),""===S.val()?h.text(s).addClass("placeholder"):h.text(e.text());var g=0,b=0;u.each(function(){var e=P(this);e.css({display:"inline-block"}),e.innerWidth()>g&&(g=e.innerWidth(),b=e.width()),e.css({display:""})}),h.is(".placeholder")&&h.width()>g?h.width(h.width()):(i=(t=r.clone().appendTo("body").width("auto")).outerWidth(),t.remove(),i==r.outerWidth()&&h.width(b)),g>r.width()&&p.width(g),""===_.first().text()&&""!==S.data("placeholder")&&u.first().hide(),S.css({position:"absolute",left:0,top:0,width:"100%",height:"100%",opacity:0});var y=r.outerHeight(),C=v.outerHeight(),w=f.css("max-height");(t=u.filter(".selected")).length<1&&u.first().addClass("selected sel"),void 0===u.data("li-height")&&u.data("li-height",u.outerHeight());var x=p.css("top");if("auto"==p.css("left")&&p.css({left:0}),"auto"==p.css("top")&&p.css({top:y}),p.hide(),t.length&&(_.first().text()!=e.text()&&r.addClass("changed"),r.data("jqfs-class",t.data("jqfs-class")),r.addClass(t.data("jqfs-class"))),S.is(":disabled"))return r.addClass("disabled");c.click(function(){if(P("div.jq-selectbox").filter(".opened").length&&A.onSelectClosed.call(P("div.jq-selectbox").filter(".opened")),S.focus(),!I){var t=P(window),s=u.data("li-height"),i=r.offset().top,l=t.height()-y-(i-t.scrollTop());void 0!==(a=S.data("visible-options"))&&""!==a||(a=A.selectVisibleOptions);var e=5*s,o=s*a;0<a&&a<6&&(e=o),0===a&&(o="auto");var a=function(){p.height("auto").css({bottom:"auto",top:x});function e(){f.css("max-height",Math.floor((l-20-C)/s)*s)}e(),f.css("max-height",o),"none"!=w&&f.css("max-height",w),l<p.outerHeight()+20&&e()};return!0===n||1===n?e+C+20<l?(a(),r.removeClass("dropup").addClass("dropdown")):(function(){p.height("auto").css({top:"auto",bottom:x});function e(){f.css("max-height",Math.floor((i-t.scrollTop()-20-C)/s)*s)}e(),f.css("max-height",o),"none"!=w&&f.css("max-height",w),i-t.scrollTop()-20<p.outerHeight()+20&&e()}(),r.removeClass("dropdown").addClass("dropup")):(!1===n||0===n)&&e+C+20<l&&(a(),r.removeClass("dropup").addClass("dropdown")),r.offset().left+p.outerWidth()>t.width()&&p.css({left:"auto",right:0}),P("div.jqselect").css({zIndex:d-1}).removeClass("opened"),r.css({zIndex:d}),p.is(":hidden")?(P("div.jq-selectbox__dropdown:visible").hide(),p.show(),r.addClass("opened focused"),A.onSelectOpened.call(r)):(p.hide(),r.removeClass("opened dropup dropdown"),P("div.jq-selectbox").filter(".opened").length&&A.onSelectClosed.call(r)),v.length&&(v.val("").keyup(),m.hide(),v.keyup(function(){var e=P(this).val();u.each(function(){P(this).html().match(RegExp(".*?"+e+".*?","i"))?P(this).show():P(this).hide()}),""===_.first().text()&&""!==S.data("placeholder")&&u.first().hide(),u.filter(":visible").length<1?m.show():m.hide()})),u.filter(".selected").length&&(""===S.val()?f.scrollTop(0):(0!=f.innerHeight()/s%2&&(s/=2),f.scrollTop(f.scrollTop()+u.filter(".selected").position().top-f.innerHeight()/2+s))),q(f),!1}}),u.hover(function(){P(this).siblings().removeClass("selected")}),u.filter(".selected").text(),u.filter(":not(.disabled):not(.optgroup)").click(function(){S.focus();var e,t=P(this),s=t.text();t.is(".selected")||(e=(e=t.index())-t.prevAll(".optgroup").length,t.addClass("selected sel").siblings().removeClass("selected sel"),_.prop("selected",!1).eq(e).prop("selected",!0),h.text(s),r.data("jqfs-class")&&r.removeClass(r.data("jqfs-class")),r.data("jqfs-class",t.data("jqfs-class")),r.addClass(t.data("jqfs-class")),S.change()),p.hide(),r.removeClass("opened dropup dropdown"),A.onSelectClosed.call(r)}),p.mouseout(function(){P("li.sel",p).addClass("selected")}),S.on("change.styler",function(){h.text(_.filter(":selected").text()).removeClass("placeholder"),u.removeClass("selected sel").not(".optgroup").eq(S[0].selectedIndex).addClass("selected sel"),_.first().text()!=u.filter(".selected").text()?r.addClass("changed"):r.removeClass("changed")}).on("focus.styler",function(){r.addClass("focused"),P("div.jqselect").not(".focused").removeClass("opened dropup dropdown").find("div.jq-selectbox__dropdown").hide()}).on("blur.styler",function(){r.removeClass("focused")}).on("keydown.styler keyup.styler",function(e){var t=u.data("li-height");""===S.val()?h.text(s).addClass("placeholder"):h.text(_.filter(":selected").text()),u.removeClass("selected sel").not(".optgroup").eq(S[0].selectedIndex).addClass("selected sel"),38!=e.which&&37!=e.which&&33!=e.which&&36!=e.which||(""===S.val()?f.scrollTop(0):f.scrollTop(f.scrollTop()+u.filter(".selected").position().top)),40!=e.which&&39!=e.which&&34!=e.which&&35!=e.which||f.scrollTop(f.scrollTop()+u.filter(".selected").position().top-f.innerHeight()+t),13==e.which&&(e.preventDefault(),p.hide(),r.removeClass("opened dropup dropdown"),A.onSelectClosed.call(r))}).on("keydown.styler",function(e){32==e.which&&(e.preventDefault(),c.click())}),N.registered||(P(document).on("click",N),N.registered=!0)}()})(),S.on("refresh",function(){S.off(".styler").parent().before(S).remove(),l()})):S.is(":reset")&&S.on("click",function(){setTimeout(function(){S.closest(A.wrapper).find("input, select").trigger("refresh")},1)})},destroy:function(){var e=P(this.element);e.is(":checkbox")||e.is(":radio")?(e.removeData().off(".styler").removeAttr("style").parent().before(e).remove(),e.closest("label").add('label[for="'+e.attr("id")+'"]').off(".styler")):e.is('input[type="number"]')?e.removeData().off(".styler").closest(".jq-number").before(e).remove():(e.is(":file")||e.is("select"))&&e.removeData().off(".styler").removeAttr("style").parent().before(e).remove()}},P.fn[o]=function(t){var s,i=arguments;return void 0===t||"object"==typeof t?this.each(function(){P.data(this,"_"+o)||P.data(this,"_"+o,new l(this,t))}).promise().done(function(){var e=P(this[0]).data("_"+o);e&&e.options.onFormStyled.call()}):"string"==typeof t&&"_"!==t[0]&&"init"!==t?(this.each(function(){var e=P.data(this,"_"+o);e instanceof l&&"function"==typeof e[t]&&(s=e[t].apply(e,Array.prototype.slice.call(i,1)))}),void 0!==s?s:this):void 0},N.registered=!1});
