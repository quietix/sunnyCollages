(function($)
{'use strict';if(!Function.prototype.bind)
{Function.prototype.bind=function(scope)
{var fn=this;return function()
{return fn.apply(scope)}}}
var uuid=0;var reUrlYoutube=/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.\-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/ig;var reUrlVimeo=/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/;$.fn.redactor=function(options)
{var val=[];var args=Array.prototype.slice.call(arguments,1);if(typeof options==='string')
{this.each(function()
{var instance=$.data(this,'redactor');var func;if(options.search(/\./)!='-1')
{func=options.split('.');if(typeof instance[func[0]]!='undefined')
{func=instance[func[0]][func[1]]}}
else{func=instance[options]}
if(typeof instance!=='undefined'&&$.isFunction(func))
{var methodVal=func.apply(instance,args);if(methodVal!==undefined&&methodVal!==instance)
{val.push(methodVal)}}
else{$.error('No such method "'+options+'" for Redactor')}})}
else{this.each(function()
{$.data(this,'redactor',{});$.data(this,'redactor',Redactor(this,options))})}
if(val.length===0){return this}
else{if(val.length===1){return val[0]}
else{return val}}};function Redactor(el,options)
{return new Redactor.prototype.init(el,options)}
$.Redactor=Redactor;$.Redactor.VERSION='10.0.5';$.Redactor.modules=['alignment','autosave','block','buffer','build','button','caret','clean','code','core','dropdown','file','focus','image','indent','inline','insert','keydown','keyup','lang','line','link','list','modal','observe','paragraphize','paste','placeholder','progress','selection','shortcuts','tabifier','tidy','toolbar','upload','utils'];$.Redactor.opts={lang:'en',direction:'ltr',plugins:!1,focus:!1,focusEnd:!1,placeholder:!1,visual:!0,tabindex:!1,minHeight:!1,maxHeight:!1,linebreaks:!1,replaceDivs:!0,paragraphize:!0,cleanStyleOnEnter:!1,enterKey:!0,cleanOnPaste:!0,cleanSpaces:!0,pastePlainText:!1,autosave:!1,autosaveName:!1,autosaveInterval:60,autosaveOnChange:!1,linkTooltip:!0,linkProtocol:'http',linkNofollow:!1,linkSize:50,imageEditable:!0,imageLink:!0,imagePosition:!0,imageFloatMargin:'10px',imageResizable:!0,imageUpload:!1,imageUploadParam:'file',uploadImageField:!1,dragImageUpload:!0,fileUpload:!1,fileUploadParam:'file',dragFileUpload:!0,s3:!1,convertLinks:!0,convertUrlLinks:!0,convertImageLinks:!0,convertVideoLinks:!0,preSpaces:4,tabAsSpaces:!1,tabFocus:!0,scrollTarget:!1,toolbar:!0,toolbarFixed:!0,toolbarFixedTarget:document,toolbarFixedTopOffset:0,toolbarExternal:!1,toolbarOverflow:!1,buttonSource:!1,buttons:['html','formatting','bold','italic','deleted','unorderedlist','orderedlist','outdent','indent','image','file','link','alignment','horizontalrule'],buttonsHide:[],buttonsHideOnMobile:[],formatting:['p','blockquote','pre','h1','h2','h3','h4','h5','h6'],formattingAdd:!1,tabifier:!0,deniedTags:['html','head','link','body','meta','script','style','applet'],allowedTags:!1,removeComments:!1,replaceTags:[['strike','del']],replaceStyles:[['font-weight:\\s?bold',"strong"],['font-style:\\s?italic',"em"],['text-decoration:\\s?underline',"u"],['text-decoration:\\s?line-through','del']],removeDataAttr:!1,removeAttr:!1,allowedAttr:!1,removeWithoutAttr:['span'],removeEmpty:['p'],activeButtons:['deleted','italic','bold','underline','unorderedlist','orderedlist','alignleft','aligncenter','alignright','justify'],activeButtonsStates:{b:'bold',strong:'bold',i:'italic',em:'italic',del:'deleted',strike:'deleted',ul:'unorderedlist',ol:'orderedlist',u:'underline'},shortcuts:{'ctrl+shift+m, meta+shift+m':{func:'inline.removeFormat'},'ctrl+b, meta+b':{func:'inline.format',params:['bold']},'ctrl+i, meta+i':{func:'inline.format',params:['italic']},'ctrl+h, meta+h':{func:'inline.format',params:['superscript']},'ctrl+l, meta+l':{func:'inline.format',params:['subscript']},'ctrl+k, meta+k':{func:'link.show'},'ctrl+shift+7':{func:'list.toggle',params:['orderedlist']},'ctrl+shift+8':{func:'list.toggle',params:['unorderedlist']}},shortcutsAdd:!1,buffer:[],rebuffer:[],emptyHtml:'<p>&#x200b;</p>',invisibleSpace:'&#x200b;',imageTypes:['image/png','image/jpeg','image/gif'],indentValue:20,verifiedTags:['img','b','strong','sub','sup','i','em','u','small','strike','del','cite','ul','ol','li'],inlineTags:['strong','b','u','em','i','code','del','ins','samp','kbd','sup','sub','mark','var','cite','small'],alignmentTags:['P','H1','H2','H3','H4','H5','H6','DL','DT','DD','DIV','TD','BLOCKQUOTE','OUTPUT','FIGCAPTION','ADDRESS','SECTION','HEADER','FOOTER','ASIDE','ARTICLE'],blockLevelElements:['PRE','UL','OL','LI'],langs:{en:{html:'HTML',video:'Insert Video',image:'Insert Image',table:'Table',link:'Link',link_insert:'Insert link',link_edit:'Edit link',unlink:'Unlink',formatting:'Formatting',paragraph:'Normal text',quote:'Quote',code:'Code',header1:'Header 1',header2:'Header 2',header3:'Header 3',header4:'Header 4',header5:'Header 5',bold:'Bold',italic:'Italic',fontcolor:'Font Color',backcolor:'Back Color',unorderedlist:'Unordered List',orderedlist:'Ordered List',outdent:'Outdent',indent:'Indent',cancel:'Cancel',insert:'Insert',save:'Save',_delete:'Delete',insert_table:'Insert Table',insert_row_above:'Add Row Above',insert_row_below:'Add Row Below',insert_column_left:'Add Column Left',insert_column_right:'Add Column Right',delete_column:'Delete Column',delete_row:'Delete Row',delete_table:'Delete Table',rows:'Rows',columns:'Columns',add_head:'Add Head',delete_head:'Delete Head',title:'Title',image_position:'Position',none:'None',left:'Left',right:'Right',center:'Center',image_web_link:'Image Web Link',text:'Text',mailto:'Email',web:'URL',video_html_code:'Video Embed Code or Youtube/Vimeo Link',file:'Insert File',upload:'Upload',download:'Download',choose:'Choose',or_choose:'Or choose',drop_file_here:'Drop file here',align_left:'Align text to the left',align_center:'Center text',align_right:'Align text to the right',align_justify:'Justify text',horizontalrule:'Insert Horizontal Rule',deleted:'Deleted',anchor:'Anchor',link_new_tab:'Open link in new tab',underline:'Underline',alignment:'Alignment',filename:'Name (optional)',edit:'Edit',link_color:'Color link',link_color_underline:'Color link line',link_line_size:'Line size',link_hint_color:'You can customize link colors for the whole website in the Site Settings.',link_nofollow:'Rel nofollow'},ru:{html:'HTML',video:'Вставить видео',image:'Вставить изображение',table:'Таблица',link:'Ссылка',link_insert:'Вставить ссылку',link_edit:'Редактировать ссылку',unlink:'Убрать ссылку',formatting:'Форматирование',paragraph:'Нормальный текст',quote:'Цитата',code:'Код',header1:'Заголовок 1',header2:'Заголовок 2',header3:'Заголовок 3',header4:'Заголовок 4',header5:'Заголовок 5',bold:'Жирный',italic:'Курсив',fontcolor:'Цвет текста',backcolor:'Цвет фона',unorderedlist:'Несортированный список',orderedlist:'Нумерной список',outdent:'Outdent',indent:'Indent',cancel:'Отмена',insert:'Вставка',save:'Сохранить',_delete:'Удалить',insert_table:'Вставить таблицу',insert_row_above:'Добавить строку выше',insert_row_below:'Добавить строку ниже',insert_column_left:'Добавить столбец слева',insert_column_right:'Добавить столбец справа',delete_column:'Удалить столбец',delete_row:'Удалить строку',delete_table:'Удалить таблицу',rows:'Строки',columns:'Колонки',add_head:'Добавить шапку',delete_head:'Удалить шапку',title:'Заголовок',image_position:'Позиция',none:'Пусто',left:'Лево',right:'Право',center:'Центр',image_web_link:'Ссылка на изображение',text:'Текст',mailto:'Email',web:'URL',video_html_code:'Video Embed Code or Youtube/Vimeo Link',file:'Вставить файл',upload:'Загрузить',download:'Скачать',choose:'Выбрать',or_choose:'Или выбрать',drop_file_here:'Бросить файл здесь',align_left:'Выровнять текст влево',align_center:'Выровнять текст по центру',align_right:'Выровнять текст вправо',align_justify:'Текст по ширине',horizontalrule:'Вставить горизонтальный разделитель',deleted:'Зачеркнуто',anchor:'Якорь',link_new_tab:'Открыть ссылку в новой вкладке',underline:'Подчеркивание',alignment:'Выравнивание',filename:'Имя файла (необязательно)',edit:'Редактировать',link_color:'Цвет ссылки',link_color_underline:'Цвет линии',link_line_size:'Размер линии',link_hint_color:'Цвет ссылок для всего сайта можно задать в настройках сайта.',link_nofollow:'Rel nofollow: ссылка не передает вес странице на которую ссылается'}}};Redactor.fn=$.Redactor.prototype={keyCode:{BACKSPACE:8,DELETE:46,DOWN:40,ENTER:13,SPACE:32,ESC:27,TAB:9,CTRL:17,META:91,SHIFT:16,ALT:18,LEFT:37,LEFT_WIN:91},init:function(el,options)
{this.$element=$(el);this.uuid=uuid++;this.rtePaste=!1;this.$pasteBox=!1;this.loadOptions(options);this.loadModules();this.formatting={};$.merge(this.opts.blockLevelElements,this.opts.alignmentTags);this.reIsBlock=new RegExp('^('+this.opts.blockLevelElements.join('|')+')$','i');this.tidy.setupAllowed();this.lang.load();$.extend(this.opts.shortcuts,this.opts.shortcutsAdd);this.core.setCallback('start');this.start=!0;this.build.run()},loadOptions:function(options)
{this.opts=$.extend({},$.extend(!0,{},$.Redactor.opts),this.$element.data(),options)},getModuleMethods:function(object)
{return Object.getOwnPropertyNames(object).filter(function(property)
{return typeof object[property]=='function'})},loadModules:function()
{var len=$.Redactor.modules.length;for(var i=0;i<len;i++)
{this.bindModuleMethods($.Redactor.modules[i])}},bindModuleMethods:function(module)
{if(typeof this[module]=='undefined'){return}
this[module]=this[module]();var methods=this.getModuleMethods(this[module]);var len=methods.length;for(var z=0;z<len;z++)
{this[module][methods[z]]=this[module][methods[z]].bind(this)}},alignment:function()
{return{left:function()
{this.alignment.set('')},right:function()
{this.alignment.set('right')},center:function()
{this.alignment.set('center')},justify:function()
{this.alignment.set('justify')},set:function(type)
{if(!this.utils.browser('msie')){this.$editor.focus()}
this.buffer.set();this.selection.save();this.alignment.blocks=this.selection.getBlocks();if(this.opts.linebreaks&&this.alignment.blocks[0]===!1)
{this.alignment.setText(type)}
else{this.alignment.setBlocks(type)}
this.selection.restore();this.code.sync()},setText:function(type)
{var wrapper=this.selection.wrap('div');$(wrapper).attr('data-tagblock','redactor');$(wrapper).css('text-align',type)},setBlocks:function(type)
{$.each(this.alignment.blocks,$.proxy(function(i,el)
{var $el=this.utils.getAlignmentElement(el);if(!$el){return}
if(type===''&&typeof($el.data('tagblock'))!=='undefined')
{$el.replaceWith($el.html())}
else{$el.css('text-align',type);this.utils.removeEmptyAttr($el,'style')}},this))}}},autosave:function()
{return{enable:function()
{if(!this.opts.autosave){return}
this.autosave.html=!1;this.autosave.name=(this.opts.autosaveName)?this.opts.autosaveName:this.$textarea.attr('name');if(!this.opts.autosaveOnChange)
{this.autosaveInterval=setInterval($.proxy(this.autosave.load,this),this.opts.autosaveInterval*1000)}},onChange:function()
{if(!this.opts.autosaveOnChange){return}
this.autosave.load()},load:function()
{var html=this.code.get();if(this.autosave.html===html){return}
if(this.utils.isEmpty(html)){return}
$.ajax({url:this.opts.autosave,type:'post',data:'name='+this.autosave.name+'&'+this.autosave.name+'='+escape(encodeURIComponent(html)),success:$.proxy(function(data)
{this.autosave.success(data,html)},this)})},success:function(data,html)
{var json;try
{json=$.parseJSON(data)}
catch(e)
{json=data}
var callbackName=(typeof json.error=='undefined')?'autosave':'autosaveError';this.core.setCallback(callbackName,this.autosave.name,json);this.autosave.html=html},disable:function()
{clearInterval(this.autosaveInterval)}}},block:function()
{return{formatting:function(name)
{var type,value;if(typeof this.formatting[name].data!='undefined'){type='data'}
else{if(typeof this.formatting[name].attr!='undefined'){type='attr'}
else{if(typeof this.formatting[name].class!='undefined'){type='class'}}}
if(type){value=this.formatting[name][type]}
this.block.format(this.formatting[name].tag,type,value)},format:function(tag,type,value)
{if(tag=='quote'){tag='blockquote'}
var formatTags=['p','pre','blockquote','h1','h2','h3','h4','h5','h6'];if($.inArray(tag,formatTags)==-1){return}
this.block.isRemoveInline=(tag=='pre'||tag.search(/h[1-6]/i)!=-1);if(!this.utils.browser('msie')){this.$editor.focus()}
this.block.blocks=this.selection.getBlocks();this.block.blocksSize=this.block.blocks.length;this.block.type=type;this.block.value=value;this.buffer.set();this.selection.save();this.block.set(tag);this.selection.restore();this.code.sync()},set:function(tag)
{this.selection.get();this.block.containerTag=this.range.commonAncestorContainer.tagName;if(this.range.collapsed)
{this.block.setCollapsed(tag)}
else{this.block.setMultiple(tag)}},setCollapsed:function(tag)
{var block=this.block.blocks[0];if(block===!1){return}
if(block.tagName=='LI')
{if(tag!='blockquote'){return}
this.block.formatListToBlockquote();return}
var isContainerTable=(this.block.containerTag=='TD'||this.block.containerTag=='TH');if(isContainerTable&&!this.opts.linebreaks)
{document.execCommand('formatblock',!1,'<'+tag+'>');block=this.selection.getBlock();this.block.toggle($(block))}
else{if(block.tagName.toLowerCase()!=tag)
{if(this.opts.linebreaks&&tag=='p')
{$(block).prepend('<br>').append('<br>');this.utils.replaceWithContents(block)}
else{var $formatted=this.utils.replaceToTag(block,tag);this.block.toggle($formatted);if(tag!='p'&&tag!='blockquote'){$formatted.find('img').remove()}
if(this.block.isRemoveInline){this.utils.removeInlineTags($formatted)}
if(tag=='p'||this.block.headTag){$formatted.find('p').contents().unwrap()}
this.block.formatTableWrapping($formatted)}}
else{if(tag=='blockquote'&&block.tagName.toLowerCase()==tag)
{if(this.opts.linebreaks)
{$(block).prepend('<br>').append('<br>');this.utils.replaceWithContents(block)}
else{var $el=this.utils.replaceToTag(block,'p');this.block.toggle($el)}}
else{if(block.tagName.toLowerCase()==tag)
{this.block.toggle($(block))}}}}},setMultiple:function(tag)
{var block=this.block.blocks[0];var isContainerTable=(this.block.containerTag=='TD'||this.block.containerTag=='TH');if(block!==!1&&this.block.blocksSize===1)
{if(block.tagName.toLowerCase()==tag&&tag=='blockquote')
{if(this.opts.linebreaks)
{$(block).prepend('<br>').append('<br>');this.utils.replaceWithContents(block)}
else{var $el=this.utils.replaceToTag(block,'p');this.block.toggle($el)}}
else{if(block.tagName=='LI')
{if(tag!='blockquote'){return}
this.block.formatListToBlockquote()}
else{if(this.block.containerTag=='BLOCKQUOTE')
{this.block.formatBlockquote(tag)}
else{if(this.opts.linebreaks&&((isContainerTable)||(this.range.commonAncestorContainer!=block)))
{this.block.formatWrap(tag)}
else{if(this.opts.linebreaks&&tag=='p')
{$(block).prepend('<br>').append('<br>');this.utils.replaceWithContents(block)}
else{if(block.tagName==='TD')
{this.block.formatWrap(tag)}
else{var $formatted=this.utils.replaceToTag(block,tag);this.block.toggle($formatted);if(this.block.isRemoveInline){this.utils.removeInlineTags($formatted)}
if(tag=='p'||this.block.headTag){$formatted.find('p').contents().unwrap()}}}}}}}}
else{if(this.opts.linebreaks||tag!='p')
{if(tag=='blockquote')
{var count=0;for(var i=0;i<this.block.blocksSize;i++)
{if(this.block.blocks[i].tagName=='BLOCKQUOTE')count++}
if(count==this.block.blocksSize)
{$.each(this.block.blocks,$.proxy(function(i,s)
{if(this.opts.linebreaks)
{$(s).prepend('<br>').append('<br>');this.utils.replaceWithContents(s)}
else{this.utils.replaceToTag(s,'p')}},this));return}}
this.block.formatWrap(tag)}
else{var classSize=0;var toggleType=!1;if(this.block.type=='class')
{toggleType='toggle';classSize=$(this.block.blocks).filter('.'+this.block.value).size();if(this.block.blocksSize==classSize){toggleType='toggle'}
else{if(this.block.blocksSize>classSize){toggleType='set'}
else{if(classSize===0){toggleType='set'}}}}
var exceptTags=['ul','ol','li','td','th','dl','dt','dd'];$.each(this.block.blocks,$.proxy(function(i,s)
{if($.inArray(s.tagName.toLowerCase(),exceptTags)!=-1){return}
var $formatted=this.utils.replaceToTag(s,tag);if(toggleType)
{if(toggleType=='toggle'){this.block.toggle($formatted)}
else{if(toggleType=='remove'){this.block.remove($formatted)}
else{if(toggleType=='set'){this.block.setForce($formatted)}}}}
else{this.block.toggle($formatted)}
if(tag!='p'&&tag!='blockquote'){$formatted.find('img').remove()}
if(this.block.isRemoveInline){this.utils.removeInlineTags($formatted)}
if(tag=='p'||this.block.headTag){$formatted.find('p').contents().unwrap()}},this))}}},setForce:function($el)
{if(this.block.type=='class')
{$el.addClass(this.block.value);return}
else{if(this.block.type=='attr'||this.block.type=='data')
{$el.attr(this.block.value.name,this.block.value.value);return}}},toggle:function($el)
{if(this.block.type=='class')
{$el.toggleClass(this.block.value);return}
else{if(this.block.type=='attr'||this.block.type=='data')
{if($el.attr(this.block.value.name)==this.block.value.value)
{$el.removeAttr(this.block.value.name)}
else{$el.attr(this.block.value.name,this.block.value.value)}
return}
else{$el.removeAttr('style class');return}}},remove:function($el)
{$el.removeClass(this.block.value)},formatListToBlockquote:function()
{var block=$(this.block.blocks[0]).closest('ul, ol');$(block).find('ul, ol').contents().unwrap();$(block).find('li').append($('<br>')).contents().unwrap();var $el=this.utils.replaceToTag(block,'blockquote');this.block.toggle($el)},formatBlockquote:function(tag)
{document.execCommand('outdent');document.execCommand('formatblock',!1,tag);this.clean.clearUnverified();this.$editor.find('p:empty').remove();var formatted=this.selection.getBlock();if(tag!='p')
{$(formatted).find('img').remove()}
if(!this.opts.linebreaks)
{this.block.toggle($(formatted))}
this.$editor.find('ul, ol, tr, blockquote, p').each($.proxy(this.utils.removeEmpty,this));if(this.opts.linebreaks&&tag=='p')
{this.utils.replaceWithContents(formatted)}},formatWrap:function(tag)
{if(this.block.containerTag=='UL'||this.block.containerTag=='OL')
{if(tag=='blockquote')
{this.block.formatListToBlockquote()}
else{return}}
var formatted=this.selection.wrap(tag);if(formatted===!1){return}
var $formatted=$(formatted);this.block.formatTableWrapping($formatted);var $elements=$formatted.find(this.opts.blockLevelElements.join(',')+', td, table, thead, tbody, tfoot, th, tr');if((this.opts.linebreaks&&tag=='p')||tag=='pre'||tag=='blockquote')
{$elements.append('<br />')}
$elements.contents().unwrap();if(tag!='p'&&tag!='blockquote'){$formatted.find('img').remove()}
$.each(this.block.blocks,$.proxy(this.utils.removeEmpty,this));$formatted.append(this.selection.getMarker(2));if(!this.opts.linebreaks)
{this.block.toggle($formatted)}
this.$editor.find('ul, ol, tr, blockquote, p').each($.proxy(this.utils.removeEmpty,this));$formatted.find('blockquote:empty').remove();if(this.block.isRemoveInline)
{this.utils.removeInlineTags($formatted)}
if(this.opts.linebreaks&&tag=='p')
{this.utils.replaceWithContents($formatted)}},formatTableWrapping:function($formatted)
{if($formatted.closest('table').size()===0){return}
if($formatted.closest('tr').size()===0){$formatted.wrap('<tr>')}
if($formatted.closest('td').size()===0&&$formatted.closest('th').size()===0)
{$formatted.wrap('<td>')}},removeData:function(name,value)
{var blocks=this.selection.getBlocks();$(blocks).removeAttr('data-'+name);this.code.sync()},setData:function(name,value)
{var blocks=this.selection.getBlocks();$(blocks).attr('data-'+name,value);this.code.sync()},toggleData:function(name,value)
{var blocks=this.selection.getBlocks();$.each(blocks,function()
{if($(this).attr('data-'+name))
{$(this).removeAttr('data-'+name)}
else{$(this).attr('data-'+name,value)}})},removeAttr:function(attr,value)
{var blocks=this.selection.getBlocks();$(blocks).removeAttr(attr);this.code.sync()},setAttr:function(attr,value)
{var blocks=this.selection.getBlocks();$(blocks).attr(attr,value);this.code.sync()},toggleAttr:function(attr,value)
{var blocks=this.selection.getBlocks();$.each(blocks,function()
{if($(this).attr(name))
{$(this).removeAttr(name)}
else{$(this).attr(name,value)}})},removeClass:function(className)
{var blocks=this.selection.getBlocks();$(blocks).removeClass(className);this.utils.removeEmptyAttr(blocks,'class');this.code.sync()},setClass:function(className)
{var blocks=this.selection.getBlocks();$(blocks).addClass(className);this.code.sync()},toggleClass:function(className)
{var blocks=this.selection.getBlocks();$(blocks).toggleClass(className);this.code.sync()}}},buffer:function()
{return{set:function(type)
{if(typeof type=='undefined'||type=='undo')
{this.buffer.setUndo()}
else{this.buffer.setRedo()}},setUndo:function()
{this.selection.save();this.opts.buffer.push(this.$editor.html());this.selection.restore()},setRedo:function()
{this.selection.save();this.opts.rebuffer.push(this.$editor.html());this.selection.restore()},getUndo:function()
{this.$editor.html(this.opts.buffer.pop())},getRedo:function()
{this.$editor.html(this.opts.rebuffer.pop())},add:function()
{this.opts.buffer.push(this.$editor.html())},undo:function()
{if(this.opts.buffer.length===0){return}
this.buffer.set('redo');this.buffer.getUndo();this.selection.restore();setTimeout($.proxy(this.observe.load,this),50)},redo:function()
{if(this.opts.rebuffer.length===0){return}
this.buffer.set('undo');this.buffer.getRedo();this.selection.restore();setTimeout($.proxy(this.observe.load,this),50)}}},build:function()
{return{run:function()
{this.build.createContainerBox();this.build.loadContent();this.build.loadEditor();this.build.enableEditor();this.build.setCodeAndCall()},isTextarea:function()
{return(this.$element[0].tagName==='TEXTAREA')},createContainerBox:function()
{this.$box=$('<div class="redactor-box" />')},createTextarea:function()
{this.$textarea=$('<textarea />').attr('name',this.build.getTextareaName())},getTextareaName:function()
{var name=this.$element.attr('id');if(typeof(name)=='undefined')
{name='content-'+this.uuid}
return name},loadContent:function()
{var func=(this.build.isTextarea())?'val':'html';this.content=$.trim(this.$element[func]())},enableEditor:function()
{this.$editor.attr({'contenteditable':!0,'dir':this.opts.direction})},loadEditor:function()
{var func=(this.build.isTextarea())?'fromTextarea':'fromElement';this.build[func]()},fromTextarea:function()
{this.$editor=$('<div />');this.$textarea=this.$element;this.$box.insertAfter(this.$element).append(this.$editor).append(this.$element);this.$editor.addClass('redactor-editor');this.$element.hide()},fromElement:function()
{this.$editor=this.$element;this.build.createTextarea();this.$box.insertAfter(this.$editor).append(this.$editor).append(this.$textarea);this.$editor.addClass('redactor-editor');this.$textarea.hide()},setCodeAndCall:function()
{this.code.set(this.content);this.build.setOptions();this.build.callEditor();if(!this.opts.visual)
{setTimeout($.proxy(this.code.showCode,this),200)}},callEditor:function()
{this.build.disableMozillaEditing();this.build.setEvents();this.build.setHelpers();if(this.opts.toolbar)
{this.opts.toolbar=this.toolbar.init();this.toolbar.build()}
this.modal.loadTemplates();this.build.plugins();setTimeout($.proxy(this.observe.load,this),4);this.core.setCallback('init')},setOptions:function()
{$(this.$textarea).attr('dir',this.opts.direction);if(this.opts.linebreaks){this.$editor.addClass('redactor-linebreaks')}
if(this.opts.tabindex){this.$editor.attr('tabindex',this.opts.tabindex)}
if(this.opts.minHeight){this.$editor.css('minHeight',this.opts.minHeight)}
if(this.opts.maxHeight){this.$editor.css('maxHeight',this.opts.maxHeight)}},setEvents:function()
{this.$editor.on('drop.redactor',$.proxy(function(e)
{e=e.originalEvent||e;if(window.FormData===undefined||!e.dataTransfer){return!0}
var length=e.dataTransfer.files.length;if(length===0)
{this.code.sync();setTimeout($.proxy(this.clean.clearUnverified,this),1);this.core.setCallback('drop',e);return!0}
else{e.preventDefault();if(this.opts.dragImageUpload||this.opts.dragFileUpload)
{var files=e.dataTransfer.files;this.upload.directUpload(files[0],e)}}
setTimeout($.proxy(this.clean.clearUnverified,this),1);this.core.setCallback('drop',e)},this));this.$editor.on('click.redactor',$.proxy(function(e)
{var type='click';if((this.core.getEvent()=='click'||this.core.getEvent()=='arrow'))
{type=!1}
this.core.addEvent(type);this.utils.disableSelectAll();this.core.setCallback('click',e)},this));this.$editor.on('paste.redactor',$.proxy(this.paste.init,this));this.$editor.on('keydown.redactor',$.proxy(this.keydown.init,this));this.$editor.on('keyup.redactor',$.proxy(this.keyup.init,this));if($.isFunction(this.opts.codeKeydownCallback))
{this.$textarea.on('keydown.redactor-textarea',$.proxy(this.opts.codeKeydownCallback,this))}
if($.isFunction(this.opts.codeKeyupCallback))
{this.$textarea.on('keyup.redactor-textarea',$.proxy(this.opts.codeKeyupCallback,this))}
if($.isFunction(this.opts.focusCallback))
{this.$editor.on('focus.redactor',$.proxy(this.opts.focusCallback,this))}
var clickedElement;$(document).on('mousedown',function(e){clickedElement=$(e.target)});this.$editor.on('blur.redactor',$.proxy(function(e)
{if(this.rtePaste){return}
var $el=$(clickedElement);if(!$el.hasClass('redactor-toolbar, redactor-dropdown')&&!$el.is('#redactor-modal')&&!$el.hasClass('redactor-link-tooltip-action')&&$el.parents('.redactor-toolbar, .redactor-dropdown, #redactor-modal').size()===0)
{this.utils.disableSelectAll();if($.isFunction(this.opts.blurCallback)){this.core.setCallback('blur',e)}}},this))},setHelpers:function()
{this.autosave.enable();this.placeholder.enable();if(this.opts.focus){setTimeout($.proxy(this.focus.setStart,this),100)}
if(this.opts.focusEnd){setTimeout($.proxy(this.focus.setEnd,this),100)}},plugins:function()
{if(!this.opts.plugins){return}
if(!RedactorPlugins){return}
$.each(this.opts.plugins,$.proxy(function(i,s)
{if(typeof RedactorPlugins[s]==='undefined'){return}
if($.inArray(s,$.Redactor.modules)!==-1)
{$.error('Plugin name "'+s+'" matches the name of the Redactor\'s module.');return}
if(!$.isFunction(RedactorPlugins[s])){return}
this[s]=RedactorPlugins[s]();var methods=this.getModuleMethods(this[s]);var len=methods.length;for(var z=0;z<len;z++)
{this[s][methods[z]]=this[s][methods[z]].bind(this)}
if($.isFunction(this[s].init)){this[s].init()}},this))},disableMozillaEditing:function()
{if(!this.utils.browser('mozilla')){return}
try{document.execCommand('enableObjectResizing',!1,!1);document.execCommand('enableInlineTableEditing',!1,!1)}catch(e){}}}},button:function()
{return{build:function(btnName,btnObject)
{var $button=$('<a href="#" class="re-icon re-'+btnName+'" rel="'+btnName+'" />').attr('tabindex','-1');if(btnObject.func||btnObject.command||btnObject.dropdown)
{$button.on('touchstart click',$.proxy(function(e)
{if($button.hasClass('redactor-button-disabled'))return!1;var type='func';var callback=btnObject.func;if(btnObject.command)
{type='command';callback=btnObject.command}
else{if(btnObject.dropdown)
{type='dropdown';callback=!1}}
this.button.onClick(e,btnName,type,callback)},this))}
if(btnObject.dropdown)
{var $dropdown=$('<div class="redactor-dropdown redactor-dropdown-box-'+btnName+'" style="display: none;">');$button.data('dropdown',$dropdown);this.dropdown.build(btnName,$dropdown,btnObject.dropdown)}
if(this.utils.isDesktop())
{this.button.createTooltip($button,btnName,btnObject.title)}
return $button},createTooltip:function($button,name,title)
{var $tooltip=$('<span>').addClass('redactor-toolbar-tooltip redactor-toolbar-tooltip-'+name).hide().html(title);$tooltip.appendTo('body');$button.on('mouseover',function()
{if($(this).hasClass('redactor-button-disabled')){return}
var pos=$button.offset();var height=$button.innerHeight();var width=$button.innerWidth();$tooltip.show();$tooltip.css({top:(pos.top+height)+'px',left:(pos.left+width/2-$tooltip.innerWidth()/2)+'px'})});$button.on('mouseout',function()
{$tooltip.hide()})},onClick:function(e,btnName,type,callback)
{this.button.caretOffset=this.caret.getOffset();e.preventDefault();if(this.utils.browser('msie')){e.returnValue=!1}
if(type=='command')
{this.inline.format(callback)}
else{if(type=='dropdown')
{this.dropdown.show(e,btnName)}
else{var func;if($.isFunction(callback))
{callback.call(this,btnName);this.observe.buttons(e,btnName)}
else{if(callback.search(/\./)!='-1')
{func=callback.split('.');if(typeof this[func[0]]!='undefined')
{this[func[0]][func[1]](btnName);this.observe.buttons(e,btnName)}}
else{this[callback](btnName);this.observe.buttons(e,btnName)}}}}},get:function(key)
{return this.$toolbar.find('a.re-'+key)},setActive:function(key)
{this.button.get(key).addClass('redactor-act')},setInactive:function(key)
{this.button.get(key).removeClass('redactor-act')},setInactiveAll:function(key)
{if(typeof key=='undefined')
{this.$toolbar.find('a.re-icon').removeClass('redactor-act')}
else{this.$toolbar.find('a.re-icon').not('.re-'+key).removeClass('redactor-act')}},setActiveInVisual:function()
{this.$toolbar.find('a.re-icon').not('a.re-html').removeClass('redactor-button-disabled')},setInactiveInCode:function()
{this.$toolbar.find('a.re-icon').not('a.re-html').addClass('redactor-button-disabled')},changeIcon:function(key,classname)
{this.button.get(key).addClass('re-'+classname)},removeIcon:function(key,classname)
{this.button.get(key).removeClass('re-'+classname)},setAwesome:function(key,name)
{var $button=this.button.get(key);$button.removeClass('redactor-btn-image').addClass('fa-redactor-btn');$button.html('<i class="fa '+name+'"></i>')},addCallback:function($btn,callback)
{var type=(callback=='dropdown')?'dropdown':'func';var key=$btn.attr('rel');$btn.on('touchstart click',$.proxy(function(e)
{if($btn.hasClass('redactor-button-disabled')){return!1}
this.button.onClick(e,key,type,callback)},this))},addDropdown:function($btn,dropdown)
{var key=$btn.attr('rel');this.button.addCallback($btn,'dropdown');var $dropdown=$('<div class="redactor-dropdown redactor-dropdown-box-'+key+'" style="display: none;">');$btn.data('dropdown',$dropdown);if(dropdown)
{this.dropdown.build(key,$dropdown,dropdown)}
return $dropdown},add:function(key,title)
{if(!this.opts.toolbar){return}
var btn=this.button.build(key,{title:title});btn.addClass('redactor-btn-image');this.$toolbar.append($('<li>').append(btn));return btn},addFirst:function(key,title)
{if(!this.opts.toolbar){return}
var btn=this.button.build(key,{title:title});this.$toolbar.prepend($('<li>').append(btn));return btn},addAfter:function(afterkey,key,title)
{if(!this.opts.toolbar){return}
var btn=this.button.build(key,{title:title});var $btn=this.button.get(afterkey);if($btn.size()!==0){$btn.parent().after($('<li>').append(btn))}
else{this.$toolbar.append($('<li>').append(btn))}
return btn},addBefore:function(beforekey,key,title)
{if(!this.opts.toolbar){return}
var btn=this.button.build(key,{title:title});var $btn=this.button.get(beforekey);if($btn.size()!==0){$btn.parent().before($('<li>').append(btn))}
else{this.$toolbar.append($('<li>').append(btn))}
return btn},remove:function(key)
{this.button.get(key).remove()}}},caret:function()
{return{setStart:function(node)
{if(!this.utils.isBlock(node))
{var space=this.utils.createSpaceElement();$(node).prepend(space);this.caret.setEnd(space)}
else{this.caret.set(node,0,node,0)}},setEnd:function(node)
{this.caret.set(node,1,node,1)},set:function(orgn,orgo,focn,foco)
{if(!this.utils.browser('msie')){this.$editor.focus()}
orgn=orgn[0]||orgn;focn=focn[0]||focn;if(this.utils.isBlockTag(orgn.tagName)&&orgn.innerHTML==='')
{orgn.innerHTML=this.opts.invisibleSpace}
if(orgn.tagName=='BR'&&this.opts.linebreaks===!1)
{var par=$(this.opts.emptyHtml)[0];$(orgn).replaceWith(par);orgn=par;focn=orgn}
this.selection.get();try{this.range.setStart(orgn,orgo);this.range.setEnd(focn,foco)}
catch(e){}
this.selection.addRange()},setAfter:function(node)
{try{var tag=$(node)[0].tagName;if(tag!='BR'&&!this.utils.isBlock(node))
{var space=this.utils.createSpaceElement();$(node).after(space);this.caret.setEnd(space)}
else{if(tag!='BR'&&this.utils.browser('msie'))
{this.caret.setStart($(node).next())}
else{this.caret.setAfterOrBefore(node,'after')}}}
catch(e){var space=this.utils.createSpaceElement();$(node).after(space);this.caret.setEnd(space)}},setBefore:function(node)
{if(this.utils.isBlock(node))
{this.caret.setEnd($(node).prev())}
else{this.caret.setAfterOrBefore(node,'before')}},setAfterOrBefore:function(node,type)
{if(!this.utils.browser('msie')){this.$editor.focus()}
node=node[0]||node;this.selection.get();if(type=='after')
{try{this.range.setStartAfter(node);this.range.setEndAfter(node)}
catch(e){}}
else{try{this.range.setStartBefore(node);this.range.setEndBefore(node)}
catch(e){}}
this.range.collapse(!1);this.selection.addRange()},getOffsetOfElement:function(node)
{node=node[0]||node;this.selection.get();var cloned=this.range.cloneRange();cloned.selectNodeContents(node);cloned.setEnd(this.range.endContainer,this.range.endOffset);return $.trim(cloned.toString()).length},getOffset:function()
{var offset=0;var sel=window.getSelection();if(sel.rangeCount>0)
{var range=window.getSelection().getRangeAt(0);var preCaretRange=range.cloneRange();preCaretRange.selectNodeContents(this.$editor[0]);preCaretRange.setEnd(range.endContainer,range.endOffset);offset=preCaretRange.toString().length}
return offset},setOffset:function(start,end)
{if(typeof end=='undefined'){end=start}
if(!this.focus.isFocused()){this.focus.setStart()}
var range=document.createRange();var sel=document.getSelection();var node,offset=0;var walker=document.createTreeWalker(this.$editor[0],NodeFilter.SHOW_TEXT,null,null);while(node=walker.nextNode())
{offset+=node.nodeValue.length;if(offset>start)
{range.setStart(node,node.nodeValue.length+start-offset);start=Infinity}
if(offset>=end)
{range.setEnd(node,node.nodeValue.length+end-offset);break}}
sel.removeAllRanges();sel.addRange(range)},setToPoint:function(start,end)
{this.caret.setOffset(start,end)},getCoords:function()
{return this.caret.getOffset()}}},clean:function()
{return{onSet:function(html)
{html=this.clean.savePreCode(html);html=html.replace(/<script(.*?[^>]?)>([\w\W]*?)<\/script>/gi,'<pre class="redactor-script-tag" style="display: none;" $1>$2</pre>');html=html.replace(/\$/g,'&#36;');html=html.replace(/”/g,'"');html=html.replace(/‘/g,'\'');html=html.replace(/’/g,'\'');if(this.opts.replaceDivs){html=this.clean.replaceDivs(html)}
if(this.opts.linebreaks){html=this.clean.replaceParagraphsToBr(html)}
html=this.clean.saveFormTags(html);var $div=$('<div>');$div.html(html);var fonts=$div.find('font[style]');if(fonts.length!==0)
{fonts.replaceWith(function()
{var $el=$(this);var $span=$('<span>').attr('style',$el.attr('style'));return $span.append($el.contents())});html=$div.html()}
$div.remove();html=html.replace(/<font(.*?[^<])>/gi,'');html=html.replace(/<\/font>/gi,'');html=this.tidy.load(html);if(this.opts.paragraphize){html=this.paragraphize.load(html)}
html=this.clean.setVerified(html);html=this.clean.convertInline(html);return html},onSync:function(html)
{html=html.replace(/[\u200B-\u200D\uFEFF]/g,'');html=html.replace(/&#x200b;/gi,'');html=html.replace(/&nbsp;/gi,' ');if(html.search(/^<p>(||\s||&nbsp;)<\/p>$/i)!=-1)
{return ''}
html=html.replace(/<pre class="redactor-script-tag" style="display: none;"(.*?[^>]?)>([\w\W]*?)<\/pre>/gi,'<script$1>$2</script>');html=this.clean.restoreFormTags(html);var chars={'\u2122':'&trade;','\u00a9':'&copy;','\u2026':'&hellip;','\u2014':'&mdash;','\u2010':'&dash;','\u000AB':'&laquo;','\u000BB':'&raquo;'};$.each(chars,function(i,s)
{html=html.replace(new RegExp(i,'g'),s)});html=html.replace(new RegExp('<br\\s?/?></li>','gi'),'</li>');html=html.replace(new RegExp('</li><br\\s?/?>','gi'),'</li>');html=html.replace(new RegExp('<div(.*?) data-tagblock="redactor"(.*?[^>])>','gi'),'<div$1$2>');html=html.replace(new RegExp('<(.*?) data-verified="redactor"(.*?[^>])>','gi'),'<$1$2>');html=html.replace(new RegExp('<span(.*?) rel="(.*?)"(.*?[^>])>','gi'),'<span$1$3>');html=html.replace(new RegExp('<a(.*?) rel="(.*?)"(.*?[^>])>','gi'),'<a$1$3>');html=html.replace(new RegExp('<img(.*?) rel="(.*?)"(.*?[^>])>','gi'),'<img$1$3>');html=html.replace(new RegExp('<img(.*?) style="" (.*?[^>])>','gi'),'<img$1 $2>');html=html.replace(new RegExp('<img(.*?) style (.*?[^>])>','gi'),'<img$1 $2>');html=html.replace(new RegExp('<span class="redactor-invisible-space">(.*?)</span>','gi'),'$1');html=html.replace(/ data-save-url="(.*?[^>])"/gi,'');html=html.replace(/<span(.*?)id="redactor-image-box"(.*?[^>])>([\w\W]*?)<img(.*?)><\/span>/gi,'$3<img$4>');html=html.replace(/<span(.*?)id="redactor-image-resizer"(.*?[^>])>(.*?)<\/span>/gi,'');html=html.replace(/<span(.*?)id="redactor-image-editter"(.*?[^>])>(.*?)<\/span>/gi,'');html=html.replace(/<font(.*?[^<])>/gi,'');html=html.replace(/<\/font>/gi,'');html=this.tidy.load(html);if(this.opts.linkNofollow)
{html=html.replace(/<a(.*?)rel="nofollow"(.*?[^>])>/gi,'<a$1$2>');html=html.replace(/<a(.*?[^>])>/gi,'<a$1 rel="nofollow">')}
html=html.replace(/<([^>]*?) data-redactor-tag="(.*?)"(.*?[^>])>/gi,'<$1$3>');html=html.replace(/<([^>]*?) data-redactor-class="(.*?)"(.*?[^>])>/gi,'<$1$3>');html=html.replace(/<([^>]*?) data-redactor-style="(.*?)"(.*?[^>])>/gim,'<$1$3>');html=html.replace(new RegExp('<([^>]*?) data-verified="redactor"(.*?[^>])>','gi'),'<$1$2>');html=html.replace(new RegExp('<([^>]*?) data-verified="redactor">','gi'),'<$1>');html=html.replace(/\r\n/g,"\n");html=html.replace(/<span[^>]*>\s|&nbsp;<\/span>/gi,' ');html=html.replace(/<span[^>]*><\/span>/gi,'');html=html.replace(/<a[^>]*><\/a>/gi,'');html=html.replace(/<span[^>]*><\/span>/gi,'');html=html.replace(/<a[^>]*><\/a>/gi,'');html=html.replace(/<span[^>]*><\/span>/gi,'');html=html.replace(/<a[^>]*><\/a>/gi,'');return html},onPaste:function(html,setMode)
{html=$.trim(html);html=html.replace(/\$/g,'&#36;');html=html.replace(/”/g,'"');html=html.replace(/“/g,'"');html=html.replace(/‘/g,'\'');html=html.replace(/’/g,'\'');html=html.replace(/<span class="Apple-converted-space">&nbsp;<\/span>/gi,' ');html=html.replace(/<span class="Apple-tab-span"[^>]*>\t<\/span>/gi,'\t');html=html.replace(/<span[^>]*>(\s|&nbsp;)<\/span>/gi,' ');if(this.opts.pastePlainText)
{return this.clean.getPlainText(html)}
if(!this.utils.isSelectAll()&&typeof setMode=='undefined')
{if(this.utils.isCurrentOrParent(['FIGCAPTION','A']))
{return this.clean.getPlainText(html,!1)}
if(this.utils.isCurrentOrParent('PRE'))
{return this.clean.getPreCode(html)}
if(this.utils.isCurrentOrParent(['BLOCKQUOTE','H1','H2','H3','H4','H5','H6']))
{html=this.clean.getOnlyImages(html);if(!this.utils.browser('msie'))
{var block=this.selection.getBlock();if(block&&block.tagName=='P')
{html=html.replace(/<img(.*?)>/gi,'<p><img$1></p>')}}
return html}
if(this.utils.isCurrentOrParent(['TD']))
{html=this.clean.onPasteTidy(html,'td');if(this.opts.linebreaks){html=this.clean.replaceParagraphsToBr(html)}
html=this.clean.replaceDivsToBr(html);return html}
if(this.utils.isCurrentOrParent(['LI']))
{return this.clean.onPasteTidy(html,'li')}}
html=this.clean.isSingleLine(html,setMode);if(!this.clean.singleLine)
{if(this.opts.linebreaks){html=this.clean.replaceParagraphsToBr(html)}
if(this.opts.replaceDivs){html=this.clean.replaceDivs(html)}
html=this.clean.saveFormTags(html)}
html=this.clean.onPasteWord(html);html=this.clean.onPasteExtra(html);html=this.clean.onPasteTidy(html,'all');if(!this.clean.singleLine&&this.opts.paragraphize)
{html=this.paragraphize.load(html)}
html=this.clean.removeDirtyStyles(html);html=this.clean.onPasteRemoveSpans(html);html=this.clean.onPasteRemoveEmpty(html);html=this.clean.convertInline(html);return html},onPasteWord:function(html)
{html=html.replace(/<!--[\s\S]*?-->/gi,'');html=html.replace(/<style[^>]*>[\s\S]*?<\/style>/gi,'');if(/(class=\"?Mso|style=\"[^\"]*\bmso\-|w:WordDocument)/.test(html))
{html=this.clean.onPasteIeFixLinks(html);html=html.replace(/<img(.*?)v:shapes=(.*?)>/gi,'');html=html.replace(/src="file\:\/\/(.*?)"/,'src=""');html=html.replace(/<p(.*?)class="MsoListParagraphCxSpFirst"([\w\W]*?)<\/p>/gi,'<ul><li$2</li>');html=html.replace(/<p(.*?)class="MsoListParagraphCxSpMiddle"([\w\W]*?)<\/p>/gi,'<li$2</li>');html=html.replace(/<p(.*?)class="MsoListParagraphCxSpLast"([\w\W]*?)<\/p>/gi,'<li$2</li></ul>');html=html.replace(/<p(.*?)class="MsoListParagraph"([\w\W]*?)<\/p>/gi,'<ul><li$2</li></ul>');html=html.replace(/·/g,'');html=html.replace(/<p class="Mso(.*?)"/gi,'<p');html=html.replace(/ class=\"(mso[^\"]*)\"/gi,"");html=html.replace(/ class=(mso\w+)/gi,"");html=html.replace(/<o:p(.*?)>([\w\W]*?)<\/o:p>/gi,'$2');html=html.replace(/\n/g,' ');html=html.replace(/<p>\n?<li>/gi,'<li>')}
if(this.opts.cleanSpaces)
{html=html.replace(/(\s|&nbsp;)+/g,' ')}
return html},onPasteExtra:function(html)
{html=html.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2");html=html.replace(/<b(.*?)id="docs-internal-guid(.*?)">([\w\W]*?)<\/b>/gi,"$3");html=html.replace(/<span[^>]*(font-style: italic; font-weight: bold|font-weight: bold; font-style: italic)[^>]*>/gi,'<span style="font-weight: bold;"><span style="font-style: italic;">');html=html.replace(/<span[^>]*font-style: italic[^>]*>/gi,'<span style="font-style: italic;">');html=html.replace(/<span[^>]*font-weight: bold[^>]*>/gi,'<span style="font-weight: bold;">');html=html.replace(/<span[^>]*text-decoration: underline[^>]*>/gi,'<span style="text-decoration: underline;">');html=html.replace(/<img>/gi,'');html=html.replace(/\n{3,}/gi,'\n');html=html.replace(/<font(.*?)>([\w\W]*?)<\/font>/gi,'$2');html=html.replace(/<p><p>/gi,'<p>');html=html.replace(/<\/p><\/p>/gi,'</p>');html=html.replace(/<li>(\s*|\t*|\n*)<p>/gi,'<li>');html=html.replace(/<\/p>(\s*|\t*|\n*)<\/li>/gi,'</li>');html=html.replace(/<\/p>\s<p/gi,'<\/p><p');html=html.replace(/<img src="webkit-fake-url\:\/\/(.*?)"(.*?)>/gi,'');html=html.replace(/<p>•([\w\W]*?)<\/p>/gi,'<li>$1</li>');if(this.utils.browser('mozilla'))
{html=html.replace(/<br\s?\/?>$/gi,'')}
return html},onPasteTidy:function(html,type)
{var tags=['span','a','pre','blockquote','small','em','strong','code','kbd','mark','address','cite','var','samp','dfn','sup','sub','b','i','u','del','ol','ul','li','dl','dt','dd','p','br','video','audio','iframe','embed','param','object','img','table','td','th','tr','tbody','tfoot','thead','h1','h2','h3','h4','h5','h6'];var tagsEmpty=!1;var attrAllowed=[['a','*'],['img',['src','alt']],['span',['class','rel','data-verified']],['iframe','*'],['video','*'],['audio','*'],['embed','*'],['object','*'],['param','*'],['source','*']];if(type=='all')
{tagsEmpty=['p','span','h1','h2','h3','h4','h5','h6'];attrAllowed=[['table','class'],['td',['colspan','rowspan']],['a','*'],['img',['src','alt','data-redactor-inserted-image']],['span',['class','rel','data-verified']],['iframe','*'],['video','*'],['audio','*'],['embed','*'],['object','*'],['param','*'],['source','*']]}
else if(type=='td')
{tags=['ul','ol','li','span','a','small','em','strong','code','kbd','mark','cite','var','samp','dfn','sup','sub','b','i','u','del','ol','ul','li','dl','dt','dd','br','iframe','video','audio','embed','param','object','img','h1','h2','h3','h4','h5','h6']}
else{if(type=='li')
{tags=['ul','ol','li','span','a','small','em','strong','code','kbd','mark','cite','var','samp','dfn','sup','sub','b','i','u','del','br','iframe','video','audio','embed','param','object','img']}}
var options={deniedTags:!1,allowedTags:tags,removeComments:!0,removePhp:!0,removeAttr:!1,allowedAttr:attrAllowed,removeEmpty:tagsEmpty};return this.tidy.load(html,options)},onPasteRemoveEmpty:function(html)
{html=html.replace(/<(p|h[1-6])>(|\s|\n|\t|<br\s?\/?>)<\/(p|h[1-6])>/gi,'');if(!this.opts.linebreaks){html=html.replace(/<br>$/i,'')}
return html},onPasteRemoveSpans:function(html)
{html=html.replace(/<span>(.*?)<\/span>/gi,'$1');html=html.replace(/<span[^>]*>\s|&nbsp;<\/span>/gi,' ');return html},onPasteIeFixLinks:function(html)
{if(!this.utils.browser('msie')){return html}
var tmp=$.trim(html);if(tmp.search(/^<a(.*?)>(.*?)<\/a>$/i)===0)
{html=html.replace(/^<a(.*?)>(.*?)<\/a>$/i,"$2")}
return html},isSingleLine:function(html,setMode)
{this.clean.singleLine=!1;if(!this.utils.isSelectAll()&&typeof setMode=='undefined')
{var blocks=this.opts.blockLevelElements.join('|').replace('P|','').replace('DIV|','');var matchBlocks=html.match(new RegExp('</('+blocks+')>','gi'));var matchContainers=html.match(/<\/(p|div)>/gi);if(!matchBlocks&&(matchContainers===null||(matchContainers&&matchContainers.length<=1)))
{var matchBR=html.match(/<br\s?\/?>/gi);var matchIMG=html.match(/<img(.*?[^>])>/gi);if(!matchBR&&!matchIMG)
{this.clean.singleLine=!0;html=html.replace(/<\/?(p|div)(.*?)>/gi,'')}}}
return html},stripTags:function(input,allowed)
{allowed=(((allowed||'')+'').toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join('');var tags=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return input.replace(tags,function($0,$1){return allowed.indexOf('<'+$1.toLowerCase()+'>')>-1?$0:''})},savePreCode:function(html)
{var pre=html.match(/<(pre|code)(.*?)>([\w\W]*?)<\/(pre|code)>/gi);if(pre!==null)
{$.each(pre,$.proxy(function(i,s)
{var arr=s.match(/<(pre|code)(.*?)>([\w\W]*?)<\/(pre|code)>/i);arr[3]=arr[3].replace(/<br\s?\/?>/g,'\n');arr[3]=arr[3].replace(/&nbsp;/g,' ');if(this.opts.preSpaces)
{arr[3]=arr[3].replace(/\t/g,Array(this.opts.preSpaces+1).join(' '))}
arr[3]=this.clean.encodeEntities(arr[3]);arr[3]=arr[3].replace(/\$/g,'&#36;');html=html.replace(s,'<'+arr[1]+arr[2]+'>'+arr[3]+'</'+arr[1]+'>')},this))}
return html},getTextFromHtml:function(html)
{html=html.replace(/<br\s?\/?>|<\/H[1-6]>|<\/p>|<\/div>|<\/li>|<\/td>/gi,'\n');var tmp=document.createElement('div');tmp.innerHTML=html;html=tmp.textContent||tmp.innerText;return $.trim(html)},getPlainText:function(html,paragraphize)
{html=this.clean.getTextFromHtml(html);html=html.replace(/\n/g,'<br />');if(this.opts.paragraphize&&typeof paragraphize=='undefined')
{html=this.paragraphize.load(html)}
return html},getPreCode:function(html)
{html=html.replace(/<img(.*?) style="(.*?)"(.*?[^>])>/gi,'<img$1$3>');html=html.replace(/<img(.*?)>/gi,'&lt;img$1&gt;');html=this.clean.getTextFromHtml(html);if(this.opts.preSpaces)
{html=html.replace(/\t/g,Array(this.opts.preSpaces+1).join(' '))}
html=this.clean.encodeEntities(html);return html},getOnlyImages:function(html)
{html=html.replace(/<img(.*?)>/gi,'[img$1]');html=html.replace(/<(.*?)>/gi,'');html=html.replace(/\[img(.*?)\]/gi,'<img$1>');return html},getOnlyLinksAndImages:function(html)
{html=html.replace(/<a(.*?)href="(.*?)"(.*?)>([\w\W]*?)<\/a>/gi,'[a href="$2"]$4[/a]');html=html.replace(/<img(.*?)>/gi,'[img$1]');html=html.replace(/<(.*?)>/gi,'');html=html.replace(/\[a href="(.*?)"\]([\w\W]*?)\[\/a\]/gi,'<a href="$1">$2</a>');html=html.replace(/\[img(.*?)\]/gi,'<img$1>');return html},encodeEntities:function(str)
{str=String(str).replace(/&amp;/g,'&').replace(/&lt;/g,'<').replace(/&gt;/g,'>').replace(/&quot;/g,'"');return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;')},removeDirtyStyles:function(html)
{if(this.utils.browser('msie')){return html}
var div=document.createElement('div');div.innerHTML=html;this.clean.clearUnverifiedRemove($(div));html=div.innerHTML;$(div).remove();return html},clearUnverified:function()
{if(this.utils.browser('msie')){return}
this.clean.clearUnverifiedRemove(this.$editor);var headers=this.$editor.find('h1, h2, h3, h4, h5, h6');headers.find('span').removeAttr('style');headers.find(this.opts.verifiedTags.join(', ')).removeAttr('style');this.code.sync()},clearUnverifiedRemove:function($editor)
{$editor.find(this.opts.verifiedTags.join(', ')).removeAttr('style');$editor.find('span,a').not('[data-verified="redactor"]').removeAttr('style');$editor.find('span[data-verified="redactor"], img[data-verified="redactor"], a[data-verified="redactor"]').each(function(i,s)
{var $s=$(s);$s.attr('style',$s.attr('rel'))})},setVerified:function(html)
{if(this.utils.browser('msie')){return html}
html=html.replace(new RegExp('<img(.*?[^>])>','gi'),'<img$1 data-verified="redactor">');html=html.replace(new RegExp('<span(.*?)>','gi'),'<span$1 data-verified="redactor">');html=html.replace(new RegExp('<a(.*?)>','gi'),'<a$1 data-verified="redactor">');var matches=html.match(new RegExp('<(span|img|a)(.*?)style="(.*?)"(.*?[^>])>','gi'));if(matches)
{var len=matches.length;for(var i=0;i<len;i++)
{try{var newTag=matches[i].replace(/style="(.*?)"/i,'style="$1" rel="$1"');html=html.replace(new RegExp(matches[i],'gi'),newTag)}
catch(e){}}}
return html},convertInline:function(html)
{var $div=$('<div />').html(html);var tags=this.opts.inlineTags;tags.push('span');$div.find(tags.join(',')).each(function()
{var $el=$(this);var tag=this.tagName.toLowerCase();$el.attr('data-redactor-tag',tag);if(tag=='span')
{if($el.attr('style')){$el.attr('data-redactor-style',$el.attr('style'))}
else{if($el.attr('class')){$el.attr('data-redactor-class',$el.attr('class'))}}}});html=$div.html();$div.remove();return html},normalizeLists:function()
{this.$editor.find('li').each(function(i,s)
{var $next=$(s).next();if($next.length!==0&&($next[0].tagName=='UL'||$next[0].tagName=='OL'))
{$(s).append($next)}})},removeSpaces:function(html)
{html=html.replace(/\n/g,'');html=html.replace(/[\t]*/g,'');html=html.replace(/\n\s*\n/g,"\n");html=html.replace(/^[\s\n]*/g,' ');html=html.replace(/[\s\n]*$/g,' ');html=html.replace(/>\s{2,}</g,'> <');html=html.replace(/\r\n/g,"\n");html=html.replace(/\n\n/g,"\n");html=html.replace(/[\u200B-\u200D\uFEFF]/g,'');html=html.replace(/<span[^>]*>\s|&nbsp;<\/span>/gi,' ');html=html.replace(/<span[^>]*><\/span>/gi,'');html=html.replace(/<p[^>]*><\/p>/gi,'');html=html.replace(/<a[^>]*><\/a>/gi,'');return html},replaceDivs:function(html)
{if(this.opts.linebreaks)
{html=html.replace(/<div><br\s?\/?><\/div>/gi,'<br />');html=html.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,'$2<br />')}
else{html=html.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,'<p$1>$2</p>')}
return html},replaceDivsToBr:function(html)
{html=html.replace(/<div\s(.*?)>/gi,'<p>');html=html.replace(/<div><br\s?\/?><\/div>/gi,'<br /><br />');html=html.replace(/<div>([\w\W]*?)<\/div>/gi,'$1<br /><br />');return html},replaceParagraphsToBr:function(html)
{html=html.replace(/<p\s(.*?)>/gi,'<p>');html=html.replace(/<p><br\s?\/?><\/p>/gi,'<br />');html=html.replace(/<p>([\w\W]*?)<\/p>/gi,'$1<br /><br />');html=html.replace(/(<br\s?\/?>){1,}\n?<\/blockquote>/gi,'</blockquote>');return html},saveFormTags:function(html)
{return html.replace(/<form(.*?)>([\w\W]*?)<\/form>/gi,'<section$1 rel="redactor-form-tag">$2</section>')},restoreFormTags:function(html)
{return html.replace(/<section(.*?) rel="redactor-form-tag"(.*?)>([\w\W]*?)<\/section>/gi,'<form$1$2>$3</form>')}}},code:function()
{return{set:function(html)
{html=$.trim(html.toString());html=this.clean.onSet(html);this.$editor.html(html);this.code.sync();setTimeout($.proxy(this.buffer.add,this),15);if(this.start===!1){this.observe.load()}},get:function()
{var code=this.$textarea.val();code=this.tabifier.get(code);return code},sync:function()
{setTimeout($.proxy(this.code.startSync,this),10)},startSync:function()
{var html=this.$editor.html();if(this.code.syncCode&&this.code.syncCode==html)
{return}
this.code.syncCode=html;html=this.core.setCallback('syncBefore',html);html=this.clean.onSync(html);this.$textarea.val(html);this.core.setCallback('sync',html);if(this.start===!1)
{this.core.setCallback('change',html)}
this.start=!1;this.autosave.onChange()},toggle:function()
{if(this.opts.visual)
{this.code.showCode()}
else{this.code.showVisual()}},showCode:function()
{this.code.offset=this.caret.getOffset();var scroll=$(window).scrollTop();var height=this.$editor.innerHeight();this.$editor.hide();var html=this.$textarea.val();this.modified=this.clean.removeSpaces(html);html=this.tabifier.get(html);this.$textarea.val(html).height(height).show().focus();this.$textarea.on('keydown.redactor-textarea-indenting',this.code.textareaIndenting);$(window).scrollTop(scroll);if(this.$textarea[0].setSelectionRange)
{this.$textarea[0].setSelectionRange(0,0)}
this.$textarea[0].scrollTop=0;this.opts.visual=!1;this.button.setInactiveInCode();this.button.setActive('html');this.core.setCallback('source',html)},showVisual:function()
{if(this.opts.visual){return}
var html=this.$textarea.hide().val();if(this.modified!==this.clean.removeSpaces(html))
{this.code.set(html)}
this.$editor.show();if(!this.utils.isEmpty(html))
{this.placeholder.remove()}
this.caret.setOffset(this.code.offset);this.$textarea.off('keydown.redactor-textarea-indenting');this.button.setActiveInVisual();this.button.setInactive('html');this.observe.load();this.opts.visual=!0},textareaIndenting:function(e)
{if(e.keyCode!==9){return!0}
var $el=this.$textarea;var start=$el.get(0).selectionStart;$el.val($el.val().substring(0,start)+"\t"+$el.val().substring($el.get(0).selectionEnd));$el.get(0).selectionStart=$el.get(0).selectionEnd=start+1;return!1}}},core:function()
{return{getObject:function()
{return $.extend({},this)},getEditor:function()
{return this.$editor},getBox:function()
{return this.$box},getElement:function()
{return this.$element},getTextarea:function()
{return this.$textarea},getToolbar:function()
{return(this.$toolbar)?this.$toolbar:!1},addEvent:function(name)
{this.core.event=name},getEvent:function()
{return this.core.event},setCallback:function(type,e,data)
{var callback=this.opts[type+'Callback'];if($.isFunction(callback))
{return(typeof data=='undefined')?callback.call(this,e):callback.call(this,e,data)}
else{return(typeof data=='undefined')?e:data}},destroy:function()
{this.core.setCallback('destroy');this.$element.off('.redactor').removeData('redactor');this.$editor.off('.redactor');this.$editor.removeClass('redactor-editor redactor-linebreaks redactor-placeholder');this.$editor.removeAttr('contenteditable');var html=this.code.get();if(this.build.isTextarea())
{this.$box.after(this.$element);this.$box.remove();this.$element.val(html).show()}
else{this.$box.after(this.$editor);this.$box.remove();this.$element.html(html).show()}
if(this.$pasteBox){this.$pasteBox.remove()}
if(this.$modalBox){this.$modalBox.remove()}
if(this.$modalOverlay){this.$modalOverlay.remove()}
$('.redactor-toolbar-tooltip').remove();clearInterval(this.autosaveInterval)}}},dropdown:function()
{return{build:function(name,$dropdown,dropdownObject)
{if(name=='formatting'&&this.opts.formattingAdd)
{$.each(this.opts.formattingAdd,$.proxy(function(i,s)
{var name=s.tag;if(typeof s.class!='undefined')
{name=name+'-'+s.class}
s.type=(this.utils.isBlockTag(s.tag))?'block':'inline';var func=(s.type=='inline')?'inline.formatting':'block.formatting';if(this.opts.linebreaks&&s.type=='block'&&s.tag=='p'){return}
this.formatting[name]={tag:s.tag,style:s.style,'class':s.class,attr:s.attr,data:s.data};dropdownObject[name]={func:func,title:s.title}},this))}
$.each(dropdownObject,$.proxy(function(btnName,btnObject)
{var $item=$('<a href="#" class="redactor-dropdown-'+btnName+'">'+btnObject.title+'</a>');if(name=='formatting'){$item.addClass('redactor-formatting-'+btnName)}
$item.on('click',$.proxy(function(e)
{var type='func';var callback=btnObject.func;if(btnObject.command)
{type='command';callback=btnObject.command}
else{if(btnObject.dropdown)
{type='dropdown';callback=btnObject.dropdown}}
this.button.onClick(e,btnName,type,callback)},this));$dropdown.append($item)},this))},show:function(e,key)
{if(!this.opts.visual)
{e.preventDefault();return!1}
var $button=this.button.get(key);var $dropdown=$button.data('dropdown').appendTo(document.body);document.activeElement.blur();if($button.hasClass('dropact'))
{this.dropdown.hideAll()}
else{this.dropdown.hideAll();this.core.setCallback('dropdownShow',{dropdown:$dropdown,key:key,button:$button});this.button.setActive(key);$button.addClass('dropact');var keyPosition=$button.offset();var dropdownWidth=$dropdown.width();if((keyPosition.left+dropdownWidth)>$(document).width())
{keyPosition.left-=dropdownWidth}
var left=keyPosition.left+'px';if(this.$toolbar.hasClass('toolbar-fixed-box'))
{var top=this.$toolbar.innerHeight()+this.opts.toolbarFixedTopOffset;var position='fixed';if(this.opts.toolbarFixedTarget!==document)
{top=(this.$toolbar.innerHeight()+this.$toolbar.offset().top)+this.opts.toolbarFixedTopOffset;position='absolute'}
$dropdown.css({position:position,left:left,top:top+'px'}).show()}
else{var top=($button.innerHeight()+keyPosition.top)+'px';$dropdown.css({position:'absolute',left:left,top:top}).show()}
this.core.setCallback('dropdownShown',{dropdown:$dropdown,key:key,button:$button})}
$(document).one('click',$.proxy(this.dropdown.hide,this));this.$editor.one('click',$.proxy(this.dropdown.hide,this));var $body=$(document.body);var width=$body.width();$dropdown.on('mouseover',function(){$body.addClass('body-hidden');$body.css('margin-right',($body.width()-width)+'px')});$dropdown.on('mouseout',function(){$body.removeClass('body-hidden').css('margin-right',0)});e.stopPropagation()},hideAll:function()
{this.$toolbar.find('a.dropact').removeClass('redactor-act').removeClass('dropact');$(document.body).removeClass('body-hidden').css('margin-right',0);$('.redactor-dropdown').hide();this.core.setCallback('dropdownHide')},hide:function(e)
{var $dropdown=$(e.target);if(!$dropdown.hasClass('dropact'))
{$dropdown.removeClass('dropact');this.dropdown.hideAll()}}}},file:function()
{return{show:function()
{this.modal.load('file',this.lang.get('file'),700);this.upload.init('#redactor-modal-file-upload',this.opts.fileUpload,this.file.insert);this.selection.save();this.selection.get();var text=this.sel.toString();$('#redactor-filename').val(text);this.modal.show()},insert:function(json,direct,e)
{if(typeof json.error!='undefined')
{this.modal.close();this.selection.restore();this.core.setCallback('fileUploadError',json);return}
var link;if(typeof json=='string')
{link=json}
else{var text=$('#redactor-filename').val();if(typeof text=='undefined'||text===''){text=json.filename}
link='<a href="'+json.filelink+'" id="filelink-marker">'+text+'</a>'}
if(direct)
{this.selection.removeMarkers();var marker=this.selection.getMarker();this.insert.nodeToCaretPositionFromPoint(e,marker)}
else{this.modal.close()}
this.selection.restore();this.buffer.set();this.insert.html(link);if(typeof json=='string'){return}
var linkmarker=$(this.$editor.find('a#filelink-marker'));if(linkmarker.size()!==0){linkmarker.removeAttr('id')}
else{linkmarker=!1}
this.core.setCallback('fileUpload',linkmarker,json)}}},focus:function()
{return{setStart:function()
{this.$editor.focus();var first=this.$editor.children().first();if(first.size()===0){return}
if(first[0].length===0||first[0].tagName=='BR'||first[0].nodeType==3)
{return}
if(first[0].tagName=='UL'||first[0].tagName=='OL')
{first=first.find('li').first();var child=first.children().first();if(!this.utils.isBlock(child)&&child.text()==='')
{this.caret.setStart(first);return}}
if(this.opts.linebreaks&&!this.utils.isBlockTag(first[0].tagName))
{this.selection.get();this.range.setStart(this.$editor[0],0);this.range.setEnd(this.$editor[0],0);this.selection.addRange();return}
this.caret.setStart(first)},setEnd:function()
{if(this.utils.browser('mozilla')||this.utils.browser('msie'))
{var last=this.$editor.children().last();this.caret.setEnd(last)}
else{this.selection.get();try{this.range.selectNodeContents(this.$editor[0]);this.range.collapse(!1);this.selection.addRange()}
catch(e){}}},isFocused:function()
{var focusNode=document.getSelection().focusNode;if(focusNode===null){return!1}
if(this.opts.linebreaks&&$(focusNode.parentNode).hasClass('redactor-linebreaks')){return!0}
else{if(!this.utils.isRedactorParent(focusNode.parentNode)){return!1}}
return this.$editor.is(':focus')}}},image:function()
{return{show:function()
{this.modal.load('image',this.lang.get('image'),700);this.upload.init('#redactor-modal-image-droparea',this.opts.imageUpload,this.image.insert);this.selection.save();this.modal.show()},showEdit:function($image)
{var $link=$image.closest('a');this.modal.load('imageEdit',this.lang.get('edit'),705);this.modal.createCancelButton();this.image.buttonDelete=this.modal.createDeleteButton(this.lang.get('_delete'));this.image.buttonSave=this.modal.createActionButton(this.lang.get('save'));this.image.buttonDelete.on('click',$.proxy(function()
{this.image.remove($image)},this));this.image.buttonSave.on('click',$.proxy(function()
{this.image.update($image)},this));$('#redactor-image-title').val($image.attr('alt'));if(!this.opts.imageLink){$('.redactor-image-link-option').hide()}
else{var $redactorImageLink=$('#redactor-image-link');$redactorImageLink.attr('href',$image.attr('src'));if($link.size()!==0)
{$redactorImageLink.val($link.attr('href'));if($link.attr('target')=='_blank'){$('#redactor-image-link-blank').prop('checked',!0)}}}
if(!this.opts.imagePosition)
{$('.redactor-image-position-option').hide()}
else{var floatValue=($image.css('display')=='block'&&$image.css('float')=='none')?'center':$image.css('float');$('#redactor-image-align').val(floatValue)}
this.modal.show()},setFloating:function($image)
{var floating=$('#redactor-image-align').val();var imageFloat='';var imageDisplay='';var imageMargin='';switch(floating)
{case 'left':imageFloat='left';imageMargin='0 '+this.opts.imageFloatMargin+' '+this.opts.imageFloatMargin+' 0';break;case 'right':imageFloat='right';imageMargin='0 0 '+this.opts.imageFloatMargin+' '+this.opts.imageFloatMargin;break;case 'center':imageDisplay='block';imageMargin='auto';break}
$image.css({'float':imageFloat,display:imageDisplay,margin:imageMargin});$image.attr('rel',$image.attr('style'))},update:function($image)
{this.image.hideResize();this.buffer.set();var $link=$image.closest('a');$image.attr('alt',$('#redactor-image-title').val());this.image.setFloating($image);var link=$.trim($('#redactor-image-link').val());if(link!=='')
{var target=($('#redactor-image-link-blank').prop('checked'))?!0:!1;if($link.size()===0)
{var a=$('<a href="'+link+'">'+this.utils.getOuterHtml($image)+'</a>');if(target){a.attr('target','_blank')}
$image.replaceWith(a)}
else{$link.attr('href',link);if(target)
{$link.attr('target','_blank')}
else{$link.removeAttr('target')}}}
else{if($link.size()!==0)
{$link.replaceWith(this.utils.getOuterHtml($image))}}
this.modal.close();this.observe.images();this.code.sync()},setEditable:function($image)
{if(!this.opts.imageEditable){return}
$image.on('dragstart',$.proxy(this.image.onDrag,this));$image.on('mousedown',$.proxy(this.image.hideResize,this));$image.on('click touchstart',$.proxy(function(e)
{this.observe.image=$image;if(this.$editor.find('#redactor-image-box').size()!==0){return!1}
this.image.resizer=this.image.loadEditableControls($image);$(document).on('click.redactor-image-resize-hide',$.proxy(this.image.hideResize,this));this.$editor.on('click.redactor-image-resize-hide',$.proxy(this.image.hideResize,this));if(!this.opts.imageResizable){return}
this.image.resizer.on('mousedown.redactor touchstart.redactor',$.proxy(function(e)
{e.preventDefault();this.image.resizeHandle={x:e.pageX,y:e.pageY,el:$image,ratio:$image.width()/$image.height(),h:$image.height()};e=e.originalEvent||e;if(e.targetTouches)
{this.image.resizeHandle.x=e.targetTouches[0].pageX;this.image.resizeHandle.y=e.targetTouches[0].pageY}
this.image.startResize()},this))},this))},startResize:function()
{$(document).on('mousemove.redactor-image-resize touchmove.redactor-image-resize',$.proxy(this.image.moveResize,this));$(document).on('mouseup.redactor-image-resize touchend.redactor-image-resize',$.proxy(this.image.stopResize,this))},moveResize:function(e)
{e.preventDefault();e=e.originalEvent||e;var height=this.image.resizeHandle.h;if(e.targetTouches){height+=(e.targetTouches[0].pageY-this.image.resizeHandle.y)}
else{height+=(e.pageY-this.image.resizeHandle.y)}
var width=Math.round(height*this.image.resizeHandle.ratio);if(height<50||width<100){return}
this.image.resizeHandle.el.width(width);this.image.resizeHandle.el.height(this.image.resizeHandle.el.width()/this.image.resizeHandle.ratio);this.code.sync()},stopResize:function()
{this.handle=!1;$(document).off('.redactor-image-resize');this.image.hideResize()},onDrag:function(e)
{if(this.$editor.find('#redactor-image-box').size()!==0)
{e.preventDefault();return!1}
this.$editor.on('drop.redactor-image-inside-drop',$.proxy(function()
{setTimeout($.proxy(this.image.onDrop,this),1)},this))},onDrop:function()
{this.image.fixImageSourceAfterDrop();this.observe.images();this.$editor.off('drop.redactor-image-inside-drop');this.clean.clearUnverified();this.code.sync()},fixImageSourceAfterDrop:function()
{this.$editor.find('img[data-save-url]').each(function()
{var $el=$(this);$el.attr('src',$el.attr('data-save-url'));$el.removeAttr('data-save-url')})},hideResize:function(e)
{if(e&&$(e.target).closest('#redactor-image-box').length!==0){return}
if(e&&e.target.tagName=='IMG')
{var $image=$(e.target);$image.attr('data-save-url',$image.attr('src'))}
var imageBox=this.$editor.find('#redactor-image-box');if(imageBox.size()===0){return}
this.image.editter.remove();$(this.image.resizer).remove();imageBox.find('img').css({marginTop:imageBox[0].style.marginTop,marginBottom:imageBox[0].style.marginBottom,marginLeft:imageBox[0].style.marginLeft,marginRight:imageBox[0].style.marginRight});imageBox.css('margin','');imageBox.find('img').css('opacity','');imageBox.replaceWith(function()
{return $(this).contents()});$(document).off('click.redactor-image-resize-hide');this.$editor.off('click.redactor-image-resize-hide');if(typeof this.image.resizeHandle!=='undefined')
{this.image.resizeHandle.el.attr('rel',this.image.resizeHandle.el.attr('style'))}
this.code.sync()},loadEditableControls:function($image)
{var imageBox=$('<span id="redactor-image-box" data-redactor="verified">');imageBox.css('float',$image.css('float')).attr('contenteditable',!1);if($image[0].style.margin!='auto')
{imageBox.css({marginTop:$image[0].style.marginTop,marginBottom:$image[0].style.marginBottom,marginLeft:$image[0].style.marginLeft,marginRight:$image[0].style.marginRight});$image.css('margin','')}
else{imageBox.css({'display':'block','margin':'auto'})}
$image.css('opacity','.5').after(imageBox);this.image.editter=$('<span id="redactor-image-editter" data-redactor="verified">'+this.lang.get('edit')+'</span>');this.image.editter.attr('contenteditable',!1);this.image.editter.on('click',$.proxy(function()
{this.image.showEdit($image)},this));imageBox.append(this.image.editter);var editerWidth=this.image.editter.innerWidth();this.image.editter.css('margin-left','-'+editerWidth/2+'px');if(this.opts.imageResizable&&!this.utils.isMobile())
{var imageResizer=$('<span id="redactor-image-resizer" data-redactor="verified"></span>');if(!this.utils.isDesktop())
{imageResizer.css({width:'15px',height:'15px'})}
imageResizer.attr('contenteditable',!1);imageBox.append(imageResizer);imageBox.append($image);return imageResizer}
else{imageBox.append($image);return!1}},remove:function(image)
{var $image=$(image);var $link=$image.closest('a');var $figure=$image.closest('figure');var $parent=$image.parent();if($('#redactor-image-box').size()!==0)
{$parent=$('#redactor-image-box').parent()}
var $next;if($figure.size()!==0)
{$next=$figure.next();$figure.remove()}
else{if($link.size()!==0)
{$parent=$link.parent();$link.remove()}
else{$image.remove()}}
$('#redactor-image-box').remove();if($figure.size()!==0)
{this.caret.setStart($next)}
else{this.caret.setStart($parent)}
this.core.setCallback('imageDelete',$image[0].src,$image);this.modal.close();this.code.sync()},insert:function(json,direct,e)
{if(typeof json.error!='undefined')
{this.modal.close();this.selection.restore();this.core.setCallback('imageUploadError',json);return}
var $img;if(typeof json=='string')
{$img=$(json).attr('data-redactor-inserted-image','true')}
else{$img=$('<img>');$img.attr('src',json.filelink).attr('data-redactor-inserted-image','true')}
var node=$img;var isP=this.utils.isCurrentOrParent('P');if(isP)
{node=$('<blockquote />').append($img)}
if(direct)
{this.selection.removeMarkers();var marker=this.selection.getMarker();this.insert.nodeToCaretPositionFromPoint(e,marker)}
else{this.modal.close()}
this.selection.restore();this.buffer.set();this.insert.html(this.utils.getOuterHtml(node),!1);var $image=this.$editor.find('img[data-redactor-inserted-image=true]').removeAttr('data-redactor-inserted-image');if(isP)
{$image.parent().contents().unwrap().wrap('<p />')}
else{if(this.opts.linebreaks)
{$image.before('<br>').after('<br>')}}
if(typeof json=='string'){return}
this.core.setCallback('imageUpload',$image,json)}}},indent:function()
{return{increase:function()
{if(!this.utils.browser('msie')){this.$editor.focus()}
this.buffer.set();this.selection.save();var block=this.selection.getBlock();if(block&&block.tagName=='LI')
{this.indent.increaseLists()}
else{if(block===!1&&this.opts.linebreaks)
{this.indent.increaseText()}
else{this.indent.increaseBlocks()}}
this.selection.restore();this.code.sync()},increaseLists:function()
{document.execCommand('indent');this.indent.fixEmptyIndent();this.clean.normalizeLists();this.clean.clearUnverified()},increaseBlocks:function()
{$.each(this.selection.getBlocks(),$.proxy(function(i,elem)
{if(elem.tagName==='TD'||elem.tagName==='TH'){return}
var $el=this.utils.getAlignmentElement(elem);var left=this.utils.normalize($el.css('margin-left'))+this.opts.indentValue;$el.css('margin-left',left+'px')},this))},increaseText:function()
{var wrapper=this.selection.wrap('div');$(wrapper).attr('data-tagblock','redactor');$(wrapper).css('margin-left',this.opts.indentValue+'px')},decrease:function()
{this.buffer.set();this.selection.save();var block=this.selection.getBlock();if(block&&block.tagName=='LI')
{this.indent.decreaseLists()}
else{this.indent.decreaseBlocks()}
this.selection.restore();this.code.sync()},decreaseLists:function()
{document.execCommand('outdent');var current=this.selection.getCurrent();var $item=$(current).closest('li');var $parent=$item.parent();if($item.size()!==0&&$parent.size()!==0&&$parent[0].tagName=='LI')
{$parent.after($item)}
this.indent.fixEmptyIndent();if(!this.opts.linebreaks&&$item.size()===0)
{document.execCommand('formatblock',!1,'p');this.$editor.find('ul, ol, blockquote, p').each($.proxy(this.utils.removeEmpty,this))}
this.clean.clearUnverified()},decreaseBlocks:function()
{$.each(this.selection.getBlocks(),$.proxy(function(i,elem)
{var $el=this.utils.getAlignmentElement(elem);var left=this.utils.normalize($el.css('margin-left'))-this.opts.indentValue;if(left<=0)
{if(this.opts.linebreaks&&typeof($el.data('tagblock'))!=='undefined')
{$el.replaceWith($el.html()+'<br />')}
else{$el.css('margin-left','');this.utils.removeEmptyAttr($el,'style')}}
else{$el.css('margin-left',left+'px')}},this))},fixEmptyIndent:function()
{var block=this.selection.getBlock();if(this.range.collapsed&&block&&block.tagName=='LI'&&this.utils.isEmpty($(block).text()))
{var $block=$(block);$block.find('span').not('.redactor-selection-marker').contents().unwrap();$block.append('<br>')}}}},inline:function()
{return{formatting:function(name)
{var type,value;if(typeof this.formatting[name].style!='undefined'){type='style'}
else{if(typeof this.formatting[name].class!='undefined'){type='class'}}
if(type){value=this.formatting[name][type]}
this.inline.format(this.formatting[name].tag,type,value)},format:function(tag,type,value)
{if(this.utils.isCurrentOrParent('PRE')){return}
var tags=['b','bold','i','italic','underline','strikethrough','deleted','superscript','subscript'];var replaced=['strong','strong','em','em','u','del','del','sup','sub'];for(var i=0;i<tags.length;i++)
{if(tag==tags[i]){tag=replaced[i]}}
this.inline.type=type||!1;this.inline.value=value||!1;this.buffer.set();this.$editor.focus();this.selection.get();if(this.range.collapsed)
{this.inline.formatCollapsed(tag)}
else{this.inline.formatMultiple(tag)}},formatCollapsed:function(tag)
{var current=this.selection.getCurrent();var $parent=$(current).closest(tag+'[data-redactor-tag='+tag+']');if($parent.size()!==0)
{this.caret.setAfter($parent[0]);if(this.utils.isEmpty($parent.text())){$parent.remove()}
this.code.sync();return}
var node=$('<'+tag+'>').attr('data-verified','redactor').attr('data-redactor-tag',tag);node.html(this.opts.invisibleSpace);node=this.inline.setFormat(node);this.insert.node(node);this.code.sync();return},formatMultiple:function(tag)
{this.inline.formatConvert(tag);this.selection.save();this.selection.restore();document.execCommand('strikethrough');this.$editor.find('strike').each($.proxy(function(i,s)
{var $el=$(s);this.inline.formatRemoveSameChildren($el,tag);var $span;if(this.inline.type)
{$span=$('<span>').attr('data-redactor-tag',tag).attr('data-verified','redactor');$span=this.inline.setFormat($span)}
else{$span=$('<'+tag+'>').attr('data-redactor-tag',tag).attr('data-verified','redactor')}
$el.replaceWith($span.html($el.contents()));if(tag=='span')
{var $parent=$span.parent();if($parent&&$parent[0].tagName=='SPAN'&&this.inline.type=='style')
{var arr=this.inline.value.split(';');for(var z=0;z<arr.length;z++)
{if(arr[z]===''){return}
var style=arr[z].split(':');$parent.css(style[0],'');if(this.utils.removeEmptyAttr($parent,'style'))
{$parent.replaceWith($parent.contents())}}}}},this));if(tag!='span')
{this.$editor.find(this.opts.inlineTags.join(', ')).each($.proxy(function(i,s)
{var $el=$(s);var property=$el.css('text-decoration');if(property=='line-through')
{$el.css('text-decoration','');this.utils.removeEmptyAttr($el,'style')}},this))}
if(tag!='del')
{var _this=this;this.$editor.find('inline').each(function(i,s)
{_this.utils.replaceToTag(s,'del')})}
this.selection.restore();this.code.sync()},formatRemoveSameChildren:function($el,tag)
{$el.children(tag).each(function()
{var $child=$(this);if(!$child.hasClass('redactor-selection-marker'))
{$child.contents().unwrap()}})},formatConvert:function(tag)
{this.selection.save();var find='';if(this.inline.type=='class'){find='[data-redactor-class='+this.inline.value+']'}
else{if(this.inline.type=='style')
{find='[data-redactor-style="'+this.inline.value+'"]'}}
if(tag!='del')
{var self=this;this.$editor.find('del').each(function(i,s)
{self.utils.replaceToTag(s,'inline')})}
this.$editor.find('[data-redactor-tag="'+tag+'"]'+find).each(function()
{if(find===''&&tag=='span'&&this.tagName.toLowerCase()==tag){return}
var $el=$(this);$el.replaceWith($('<strike />').html($el.contents()))});this.selection.restore()},setFormat:function(node)
{switch(this.inline.type)
{case 'class':if(node.hasClass(this.inline.value))
{node.removeClass(this.inline.value);node.removeAttr('data-redactor-class')}
else{node.addClass(this.inline.value);node.attr('data-redactor-class',this.inline.value)}
break;case 'style':node[0].style.cssText=this.inline.value;node.attr('data-redactor-style',this.inline.value);break}
return node},removeStyle:function()
{this.buffer.set();var current=this.selection.getCurrent();var nodes=this.selection.getInlines();this.selection.save();if(current&&current.tagName==='SPAN')
{var $s=$(current);$s.removeAttr('style');if($s[0].attributes.length===0)
{$s.replaceWith($s.contents())}}
$.each(nodes,$.proxy(function(i,s)
{var $s=$(s);if($.inArray(s.tagName.toLowerCase(),this.opts.inlineTags)!=-1&&!$s.hasClass('redactor-selection-marker'))
{$s.removeAttr('style');if($s[0].attributes.length===0)
{$s.replaceWith($s.contents())}}},this));this.selection.restore();this.code.sync()},removeStyleRule:function(name)
{this.buffer.set();var parent=this.selection.getParent();var nodes=this.selection.getInlines();this.selection.save();if(parent&&parent.tagName==='SPAN')
{var $s=$(parent);$s.css(name,'');this.utils.removeEmptyAttr($s,'style');if($s[0].attributes.length===0)
{$s.replaceWith($s.contents())}}
$.each(nodes,$.proxy(function(i,s)
{var $s=$(s);if($.inArray(s.tagName.toLowerCase(),this.opts.inlineTags)!=-1&&!$s.hasClass('redactor-selection-marker'))
{$s.css(name,'');this.utils.removeEmptyAttr($s,'style');if($s[0].attributes.length===0)
{$s.replaceWith($s.contents())}}},this));this.selection.restore();this.code.sync()},removeFormat:function()
{this.buffer.set();var current=this.selection.getCurrent();this.selection.save();document.execCommand('removeFormat');if(current&&current.tagName==='SPAN')
{$(current).replaceWith($(current).contents())}
$.each(this.selection.getNodes(),$.proxy(function(i,s)
{var $s=$(s);if($.inArray(s.tagName.toLowerCase(),this.opts.inlineTags)!=-1&&!$s.hasClass('redactor-selection-marker'))
{$s.replaceWith($s.contents())}},this));this.selection.restore();this.code.sync()},toggleClass:function(className)
{this.inline.format('span','class',className)},toggleStyle:function(value)
{this.inline.format('span','style',value)}}},insert:function()
{return{set:function(html,clean)
{this.placeholder.remove();html=this.clean.setVerified(html);if(typeof clean=='undefined')
{html=this.clean.onPaste(html,!1)}
this.$editor.html(html);this.selection.remove();this.focus.setEnd();this.clean.normalizeLists();this.code.sync();this.observe.load();if(typeof clean=='undefined')
{setTimeout($.proxy(this.clean.clearUnverified,this),10)}},text:function(text)
{this.placeholder.remove();text=text.toString();text=$.trim(text);text=this.clean.getPlainText(text,!1);this.$editor.focus();if(this.utils.browser('msie'))
{this.insert.htmlIe(text)}
else{this.selection.get();this.range.deleteContents();var el=document.createElement("div");el.innerHTML=text;var frag=document.createDocumentFragment(),node,lastNode;while((node=el.firstChild))
{lastNode=frag.appendChild(node)}
this.range.insertNode(frag);if(lastNode)
{var range=this.range.cloneRange();range.setStartAfter(lastNode);range.collapse(!0);this.sel.removeAllRanges();this.sel.addRange(range)}}
this.code.sync();this.clean.clearUnverified()},htmlWithoutClean:function(html)
{this.insert.html(html,!1)},html:function(html,clean)
{this.placeholder.remove();if(typeof clean=='undefined'){clean=!0}
this.$editor.focus();html=this.clean.setVerified(html);if(clean)
{html=this.clean.onPaste(html)}
if(this.utils.browser('msie'))
{this.insert.htmlIe(html)}
else{if(this.clean.singleLine){this.insert.execHtml(html)}
else{document.execCommand('insertHTML',null,html)}
this.insert.htmlFixMozilla()}
this.clean.normalizeLists();if(!this.opts.linebreaks)
{this.$editor.find('p').each($.proxy(this.utils.removeEmpty,this))}
this.code.sync();this.observe.load();if(clean)
{this.clean.clearUnverified()}},htmlFixMozilla:function()
{if(!this.utils.browser('mozilla')){return}
var $next=$(this.selection.getBlock()).next();if($next.length>0&&$next[0].tagName=='P'&&$next.html()==='')
{$next.remove()}},htmlIe:function(html)
{if(this.utils.isIe11())
{var parent=this.utils.isCurrentOrParent('P');var $html=$('<div>').append(html);var blocksMatch=$html.contents().is('p, :header, dl, ul, ol, div, table, td, blockquote, pre, address, section, header, footer, aside, article');if(parent&&blocksMatch){this.insert.ie11FixInserting(parent,html)}
else{this.insert.ie11PasteFrag(html)}
return}
document.selection.createRange().pasteHTML(html)},execHtml:function(html)
{html=this.clean.setVerified(html);this.selection.get();this.range.deleteContents();var el=document.createElement('div');el.innerHTML=html;var frag=document.createDocumentFragment(),node,lastNode;while((node=el.firstChild))
{lastNode=frag.appendChild(node)}
this.range.insertNode(frag);this.range.collapse(!0);this.caret.setAfter(lastNode)},node:function(node,deleteContents)
{node=node[0]||node;var html=this.utils.getOuterHtml(node);html=this.clean.setVerified(html);node=$(html)[0];this.selection.get();if(deleteContents!==!1)
{this.range.deleteContents()}
this.range.insertNode(node);this.range.collapse(!1);this.selection.addRange();return node},nodeToPoint:function(node,x,y)
{node=node[0]||node;this.selection.get();var range;if(document.caretPositionFromPoint)
{var pos=document.caretPositionFromPoint(x,y);this.range.setStart(pos.offsetNode,pos.offset);this.range.collapse(!0);this.range.insertNode(node)}
else{if(document.caretRangeFromPoint)
{range=document.caretRangeFromPoint(x,y);range.insertNode(node)}
else{if(typeof document.body.createTextRange!="undefined")
{range=document.body.createTextRange();range.moveToPoint(x,y);var endRange=range.duplicate();endRange.moveToPoint(x,y);range.setEndPoint("EndToEnd",endRange);range.select()}}}},nodeToCaretPositionFromPoint:function(e,node)
{node=node[0]||node;var range;var x=e.clientX,y=e.clientY;if(document.caretPositionFromPoint)
{var pos=document.caretPositionFromPoint(x,y);var sel=document.getSelection();range=sel.getRangeAt(0);range.setStart(pos.offsetNode,pos.offset);range.collapse(!0);range.insertNode(node)}
else{if(document.caretRangeFromPoint)
{range=document.caretRangeFromPoint(x,y);range.insertNode(node)}
else{if(typeof document.body.createTextRange!="undefined")
{range=document.body.createTextRange();range.moveToPoint(x,y);var endRange=range.duplicate();endRange.moveToPoint(x,y);range.setEndPoint("EndToEnd",endRange);range.select()}}}},ie11FixInserting:function(parent,html)
{var node=document.createElement('span');node.className='redactor-ie-paste';this.insert.node(node);var parHtml=$(parent).html();parHtml='<p>'+parHtml.replace(/<span class="redactor-ie-paste"><\/span>/gi,'</p>'+html+'<p>')+'</p>';$(parent).replaceWith(parHtml)},ie11PasteFrag:function(html)
{this.selection.get();this.range.deleteContents();var el=document.createElement("div");el.innerHTML=html;var frag=document.createDocumentFragment(),node,lastNode;while((node=el.firstChild))
{lastNode=frag.appendChild(node)}
this.range.insertNode(frag)}}},keydown:function()
{return{init:function(e)
{if(this.rtePaste){return}
var key=e.which;var arrow=(key>=37&&key<=40);this.keydown.ctrl=e.ctrlKey||e.metaKey;this.keydown.current=this.selection.getCurrent();this.keydown.parent=this.selection.getParent();this.keydown.block=this.selection.getBlock();this.keydown.pre=this.utils.isTag(this.keydown.current,'pre');this.keydown.blockquote=this.utils.isTag(this.keydown.current,'blockquote');this.keydown.figcaption=this.utils.isTag(this.keydown.current,'figcaption');this.shortcuts.init(e,key);this.keydown.checkEvents(arrow,key);this.keydown.setupBuffer(e,key);this.keydown.addArrowsEvent(arrow);this.keydown.setupSelectAll(e,key);var keydownStop=this.core.setCallback('keydown',e);if(keydownStop===!1)
{e.preventDefault();return!1}
if(this.opts.enterKey&&key===this.keyCode.DOWN)
{this.keydown.onArrowDown()}
if(!this.opts.enterKey&&key===this.keyCode.ENTER)
{e.preventDefault();if(!this.range.collapsed){this.range.deleteContents()}
return}
if(key==this.keyCode.ENTER&&!e.shiftKey&&!e.ctrlKey&&!e.metaKey)
{var stop=this.core.setCallback('enter',e);if(stop===!1)
{e.preventDefault();return!1}
if(this.keydown.blockquote&&this.keydown.exitFromBlockquote(e)===!0)
{return!1}
var current,$next;if(this.keydown.pre)
{return this.keydown.insertNewLine(e)}
else{if(this.keydown.blockquote||this.keydown.figcaption)
{current=this.selection.getCurrent();$next=$(current).next();if($next.size()!==0&&$next[0].tagName=='BR')
{return this.keydown.insertBreakLine(e)}
else{if(this.utils.isEndOfElement()&&(current&&current!='SPAN'))
{return this.keydown.insertDblBreakLine(e)}
else{return this.keydown.insertBreakLine(e)}}}
else{if(this.opts.linebreaks&&!this.keydown.block)
{current=this.selection.getCurrent();$next=$(this.keydown.current).next();if(current!==!1&&$(current).hasClass('redactor-invisible-space'))
{$(current).remove();return this.keydown.insertDblBreakLine(e)}
else{if($next.length===0&&current===!1&&typeof $next.context!='undefined')
{return this.keydown.insertDblBreakLine(e)}
return this.keydown.insertBreakLine(e)}}
else{if(this.opts.linebreaks&&this.keydown.block)
{setTimeout($.proxy(this.keydown.replaceDivToBreakLine,this),1)}
else{if(!this.opts.linebreaks&&this.keydown.block&&this.keydown.block.tagName!=='LI')
{setTimeout($.proxy(this.keydown.replaceDivToParagraph,this),1)}
else{if(!this.opts.linebreaks&&!this.keydown.block)
{return this.keydown.insertParagraph(e)}}}}}}}
if(key===this.keyCode.ENTER&&(e.ctrlKey||e.shiftKey))
{return this.keydown.onShiftEnter(e)}
if(key===this.keyCode.TAB||e.metaKey&&key===221||e.metaKey&&key===219)
{return this.keydown.onTab(e,key)}
if(key===this.keyCode.BACKSPACE||key===this.keyCode.DELETE)
{var nodes=this.selection.getNodes();if(nodes)
{var len=nodes.length;var last;for(var i=0;i<len;i++)
{var children=$(nodes[i]).children('img');if(children.size()!==0)
{var self=this;$.each(children,function(z,s)
{var $s=$(s);if($s.css('float')!='none'){return}
self.core.setCallback('imageDelete',s.src,$s);last=s})}
else{if(nodes[i].tagName=='IMG')
{if(last!=nodes[i])
{this.core.setCallback('imageDelete',nodes[i].src,$(nodes[i]));last=nodes[i]}}}}}}
if(key===this.keyCode.BACKSPACE||key===this.keyCode.DELETE)
{this.selection.save();this.keydown.removeInvisibleSpace();this.keydown.removeEmptyListInTable(e);this.selection.restore()}
this.code.sync()},checkEvents:function(arrow,key)
{if(!arrow&&(this.core.getEvent()=='click'||this.core.getEvent()=='arrow'))
{this.core.addEvent(!1);if(this.keydown.checkKeyEvents(key))
{this.buffer.set()}}},checkKeyEvents:function(key)
{var k=this.keyCode;var keys=[k.BACKSPACE,k.DELETE,k.ENTER,k.SPACE,k.ESC,k.TAB,k.CTRL,k.META,k.ALT,k.SHIFT];return($.inArray(key,keys)==-1)?!0:!1},addArrowsEvent:function(arrow)
{if(!arrow){return}
if((this.core.getEvent()=='click'||this.core.getEvent()=='arrow'))
{this.core.addEvent(!1);return}
this.core.addEvent('arrow')},setupBuffer:function(e,key)
{if(this.keydown.ctrl&&key===90&&!e.shiftKey&&!e.altKey&&this.opts.buffer.length)
{e.preventDefault();this.buffer.undo();return}
else{if(this.keydown.ctrl&&key===90&&e.shiftKey&&!e.altKey&&this.opts.rebuffer.length!==0)
{e.preventDefault();this.buffer.redo();return}
else{if(!this.keydown.ctrl)
{if(key==this.keyCode.BACKSPACE||key==this.keyCode.DELETE||(key==this.keyCode.ENTER&&!e.ctrlKey&&!e.shiftKey)||key==this.keyCode.SPACE)
{this.buffer.set()}}}}},setupSelectAll:function(e,key)
{if(this.keydown.ctrl&&key===65)
{this.utils.enableSelectAll()}
else{if(key!=this.keyCode.LEFT_WIN&&!this.keydown.ctrl)
{this.utils.disableSelectAll()}}},onArrowDown:function()
{var tags=[this.keydown.blockquote,this.keydown.pre,this.keydown.figcaption];for(var i=0;i<tags.length;i++)
{if(tags[i])
{this.keydown.insertAfterLastElement(tags[i]);return!1}}},onShiftEnter:function(e)
{this.buffer.set();if(this.keydown.blockquote&&this.utils.isEndOfElement())
{return this.keydown.insertDblBreakLine(e)}
return this.keydown.insertBreakLine(e)},onTab:function(e,key)
{if(!this.opts.tabFocus){return!0}
if(this.utils.isEmpty(this.code.get())&&this.opts.tabAsSpaces===!1){return!0}
e.preventDefault();var node;if(this.keydown.pre&&!e.shiftKey)
{node=(this.opts.preSpaces)?document.createTextNode(Array(this.opts.preSpaces+1).join('\u00a0')):document.createTextNode('\t');this.insert.node(node);this.code.sync()}
else{if(this.opts.tabAsSpaces!==!1)
{node=document.createTextNode(Array(this.opts.tabAsSpaces+1).join('\u00a0'));this.insert.node(node);this.code.sync()}
else{if(e.metaKey&&key===219){this.indent.decrease()}else{if(e.metaKey&&key===221){this.indent.increase()}else{if(!e.shiftKey){this.indent.increase()}
else{this.indent.decrease()}}}}}
return!1},replaceDivToBreakLine:function()
{var blockElem=this.selection.getBlock();var blockHtml=blockElem.innerHTML.replace(/<br\s?\/?>/gi,'');if((blockElem.tagName==='DIV'||blockElem.tagName==='P')&&blockHtml===''&&!$(blockElem).hasClass('redactor-editor'))
{var br=document.createElement('br');$(blockElem).replaceWith(br);this.caret.setBefore(br);this.code.sync();return!1}},replaceDivToParagraph:function()
{var blockElem=this.selection.getBlock();var blockHtml=blockElem.innerHTML.replace(/<br\s?\/?>/gi,'');if(blockElem.tagName==='DIV'&&blockHtml===''&&!$(blockElem).hasClass('redactor-editor'))
{var p=document.createElement('p');p.innerHTML=this.opts.invisibleSpace;$(blockElem).replaceWith(p);this.caret.setStart(p);this.code.sync();return!1}
else{if(this.opts.cleanStyleOnEnter&&blockElem.tagName=='P')
{$(blockElem).removeAttr('class').removeAttr('style')}}},insertParagraph:function(e)
{e.preventDefault();this.selection.get();var p=document.createElement('p');p.innerHTML=this.opts.invisibleSpace;this.range.deleteContents();this.range.insertNode(p);this.caret.setStart(p);this.code.sync();return!1},exitFromBlockquote:function(e)
{if(!this.utils.isEndOfElement()){return}
var tmp=$.trim($(this.keydown.block).html());if(tmp.search(/(<br\s?\/?>){2}$/i)!=-1)
{e.preventDefault();if(this.opts.linebreaks)
{var br=document.createElement('br');$(this.keydown.blockquote).after(br);this.caret.setBefore(br);$(this.keydown.block).html(tmp.replace(/<br\s?\/?>$/i,''))}
else{var node=$(this.opts.emptyHtml);$(this.keydown.blockquote).after(node);this.caret.setStart(node)}
return!0}
return},insertAfterLastElement:function(element)
{if(!this.utils.isEndOfElement()){return}
this.buffer.set();if(this.opts.linebreaks)
{var contents=$('<div>').append($.trim(this.$editor.html())).contents();var last=contents.last()[0];if(last.tagName=='SPAN'&&last.innerHTML==='')
{last=contents.prev()[0]}
if(this.utils.getOuterHtml(last)!=this.utils.getOuterHtml(element)){return}
var br=document.createElement('br');$(element).after(br);this.caret.setAfter(br)}
else{if(this.$editor.contents().last()[0]!==element){return}
var node=$(this.opts.emptyHtml);$(element).after(node);this.caret.setStart(node)}},insertNewLine:function(e)
{e.preventDefault();var node=document.createTextNode('\n');this.selection.get();this.range.deleteContents();this.range.insertNode(node);this.caret.setAfter(node);this.code.sync();return!1},insertBreakLine:function(e)
{return this.keydown.insertBreakLineProcessing(e)},insertDblBreakLine:function(e)
{return this.keydown.insertBreakLineProcessing(e,!0)},insertBreakLineProcessing:function(e,dbl)
{e.stopPropagation();this.selection.get();var br1=document.createElement('br');this.range.deleteContents();this.range.insertNode(br1);if(dbl===!0)
{var br2=document.createElement('br');this.range.insertNode(br2);this.caret.setAfter(br2)}
else{this.caret.setAfter(br1)}
this.code.sync();return!1},removeInvisibleSpace:function()
{var $current=$(this.keydown.current);if($current.text().search(/^\u200B$/g)===0)
{$current.remove()}},removeEmptyListInTable:function(e)
{var $current=$(this.keydown.current);var $parent=$(this.keydown.parent);var td=$current.closest('td');if(td.size()!==0&&$current.closest('li')&&$parent.children('li').size()===1)
{if(!this.utils.isEmpty($current.text())){return}
e.preventDefault();$current.remove();$parent.remove();this.caret.setStart(td)}}}},keyup:function()
{return{init:function(e)
{if(this.rtePaste){return}
var key=e.which;this.keyup.current=this.selection.getCurrent();this.keyup.parent=this.selection.getParent();var $parent=this.utils.isRedactorParent($(this.keyup.parent).parent());var keyupStop=this.core.setCallback('keyup',e);if(keyupStop===!1)
{e.preventDefault();return!1}
if(!this.opts.linebreaks&&this.keyup.current.nodeType==3&&this.keyup.current.length<=1&&(this.keyup.parent===!1||this.keyup.parent.tagName=='BODY'))
{this.keyup.replaceToParagraph()}
if(!this.opts.linebreaks&&$(this.keyup.parent).hasClass('redactor-invisible-space')&&($parent===!1||$parent[0].tagName=='BODY'))
{$(this.keyup.parent).contents().unwrap();this.keyup.replaceToParagraph()}
if(this.opts.convertLinks&&(this.opts.convertUrlLinks||this.opts.convertImageLinks||this.opts.convertVideoLinks)&&key===this.keyCode.ENTER)
{this.formatLinkify(this.opts.linkProtocol,this.opts.convertLinks,this.opts.convertUrlLinks,this.opts.convertImageLinks,this.opts.convertVideoLinks,this.opts.linkSize);this.observe.load();this.code.sync()}
if(key===this.keyCode.DELETE||key===this.keyCode.BACKSPACE)
{this.clean.clearUnverified();if(this.observe.image)
{e.preventDefault();this.image.hideResize();this.buffer.set();this.image.remove(this.observe.image);this.observe.image=!1;return!1}
this.$editor.find('p').each($.proxy(this.utils.removeEmpty,this));if(this.keyup.current&&this.keyup.current.tagName=='DIV'&&this.utils.isEmpty(this.keyup.current.innerHTML))
{if(this.opts.linebreaks)
{$(this.keyup.current).after(this.selection.getMarkerAsHtml());this.selection.restore();$(this.keyup.current).remove()}}
return this.keyup.formatEmpty(e)}},replaceToParagraph:function()
{var $current=$(this.keyup.current);var node=$('<p>').append($current.clone());$current.replaceWith(node);var next=$(node).next();if(typeof(next[0])!=='undefined'&&next[0].tagName=='BR')
{next.remove()}
this.caret.setEnd(node)},formatEmpty:function(e)
{var html=$.trim(this.$editor.html());if(!this.utils.isEmpty(html)){return}
e.preventDefault();if(this.opts.linebreaks)
{this.$editor.html(this.selection.getMarkerAsHtml());this.selection.restore()}
else{html='<p><br /></p>';this.$editor.html(html);this.focus.setStart()}
this.code.sync();return!1}}},lang:function()
{return{load:function()
{this.opts.curLang=this.opts.langs[this.opts.lang]},get:function(name)
{return(typeof this.opts.curLang[name]!='undefined')?this.opts.curLang[name]:''}}},line:function()
{return{insert:function()
{this.buffer.set();var blocks=this.selection.getBlocks();if(blocks[0]!==!1&&this.line.isExceptLastOrFirst(blocks))
{if(!this.utils.browser('msie')){this.$editor.focus()}
return}
if(this.utils.browser('msie'))
{this.line.insertInIe()}
else{this.line.insertInOthersBrowsers()}},isExceptLastOrFirst:function(blocks)
{var exceptTags=['li','td','th','blockquote','figcaption','pre','dl','dt','dd'];var first=blocks[0].tagName.toLowerCase();var last=this.selection.getLastBlock();last=(typeof last=='undefined')?first:last.tagName.toLowerCase();var firstFound=$.inArray(first,exceptTags)!=-1;var lastFound=$.inArray(last,exceptTags)!=-1;if((firstFound&&lastFound)||firstFound)
{return!0}},insertInIe:function()
{this.utils.saveScroll();this.buffer.set();this.insert.node(document.createElement('hr'));this.utils.restoreScroll();this.code.sync()},insertInOthersBrowsers:function()
{this.buffer.set();var extra='<p id="redactor-insert-line"><br /></p>';if(this.opts.linebreaks){extra='<br id="redactor-insert-line">'}
document.execCommand('insertHTML',!1,'<hr>'+extra);this.line.setFocus();this.code.sync()},setFocus:function()
{var node=this.$editor.find('#redactor-insert-line');var next=$(node).next()[0];if(next)
{this.caret.setAfter(node);node.remove()}
else{node.removeAttr('id')}}}},link:function()
{return{show:function(e)
{if(typeof e!='undefined'&&e.preventDefault){e.preventDefault()}
this.modal.load('link',this.lang.get('link_insert'),600);this.modal.createCancelButton();this.link.buttonInsert=this.modal.createActionButton(this.lang.get('insert'));this.selection.get();this.link.getData();this.link.cleanUrl();if(this.link.target=='_blank'){$('#redactor-link-blank').prop('checked',!0)}
this.link.$inputUrl=$('#redactor-link-url');this.link.$inputText=$('#redactor-link-url-text');this.link.$inputTextColor=$('#redactor-link-color-text');this.link.$inputLineColor=$('#redactor-link-color-line');this.link.$inputLineSize=$('#redactor-link-line-size');this.link.$inputRel=$('#redactor-link-nofollow');if(this.link.rel=='nofollow'){$('#redactor-link-show-seo').hide();$('#redactor-modal-link-insert').find('.redactor-link-seo').show();this.link.$inputRel.prop('checked','checked')}else{$('#redactor-modal-link-insert').find('.redactor-link-seo').hide();$('#redactor-link-show-seo').off('click');$('#redactor-link-show-seo').click(function(e){e.preventDefault();$(this).hide();$('#redactor-modal-link-insert').find('.redactor-link-seo').show();return!1})}
this.link.$inputText.val(this.link.text);this.link.$inputUrl.val(this.link.url);if(this.link.textcolor!=''){this.link.textcolor=this.link.rgb2hex(this.link.textcolor)}
this.link.$inputTextColor.val(this.link.textcolor);if(this.link.linecolor!=''){this.link.linecolor=this.link.rgb2hex(this.link.linecolor)}
this.link.$inputLineColor.val(this.link.linecolor);this.link.$inputLineSize.val(this.link.linesize);this.link.buttonInsert.on('click',$.proxy(this.link.insert,this));$('.redactor-link-tooltip').remove();this.selection.save();this.modal.show();this.link.$inputTextColor.minicolors({format:'rgb'});this.link.$inputLineColor.minicolors({format:'rgb'});this.link.$inputLineColor.closest('table').find('.minicolors-theme-default .minicolors-swatch').css('z-index','10');this.link.$inputUrl.focus();this.link.$inputUrl.off('change');this.link.$inputUrl.on('change',function(e){if($(this).val()>''){try{window.checkLinkCCtoWS($(this).val())}catch(err){}}})},rgb2hex:function(orig){try{var rgb=orig.replace(/\s/g,'').match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)/i);return(rgb&&rgb.length===4)?"#"+("0"+parseInt(rgb[1],10).toString(16)).slice(-2)+("0"+parseInt(rgb[2],10).toString(16)).slice(-2)+("0"+parseInt(rgb[3],10).toString(16)).slice(-2):orig}catch(e){}
return orig},cleanUrl:function()
{var thref=self.location.href.replace(/\/$/i,'');this.link.url=this.link.url.replace(thref,'');this.link.url=this.link.url.replace(/^\/#/,'#');this.link.url=this.link.url.replace('mailto:','');if(!this.opts.linkProtocol)
{var re=new RegExp('^(tel|vk|odnoklassniki|telegram|instagram|viber|skype|http|ftp|https)://'+self.location.host,'i');this.link.url=this.link.url.replace(re,'')}},getData:function()
{this.link.$node=!1;var $el=$(this.selection.getCurrent()).closest('a');if($el.size()!==0&&$el[0].tagName==='A')
{this.link.$node=$el;this.link.url='';this.link.text='';this.link.target='';this.link.textcolor='';this.link.linecolor='';this.link.linesize='';this.link.rel='';var idx,isTextDecoration='',arStyle,style=$el.attr('style');if(style>''){arStyle=style.split(';');for(idx in arStyle){style=arStyle[idx].split(':');style[0]=style[0].trim();switch(style[0]){case 'color':this.link.textcolor=style[1];this.link.textcolor=this.link.textcolor.replace('!important','');break;case 'border-bottom-color':this.link.linecolor=style[1];break;case 'border-bottom-width':this.link.linesize=parseInt(style[1]);break;case 'border-bottom':var tmp=style[1].trim().split(' ');this.link.linecolor=tmp[2];if(tmp[0].indexOf('px')>0){tmp[0]=tmp[0].substring(0,tmp[0].length-2)}
this.link.linesize=parseInt(tmp[0]);break;default:break}}}
var rel=$el.attr('data-rel');if(rel){this.link.rel=rel}
this.link.url=$el.attr('href');this.link.text=$el.text();this.link.target=$el.attr('target');if(parseInt(this.link.linesize)>0){var tmp=$el.css('box-shadow');if(tmp&&tmp.indexOf('inset')!=-1){tmp=tmp.replace(', ',',');tmp=tmp.replace(', ',',');tmp=tmp.replace(', ',',');tmp=tmp.split(' ');tmp=parseInt(tmp[2]);this.link.linesize-=tmp}}else{if(this.link.linesize!='0'){this.link.linesize=''}}
if(this.link.textcolor!=""&&this.link.linecolor==""&&this.link.linesize!=''){this.link.linecolor=this.link.textcolor}}
else{this.link.text=this.sel.toString();this.link.rel='';this.link.url='';this.link.target='';this.link.textcolor='';this.link.linecolor='';this.link.linesize=''}},insert:function()
{var target='';var link=this.link.$inputUrl.val();var text=this.link.$inputText.val();var textcolor=this.link.$inputTextColor.val();var linecolor=this.link.$inputLineColor.val();var linesize=this.link.$inputLineSize.val();var nofollow=this.link.$inputRel.prop('checked');if($.trim(link)==='')
{this.link.$inputUrl.addClass('redactor-input-error').on('keyup',function()
{$(this).removeClass('redactor-input-error');$(this).off('keyup')});return}
if(linesize>''&&linesize.indexOf('px')>0){linesize=linesize.replace(/[^0-9]+/g,'');if(linesize=='0'){linesize='0'}else{if(!linesize){linesize=''}}}
if(link.search('@')!=-1&&/(mailto|http|ftp|https):\/\//i.test(link)===!1)
{link='mailto:'+link}
else{if(link.search('#')!==0)
{if($('#redactor-link-blank').prop('checked'))
{target='_blank'}
var pattern='((xn--)?[a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}';var re=new RegExp('^(http|ftp|https)://'+pattern,'i');var re2=new RegExp('^'+pattern,'i');if(link.search(re)==-1&&link.search(re2)===0&&this.opts.linkProtocol)
{link=this.opts.linkProtocol+'://'+link}}}
this.link.set(text,link,target,textcolor,linecolor,linesize,nofollow);this.link.$inputUrl.off('change');this.modal.close()},set:function(text,link,target,textcolor,linecolor,linesize,nofollow)
{text=$.trim(text.replace(/<|>/g,''));this.selection.restore();if(text===''&&link===''){return}
if(text===''&&link!==''){text=link}
if(linesize!='0'&&linesize!=''&&linecolor==''&&textcolor!=''){linecolor=textcolor}
var style='';if(textcolor!=''){style=style+'color:'+textcolor+' !important;'}
if(linesize>''){var lineout,linein;if(parseInt(linesize)>=3){linein=linesize-2;lineout=2}else{if(parseInt(linesize)==2){linein=1;lineout=1}else{if(linesize=='0'){linein=0;lineout=0}else{linein=0;lineout=1}}}
style=style+'text-decoration: none;';if(linecolor!=''){style=style+'border-bottom: '+lineout+'px solid '+linecolor+';';style=style+'box-shadow: inset 0px -'+linein+'px 0px 0px '+linecolor+';';style=style+'-webkit-box-shadow: inset 0px -'+linein+'px 0px 0px '+linecolor+';';style=style+'-moz-box-shadow: inset 0px -'+linein+'px 0px 0px '+linecolor+';'}else{style=style+'border-bottom: '+lineout+'px solid;';style=style+'box-shadow: inset 0px -'+linein+'px 0px 0px;';style=style+'-webkit-box-shadow: inset 0px -'+linein+'px 0px 0px;';style=style+'-moz-box-shadow: inset 0px -'+linein+'px 0px 0px;'}}else{if(linecolor!=''){style=style+'border-bottom-color: '+linecolor+';'}}
if(this.link.$node)
{this.buffer.set();this.link.$node.text(text).attr('href',link);if(target!=='')
{this.link.$node.attr('target',target)}
else{this.link.$node.removeAttr('target')}
if(style>''){this.link.$node.attr('style',style).attr('data-verified','redactor').attr('data-redactor-tag','a')}
if(nofollow){this.link.$node.attr('data-rel','nofollow')}else{this.link.$node.removeAttr('data-rel')}
this.code.sync()}
else{if(this.utils.browser('mozilla')&&this.link.text==='')
{var $a=$('<a />').attr('href',link).text(text);if(target!==''){$a.attr('target',target)}
$a.attr('style',style).attr('data-verified','redactor').attr('data-redactor-tag','a');if(nofollow){$a.attr('data-rel','nofollow')}
this.insert.node($a);this.selection.selectElement($a)}
else{var $a;if(this.utils.browser('msie'))
{$a=$('<a href="'+link+'" style="'+style+'">').text(text);if(target!==''){$a.attr('target',target)}
if(nofollow){$a.attr('data-rel','nofollow')}
$a=$(this.insert.node($a));$a.attr('data-verified','redactor').attr('data-redactor-tag','a');this.selection.selectElement($a)}
else{document.execCommand('createLink',!1,link);$a=$(this.selection.getCurrent()).closest('a');if(target!==''){$a.attr('target',target)}
$a.attr('style',style);$a.attr('data-verified','redactor').attr('data-redactor-tag','a');if(nofollow){$a.attr('data-rel','nofollow')}
if(this.link.text==='')
{$a.text(text);this.selection.selectElement($a)}}
if(this.selection&&this.selection.getNodes()){var nodes=this.selection.getNodes();if(nodes.length>0){$a=$(nodes[0]);$a.attr('style',style);if(nofollow){$a.attr('data-rel','nofollow')}
$a.attr('data-verified','redactor').attr('data-redactor-tag','a')}}}
this.code.sync();this.core.setCallback('insertedLink',$a)}
setTimeout($.proxy(function()
{this.observe.links()},this),5)},unlink:function(e)
{if(typeof e!='undefined'&&e.preventDefault){e.preventDefault()}
var nodes=this.selection.getNodes();if(!nodes){return}
this.buffer.set();var len=nodes.length;for(var i=0;i<len;i++)
{if(nodes[i].tagName=='A')
{var $node=$(nodes[i]);$node.replaceWith($node.contents())}}
$('.redactor-link-tooltip').remove();this.code.sync()}}},list:function()
{return{toggle:function(cmd)
{if(!this.utils.browser('msie')){this.$editor.focus()}
this.buffer.set();this.selection.save();var parent=this.selection.getParent();var $list=$(parent).closest('ol, ul');if(!this.utils.isRedactorParent($list)&&$list.size()!==0)
{$list=!1}
var isUnorderedCmdOrdered,isOrderedCmdUnordered;var remove=!1;if($list&&$list.length)
{remove=!0;var listTag=$list[0].tagName;isUnorderedCmdOrdered=(cmd==='orderedlist'&&listTag==='UL');isOrderedCmdUnordered=(cmd==='unorderedlist'&&listTag==='OL')}
if(isUnorderedCmdOrdered)
{this.utils.replaceToTag($list,'ol')}
else{if(isOrderedCmdUnordered)
{this.utils.replaceToTag($list,'ul')}
else{if(remove)
{this.list.remove(cmd)}
else{this.list.insert(cmd)}}}
this.selection.restore();this.code.sync()},insert:function(cmd)
{if(this.utils.browser('msie')&&this.opts.linebreaks)
{this.list.insertInIe(cmd)}
else{document.execCommand('insert'+cmd)}
var parent=this.selection.getParent();var $list=$(parent).closest('ol, ul');if(this.utils.isEmpty($list.find('li').text()))
{var $children=$list.children('li');$children.find('br').remove();$children.append(this.selection.getMarkerAsHtml())}
if($list.length)
{var $listParent=$list.parent();if(this.utils.isRedactorParent($listParent)&&$listParent[0].tagName!='LI'&&this.utils.isBlock($listParent[0]))
{$listParent.replaceWith($listParent.contents())}}
if(!this.utils.browser('msie'))
{this.$editor.focus()}
this.clean.clearUnverified()},insertInIe:function(cmd)
{var wrapper=this.selection.wrap('div');var wrapperHtml=$(wrapper).html();var tmpList=(cmd=='orderedlist')?$('<ol>'):$('<ul>');var tmpLi=$('<li>');if($.trim(wrapperHtml)==='')
{tmpLi.append(this.selection.getMarkerAsHtml());tmpList.append(tmpLi);this.$editor.find('#selection-marker-1').replaceWith(tmpList)}
else{var items=wrapperHtml.split(/<br\s?\/?>/gi);if(items)
{for(var i=0;i<items.length;i++)
{if($.trim(items[i])!=='')
{tmpList.append($('<li>').html(items[i]))}}}
else{tmpLi.append(wrapperHtml);tmpList.append(tmpLi)}
$(wrapper).replaceWith(tmpList)}},remove:function(cmd)
{var html='';var $list=$(this.selection.getCurrent());$list=$list.closest('ul,ol');$list.find('li').each(function(){var str=$(this).html();str=str.replace(/<span><\/span>/g,'');str=str.replace(/<span> <\/span>/g,' ');if(str.substring(str.length-3)=='br>'){html=html+str}else{html=html+str+"<br>"}});$($list).replaceWith(function(){return $(html)});var $current=$(this.selection.getCurrent());this.indent.fixEmptyIndent();if(!this.opts.linebreaks&&$current.closest('li, th, td').size()===0)
{document.execCommand('formatblock',!1,'p');this.$editor.find('ul, ol, blockquote').each($.proxy(this.utils.removeEmpty,this))}
var $table=$(this.selection.getCurrent()).closest('table');var $prev=$table.prev();if(!this.opts.linebreaks&&$table.size()!==0&&$prev.size()!==0&&$prev[0].tagName=='BR')
{$prev.remove()}
this.clean.clearUnverified()}}},modal:function()
{return{callbacks:{},loadTemplates:function()
{this.opts.modal={imageEdit:String()+'<section id="redactor-modal-image-edit">'+'<label>'+this.lang.get('title')+'</label>'+'<input type="text" id="redactor-image-title" />'+'<label class="redactor-image-link-option">'+this.lang.get('link')+'</label>'+'<input type="text" id="redactor-image-link" class="redactor-image-link-option" />'+'<label class="redactor-image-link-option"><input type="checkbox" id="redactor-image-link-blank"> '+this.lang.get('link_new_tab')+'</label>'+'<label class="redactor-image-position-option">'+this.lang.get('image_position')+'</label>'+'<select class="redactor-image-position-option" id="redactor-image-align">'+'<option value="none">'+this.lang.get('none')+'</option>'+'<option value="left">'+this.lang.get('left')+'</option>'+'<option value="center">'+this.lang.get('center')+'</option>'+'<option value="right">'+this.lang.get('right')+'</option>'+'</select>'+'</section>',image:String()+'<section id="redactor-modal-image-insert">'+'<div id="redactor-modal-image-droparea"></div>'+'</section>',file:String()+'<section id="redactor-modal-file-insert">'+'<div id="redactor-modal-file-upload-box">'+'<label>'+this.lang.get('filename')+'</label>'+'<input type="text" id="redactor-filename" /><br><br>'+'<div id="redactor-modal-file-upload"></div>'+'</div>'+'</section>',link:String()+'<section id="redactor-modal-link-insert" style="margin-bottom: 30px;">'+'<label>URL</label>'+'<input type="url" id="redactor-link-url" />'+'<label>'+this.lang.get('text')+'</label>'+'<input type="text" id="redactor-link-url-text" />'+'<label><input type="checkbox" id="redactor-link-blank"> '+this.lang.get('link_new_tab')+'</label>'+'<table border="0" cellpadding="0" cellspacing="0"><tr>'+'<td><label>'+this.lang.get('link_color')+'</label>'+'<div class="pe-color" style="margin-right: 30px;"><input type="text" value="" id="redactor-link-color-text" placeholder="#FFFFFF" class="pe-input" style="border-top: 0 !important; border-right: 0 !important; border-left: 0 !important;" /></div></td>'+'<td><label>'+this.lang.get('link_color_underline')+'</label>'+'<div class="pe-color" style="margin-right: 30px;"><input type="text" value="" id="redactor-link-color-line" placeholder="#FFFFFF" class="pe-input" style="border-top: 0 !important; border-right: 0 !important; border-left: 0 !important;" /></div></td>'+'<td><label>'+this.lang.get('link_line_size')+' (px)</label>'+'<div class="pe-color"><input type="text" id="redactor-link-line-size" placeholder="2" class="pe-input" style="border-top: 0 !important; border-right: 0 !important; border-left: 0 !important; height: 50px !important;" /></div></td>'+'</tr></table>'+'<p style="margin-top: 30px;"><a href="/projects/settings/?projectid='+parseInt($('#allrecords').data('tilda-project-id')||window.tildaprojectid||0)+'#tab=ss_menu_fonts" target="_blank" style="font-size:11px; color:#777; font-family:Georgia;padding-left: 30px;display:inline-block;"><img style="float: left;margin-left: -30px;margin-right: 5px;" src="https://static.tildacdn.com/img/attention_icon.png">'+this.lang.get('link_hint_color')+'</a></p>'+'<p style="margin-top: 30px;"><a id="redactor-link-show-seo" href="" style="color: #000000; text-decoration: none;">...</a><label class="redactor-link-seo"><input type="checkbox" value="1" name="" id="redactor-link-nofollow"> '+this.lang.get('link_nofollow')+'</label></p>'+'</section>'};$.extend(this.opts,this.opts.modal)},addCallback:function(name,callback)
{this.modal.callbacks[name]=callback},createTabber:function($modal)
{this.modal.$tabber=$('<div>').attr('id','redactor-modal-tabber');$modal.prepend(this.modal.$tabber)},addTab:function(id,name,active)
{var $tab=$('<a href="#" rel="tab'+id+'">').text(name);if(active)
{$tab.addClass('active')}
var self=this;$tab.on('click',function(e)
{e.preventDefault();$('.redactor-tab').hide();$('.redactor-'+$(this).attr('rel')).show();self.modal.$tabber.find('a').removeClass('active');$(this).addClass('active')});this.modal.$tabber.append($tab)},addTemplate:function(name,template)
{this.opts.modal[name]=template},getTemplate:function(name)
{return this.opts.modal[name]},getModal:function()
{return this.$modalBody.find('section')},load:function(templateName,title,width)
{this.modal.templateName=templateName;this.modal.width=width;this.modal.build();this.modal.enableEvents();this.modal.setTitle(title);this.modal.setDraggable();this.modal.setContent();if(typeof this.modal.callbacks[templateName]!='undefined')
{this.modal.callbacks[templateName].call(this)}},show:function()
{document.activeElement.blur();$(document.body).removeClass('body-hidden');this.modal.bodyOveflow=$(document.body).css('overflow');$(document.body).css('overflow','hidden');if(this.utils.isMobile())
{this.modal.showOnMobile()}
else{this.modal.showOnDesktop()}
this.$modalOverlay.show();this.$modalBox.show();this.modal.setButtonsWidth();this.utils.saveScroll();if(!this.utils.isMobile())
{setTimeout($.proxy(this.modal.showOnDesktop,this),0);$(window).on('resize.redactor-modal',$.proxy(this.modal.resize,this))}
this.core.setCallback('modalOpened',this.modal.templateName,this.$modal);$(document).off('focusin.modal');this.$modal.find('input[type=text]').on('keydown.redactor-modal',$.proxy(this.modal.setEnter,this))},showOnDesktop:function()
{var height=this.$modal.outerHeight();var windowHeight=$(window).height();var windowWidth=$(window).width();if(this.modal.width>windowWidth)
{this.$modal.css({width:'96%',marginTop:(windowHeight/2-height/2)+'px'});return}
if(height>windowHeight)
{this.$modal.css({width:this.modal.width+'px',marginTop:'20px'})}
else{this.$modal.css({width:this.modal.width+'px',marginTop:(windowHeight/2-height/2)+'px'})}},showOnMobile:function()
{this.$modal.css({width:'96%',marginTop:'2%'})},resize:function()
{if(this.utils.isMobile())
{this.modal.showOnMobile()}
else{this.modal.showOnDesktop()}},setTitle:function(title)
{this.$modalHeader.html(title)},setContent:function()
{this.$modalBody.html(this.modal.getTemplate(this.modal.templateName))},setDraggable:function()
{if(typeof $.fn.draggable==='undefined'){return}
this.$modal.draggable({handle:this.$modalHeader});this.$modalHeader.css('cursor','move')},setEnter:function(e)
{if(e.which!=13){return}
e.preventDefault();this.$modal.find('button.redactor-modal-action-btn').click()},createCancelButton:function()
{var button=$('<button>').addClass('redactor-modal-btn redactor-modal-close-btn').html(this.lang.get('cancel'));button.on('click',$.proxy(this.modal.close,this));this.$modalFooter.append(button)},createDeleteButton:function(label)
{return this.modal.createButton(label,'delete')},createActionButton:function(label)
{return this.modal.createButton(label,'action')},createButton:function(label,className)
{var button=$('<button>').addClass('redactor-modal-btn').addClass('redactor-modal-'+className+'-btn').html(label);this.$modalFooter.append(button);return button},setButtonsWidth:function()
{var buttons=this.$modalFooter.find('button');var buttonsSize=buttons.size();if(buttonsSize===0){return}
buttons.css('width',(100/buttonsSize)+'%')},build:function()
{this.modal.buildOverlay();this.$modalBox=$('<div id="redactor-modal-box" />').hide();this.$modal=$('<div id="redactor-modal" />');this.$modalHeader=$('<header />');this.$modalClose=$('<span id="redactor-modal-close" />').html('&times;');this.$modalBody=$('<div id="redactor-modal-body" />');this.$modalFooter=$('<footer />');this.$modal.append(this.$modalHeader);this.$modal.append(this.$modalClose);this.$modal.append(this.$modalBody);this.$modal.append(this.$modalFooter);this.$modalBox.append(this.$modal);this.$modalBox.appendTo(document.body)},buildOverlay:function()
{this.$modalOverlay=$('<div id="redactor-modal-overlay">').hide();$('body').prepend(this.$modalOverlay)},enableEvents:function()
{this.$modalClose.on('click.redactor-modal',$.proxy(this.modal.close,this));$(document).on('keyup.redactor-modal',$.proxy(this.modal.closeHandler,this));this.$editor.on('keyup.redactor-modal',$.proxy(this.modal.closeHandler,this));this.$modalBox.on('click.redactor-modal',$.proxy(this.modal.close,this))},disableEvents:function()
{this.$modalClose.off('click.redactor-modal');$(document).off('keyup.redactor-modal');this.$editor.off('keyup.redactor-modal');this.$modalBox.off('click.redactor-modal');$(window).off('resize.redactor-modal')},closeHandler:function(e)
{if(e.which!=this.keyCode.ESC){return}
this.modal.close(!1)},close:function(e)
{if(e)
{if(!$(e.target).hasClass('redactor-modal-close-btn')&&e.target!=this.$modalClose[0]&&e.target!=this.$modalBox[0])
{return}
e.preventDefault()}
if(!this.$modalBox){return}
this.modal.disableEvents();this.$modalOverlay.remove();this.$modalBox.fadeOut('fast',$.proxy(function()
{this.$modalBox.remove();setTimeout($.proxy(this.utils.restoreScroll,this),0);if(e!==undefined){this.selection.restore()}
$(document.body).css('overflow',this.modal.bodyOveflow);this.core.setCallback('modalClosed',this.modal.templateName)},this))}}},observe:function()
{return{load:function()
{this.observe.images();this.observe.links()},buttons:function(e,btnName)
{var current=this.selection.getCurrent();var parent=this.selection.getParent();this.button.setInactiveAll(btnName);if(e===!1&&btnName!=='html')
{if($.inArray(btnName,this.opts.activeButtons)!=-1){this.button.toggleActive(btnName)}
return}
$.each(this.opts.activeButtonsStates,$.proxy(function(key,value)
{var parentEl=$(parent).closest(key);var currentEl=$(current).closest(key);if(parentEl.length!==0&&!this.utils.isRedactorParent(parentEl)){return}
if(!this.utils.isRedactorParent(currentEl)){return}
if(parentEl.length!==0||currentEl.closest(key).length!==0)
{this.button.setActive(value)}},this));var $parent=$(parent).closest(this.opts.alignmentTags.toString().toLowerCase());if(this.utils.isRedactorParent(parent)&&$parent.length)
{var align=($parent.css('text-align')==='')?'left':$parent.css('text-align');this.button.setActive('align'+align)}},addButton:function(tag,btnName)
{this.opts.activeButtons.push(btnName);this.opts.activeButtonsStates[tag]=btnName},images:function()
{this.$editor.find('img').each($.proxy(function(i,img)
{var $img=$(img);$img.closest('a').on('click',function(e){e.preventDefault()});if(this.utils.browser('msie')){$img.attr('unselectable','on')}
this.image.setEditable($img)},this));$(document).on('click.redactor-image-delete',$.proxy(function(e)
{this.observe.image=!1;if(e.target.tagName=='IMG'&&this.utils.isRedactorParent(e.target))
{this.observe.image=(this.observe.image&&this.observe.image==e.target)?!1:e.target}},this))},links:function()
{if(!this.opts.linkTooltip){return}
this.$editor.find('a').on('touchstart click',$.proxy(this.observe.showTooltip,this));this.$editor.on('touchstart click.redactor',$.proxy(this.observe.closeTooltip,this));$(document).on('touchstart click.redactor',$.proxy(this.observe.closeTooltip,this))},getTooltipPosition:function($link)
{return $link.offset()},showTooltip:function(e)
{var $link=$(e.target);var $parent=$link.closest('a');if($parent.size()!==0&&$parent[0].tagName==='A'&&$link[0].tagName!=='A')
{$link=$parent}
else{if($link.size()===0||$link[0].tagName!=='A')
{return}}
var pos=this.observe.getTooltipPosition($link);var tooltip=$('<span class="redactor-link-tooltip"></span>');var href=$link.attr('href');if(href===undefined)
{href=''}
if(href.length>24){href=href.substring(0,24)+'...'}
var aLink=$('<a href="'+$link.attr('href')+'" target="_blank" />').html(href).addClass('redactor-link-tooltip-action');var aEdit=$('<a href="#" />').html(this.lang.get('edit')).on('click',$.proxy(function(e){if(this.sel){this.sel.removeAllRanges()}
if($link){this.selection.get();this.selection.selectElement($link.get(0));this.link.node=$link}
this.link.show('link');this.observe.buttons(e,'link')},this)).addClass('redactor-link-tooltip-action');var aUnlink=$('<a href="#" />').html(this.lang.get('unlink')).on('click',$.proxy(this.link.unlink,this)).addClass('redactor-link-tooltip-action');tooltip.append(aLink).append(' | ').append(aEdit).append(' | ').append(aUnlink);tooltip.css({top:(pos.top+20)+'px',left:pos.left+'px'});$('.redactor-link-tooltip').remove();$('body').append(tooltip)},closeTooltip:function(e)
{e=e.originalEvent||e;var target=e.target;var $parent=$(target).closest('a');if($parent.size()!==0&&$parent[0].tagName==='A'&&target.tagName!=='A')
{return}
else{if((target.tagName==='A'&&this.utils.isRedactorParent(target))||$(target).hasClass('redactor-link-tooltip-action'))
{return}}
$('.redactor-link-tooltip').remove()}}},paragraphize:function()
{return{load:function(html)
{if(this.opts.linebreaks){return html}
if(html===''||html==='<p></p>'){return this.opts.emptyHtml}
this.paragraphize.blocks=['table','div','pre','form','ul','ol','h1','h2','h3','h4','h5','h6','dl','blockquote','figcaption','address','section','header','footer','aside','article','object','style','script','iframe','select','input','textarea','button','option','map','area','math','hr','fieldset','legend','hgroup','nav','figure','details','menu','summary','p'];html=html+"\n";this.paragraphize.safes=[];this.paragraphize.z=0;html=html.replace(/(<br\s?\/?>){1,}\n?<\/blockquote>/gi,'</blockquote>');html=this.paragraphize.getSafes(html);html=this.paragraphize.getSafesComments(html);html=this.paragraphize.replaceBreaksToNewLines(html);html=this.paragraphize.replaceBreaksToParagraphs(html);html=this.paragraphize.clear(html);html=this.paragraphize.restoreSafes(html);html=html.replace(new RegExp('<br\\s?/?>\n?<('+this.paragraphize.blocks.join('|')+')(.*?[^>])>','gi'),'<p><br /></p>\n<$1$2>');return $.trim(html)},getSafes:function(html)
{var $div=$('<div />').append(html);$div.find('blockquote p').replaceWith(function()
{return $(this).append('<br />').contents()});html=$div.html();$div.find(this.paragraphize.blocks.join(', ')).each($.proxy(function(i,s)
{this.paragraphize.z++;this.paragraphize.safes[this.paragraphize.z]=s.outerHTML;html=html.replace(s.outerHTML,'\n{replace'+this.paragraphize.z+'}')},this));return html},getSafesComments:function(html)
{var commentsMatches=html.match(/<!--([\w\W]*?)-->/gi);if(!commentsMatches){return html}
$.each(commentsMatches,$.proxy(function(i,s)
{this.paragraphize.z++;this.paragraphize.safes[this.paragraphize.z]=s;html=html.replace(s,'\n{replace'+this.paragraphize.z+'}')},this));return html},restoreSafes:function(html)
{$.each(this.paragraphize.safes,function(i,s)
{html=html.replace('{replace'+i+'}',s)});return html},replaceBreaksToParagraphs:function(html)
{var htmls=html.split(new RegExp('\n','g'),-1);html='';if(htmls)
{var len=htmls.length;for(var i=0;i<len;i++)
{if(!htmls.hasOwnProperty(i)){return}
if(htmls[i].search('{replace')==-1)
{htmls[i]=htmls[i].replace(/<p>\n\t?<\/p>/gi,'');htmls[i]=htmls[i].replace(/<p><\/p>/gi,'');if(htmls[i]!=='')
{html+='<p>'+htmls[i].replace(/^\n+|\n+$/g,"")+"</p>"}}
else{html+=htmls[i]}}}
return html},replaceBreaksToNewLines:function(html)
{html=html.replace(/<br \/>\s*<br \/>/gi,"\n\n");html=html.replace(/<br\s?\/?>\n?<br\s?\/?>/gi,"\n<br /><br />");html=html.replace(new RegExp("\r\n",'g'),"\n");html=html.replace(new RegExp("\r",'g'),"\n");return html},clear:function(html)
{html=html.replace(new RegExp('</blockquote></p>','gi'),'</blockquote>');html=html.replace(new RegExp('<p></blockquote>','gi'),'</blockquote>');html=html.replace(new RegExp('<p><blockquote>','gi'),'<blockquote>');html=html.replace(new RegExp('<blockquote></p>','gi'),'<blockquote>');html=html.replace(new RegExp('<p><p ','gi'),'<p ');html=html.replace(new RegExp('<p><p>','gi'),'<p>');html=html.replace(new RegExp('</p></p>','gi'),'</p>');html=html.replace(new RegExp('<p>\\s?</p>','gi'),'');html=html.replace(new RegExp("\n</p>",'gi'),'</p>');html=html.replace(new RegExp('<p>\t?\t?\n?<p>','gi'),'<p>');html=html.replace(new RegExp('</p>\t?\t?\n?</p>','gi'),'</p>');html=html.replace(new RegExp('<p>\t*</p>','gi'),'');return html}}},paste:function()
{return{init:function(e)
{if(!this.opts.cleanOnPaste)return;this.rtePaste=!0;this.buffer.set();this.selection.save();this.utils.saveScroll();this.paste.createPasteBox();$(window).on('scroll.redactor-freeze',$.proxy(function()
{$(window).scrollTop(this.saveBodyScroll)},this));setTimeout($.proxy(function()
{var html=this.$pasteBox.html();this.$pasteBox.remove();this.selection.restore();this.utils.restoreScroll();this.paste.insert(html);$(window).off('scroll.redactor-freeze')},this),1)},createPasteBox:function()
{this.$pasteBox=$('<div>').html(' ').attr('contenteditable','true').css({position:'fixed',width:0,top:0,left:'-9999px'});this.$box.parent().append(this.$pasteBox);this.$pasteBox.focus()},insert:function(html)
{html=this.core.setCallback('pasteBefore',html);html=(this.utils.isSelectAll())?this.clean.onPaste(html,!1):this.clean.onPaste(html);html=this.core.setCallback('paste',html);if(this.utils.isSelectAll())
{this.insert.set(html,!1)}
else{this.insert.html(html,!1)}
this.utils.disableSelectAll();this.rtePaste=!1;setTimeout($.proxy(this.clean.clearUnverified,this),10)}}},placeholder:function()
{return{enable:function()
{if(!this.placeholder.is()){return}
this.$editor.attr('placeholder',this.$element.attr('placeholder'));this.placeholder.toggle();this.$editor.on('keyup.redactor-placeholder',$.proxy(this.placeholder.toggle,this))},toggle:function()
{var func='removeClass';if(this.utils.isEmpty(this.$editor.html(),!1)){func='addClass'}
this.$editor[func]('redactor-placeholder')},remove:function()
{this.$editor.removeClass('redactor-placeholder')},is:function()
{if(this.opts.placeholder)
{return this.$element.attr('placeholder',this.opts.placeholder)}
else{return!(typeof this.$element.attr('placeholder')=='undefined'||this.$element.attr('placeholder')==='')}}}},progress:function()
{return{show:function()
{$(document.body).append($('<div id="redactor-progress"><span></span></div>'));$('#redactor-progress').fadeIn()},hide:function()
{$('#redactor-progress').fadeOut(1500,function()
{$(this).remove()})}}},selection:function()
{return{get:function()
{this.sel=window.getSelection?window.getSelection():document.selection&&"startContainer"!==document.selection.type?document.selection:null;if(document.getSelection&&this.sel.getRangeAt&&this.sel.rangeCount)
{this.range=this.sel.getRangeAt(0)}
else{this.range=document.createRange()}},addRange:function()
{try{this.sel.removeAllRanges()}catch(e){document.selection.empty()}
this.sel.addRange(this.range)},getCurrent:function()
{var el=!1;this.selection.get();if(this.sel&&this.sel.rangeCount>0)
{if(this.sel.previousSibling){return this.sel.previousSibling}
el=this.sel.getRangeAt(0).startContainer}
return this.utils.isRedactorParent(el)},getParent:function(elem)
{elem=elem||this.selection.getCurrent();if(elem)
{return elem.parentNode;return this.utils.isRedactorParent($(elem).parent()[0])}
return!1},getBlock:function(node)
{node=node||this.selection.getCurrent();while(node)
{if(this.utils.isBlockTag(node.tagName))
{return($(node).hasClass('redactor-editor'))?!1:node}
node=node.parentNode}
return!1},getInlines:function(nodes)
{this.selection.get();if(this.range&&this.range.collapsed)
{return!1}
var inlines=[];nodes=(typeof nodes=='undefined')?this.selection.getNodes():nodes;var inlineTags=this.opts.inlineTags;inlineTags.push('span');$.each(nodes,$.proxy(function(i,node)
{if($.inArray(node.tagName.toLowerCase(),inlineTags)!=-1)
{inlines.push(node)}},this));return(inlines.length===0)?!1:inlines},getBlocks:function(nodes)
{this.selection.get();if(this.range&&this.range.collapsed)
{return[this.selection.getBlock()]}
var blocks=[];nodes=(typeof nodes=='undefined')?this.selection.getNodes():nodes;$.each(nodes,$.proxy(function(i,node)
{if(this.utils.isBlock(node))
{this.selection.lastBlock=node;blocks.push(node)}},this));return(blocks.length===0)?[this.selection.getBlock()]:blocks},getLastBlock:function()
{return this.selection.lastBlock},getNodes:function()
{this.selection.get();var startNode=this.selection.getNodesMarker(1);var endNode=this.selection.getNodesMarker(2);this.selection.setNodesMarker(this.range,startNode,!0);if(this.range.collapsed===!1)
{this.selection.setNodesMarker(this.range,endNode,!1)}
else{endNode=startNode}
var nodes=[];var counter=0;var self=this;this.$editor.find('*').each(function()
{if(this==startNode)
{var parent=$(this).parent();if(parent.length!==0&&parent[0].tagName!='BODY'&&self.utils.isRedactorParent(parent[0]))
{nodes.push(parent[0])}
nodes.push(this);counter=1}
else{if(counter>0)
{nodes.push(this);counter=counter+1}}
if(this==endNode)
{return!1}});var finalNodes=[];var len=nodes.length;for(var i=0;i<len;i++)
{if(nodes[i].id!='nodes-marker-1'&&nodes[i].id!='nodes-marker-2')
{finalNodes.push(nodes[i])}}
this.selection.removeNodesMarkers();return finalNodes},getNodesMarker:function(num)
{return $('<span id="nodes-marker-'+num+'" class="redactor-nodes-marker" data-verified="redactor">'+this.opts.invisibleSpace+'</span>')[0]},setNodesMarker:function(range,node,type)
{var rangeclone=range.cloneRange();try{rangeclone.collapse(type);rangeclone.insertNode(node)}
catch(e){}},removeNodesMarkers:function()
{$(document).find('span.redactor-nodes-marker').remove();this.$editor.find('span.redactor-nodes-marker').remove()},fromPoint:function(start,end)
{this.caret.setOffset(start,end)},wrap:function(tag)
{this.selection.get();if(this.range.collapsed){return!1}
var wrapper=document.createElement(tag);wrapper.appendChild(this.range.extractContents());this.range.insertNode(wrapper);return wrapper},selectElement:function(node)
{this.caret.set(node,0,node,1)},selectAll:function()
{this.selection.get();this.range.selectNodeContents(this.$editor[0]);this.selection.addRange()},remove:function()
{this.selection.get();this.sel.removeAllRanges()},save:function()
{this.selection.createMarkers();this.savedSel=this.$editor.html()},createMarkers:function()
{this.selection.get();this.selection.setMarker(this.range,this.selection.getMarker(1),!0);if(this.range.collapsed===!1)
{this.selection.setMarker(this.range,this.selection.getMarker(2),!1)}},getMarker:function(num)
{if(typeof num=='undefined'){num=1}
return $('<span id="selection-marker-'+num+'" class="redactor-selection-marker"  data-verified="redactor">'+this.opts.invisibleSpace+'</span>')[0]},getMarkerAsHtml:function(num)
{return this.utils.getOuterHtml(this.selection.getMarker(num))},setMarker:function(range,node,type)
{range=range.cloneRange();try{range.collapse(type);range.insertNode(node)}
catch(e)
{this.focus.setStart()}},restore:function()
{var node1=this.$editor.find('span#selection-marker-1');var node2=this.$editor.find('span#selection-marker-2');if(node1.length!==0&&node2.length!==0)
{this.caret.set(node1,0,node2,0)}
else{if(node1.length!==0)
{this.caret.set(node1,0,node1,0)}
else{this.$editor.focus()}}
this.selection.removeMarkers();this.savedSel=!1},removeMarkers:function()
{this.$editor.find('span.redactor-selection-marker').remove()},getText:function()
{this.selection.get();return this.sel.toString()},getHtml:function()
{var html='';this.selection.get();if(this.sel.rangeCount)
{var container=document.createElement('div');var len=this.sel.rangeCount;for(var i=0;i<len;++i)
{container.appendChild(this.sel.getRangeAt(i).cloneContents())}
html=container.innerHTML}
return this.clean.onSync(html)}}},shortcuts:function()
{return{init:function(e,key)
{if(!this.opts.shortcuts)
{if((e.ctrlKey||e.metaKey)&&(key===66||key===73)){e.preventDefault()}
return!1}
$.each(this.opts.shortcuts,$.proxy(function(str,command)
{var keys=str.split(',');var len=keys.length;for(var i=0;i<len;i++)
{if(typeof keys[i]==='string')
{this.shortcuts.handler(e,$.trim(keys[i]),$.proxy(function()
{var func;if(command.func.search(/\./)!='-1')
{func=command.func.split('.');if(typeof this[func[0]]!='undefined')
{this[func[0]][func[1]].apply(this,command.params)}}
else{this[command.func].apply(this,command.params)}},this))}}},this))},handler:function(e,keys,origHandler)
{var hotkeysSpecialKeys={8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"};var hotkeysShiftNums={"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":": ","'":"\"",",":"<",".":">","/":"?","\\":"|"};keys=keys.toLowerCase().split(" ");var special=hotkeysSpecialKeys[e.keyCode],character=String.fromCharCode(e.which).toLowerCase(),modif="",possible={};$.each(["alt","ctrl","meta","shift"],function(index,specialKey)
{if(e[specialKey+'Key']&&special!==specialKey)
{modif+=specialKey+'+'}});if(special){possible[modif+special]=!0}
if(character)
{possible[modif+character]=!0;possible[modif+hotkeysShiftNums[character]]=!0;if(modif==="shift+")
{possible[hotkeysShiftNums[character]]=!0}}
for(var i=0,len=keys.length;i<len;i++)
{if(possible[keys[i]])
{e.preventDefault();return origHandler.apply(this,arguments)}}}}},tabifier:function()
{return{get:function(code)
{if(!this.opts.tabifier){return code}
var ownLine=['area','body','head','hr','i?frame','link','meta','noscript','style','script','table','tbody','thead','tfoot'];var contOwnLine=['li','dt','dt','h[1-6]','option','script'];var newLevel=['blockquote','div','dl','fieldset','form','frameset','map','ol','p','pre','select','td','th','tr','ul'];this.tabifier.lineBefore=new RegExp('^<(/?'+ownLine.join('|/?')+'|'+contOwnLine.join('|')+')[ >]');this.tabifier.lineAfter=new RegExp('^<(br|/?'+ownLine.join('|/?')+'|/'+contOwnLine.join('|/')+')[ >]');this.tabifier.newLevel=new RegExp('^</?('+newLevel.join('|')+')[ >]');var i=0,codeLength=code.length,point=0,start=null,end=null,tag='',out='',cont='';this.tabifier.cleanlevel=0;for(;i<codeLength;i++)
{point=i;if(-1==code.substr(i).indexOf('<'))
{out+=code.substr(i);return this.tabifier.finish(out)}
while(point<codeLength&&code.charAt(point)!='<')
{point++}
if(i!=point)
{cont=code.substr(i,point-i);if(!cont.match(/^\s{2,}$/g))
{if('\n'==out.charAt(out.length-1))
{out+=this.tabifier.getTabs()}
else{if('\n'==cont.charAt(0))
{out+='\n'+this.tabifier.getTabs();cont=cont.replace(/^\s+/,'')}}
out+=cont}
if(cont.match(/\n/)){out+='\n'+this.tabifier.getTabs()}}
start=point;while(point<codeLength&&'>'!=code.charAt(point))
{point++}
tag=code.substr(start,point-start);i=point;var t;if('!--'==tag.substr(1,3))
{if(!tag.match(/--$/))
{while('-->'!=code.substr(point,3))
{point++}
point+=2;tag=code.substr(start,point-start);i=point}
if('\n'!=out.charAt(out.length-1)){out+='\n'}
out+=this.tabifier.getTabs();out+=tag+'>\n'}
else{if('!'==tag[1])
{out=this.tabifier.placeTag(tag+'>',out)}
else{if('?'==tag[1])
{out+=tag+'>\n'}
else{if(t=tag.match(/^<(script|style|pre)/i))
{t[1]=t[1].toLowerCase();tag=this.tabifier.cleanTag(tag);out=this.tabifier.placeTag(tag,out);end=String(code.substr(i+1)).toLowerCase().indexOf('</'+t[1]);if(end)
{cont=code.substr(i+1,end);i+=end;out+=cont}}
else{tag=this.tabifier.cleanTag(tag);out=this.tabifier.placeTag(tag,out)}}}}}
return this.tabifier.finish(out)},getTabs:function()
{var s='';for(var j=0;j<this.tabifier.cleanlevel;j++)
{s+='\t'}
return s},finish:function(code)
{code=code.replace(/\n\s*\n/g,'\n');code=code.replace(/^[\s\n]*/,'');code=code.replace(/[\s\n]*$/,'');code=code.replace(/<script(.*?)>\n<\/script>/gi,'<script$1></script>');this.tabifier.cleanlevel=0;return code},cleanTag:function(tag)
{var tagout='';tag=tag.replace(/\n/g,' ');tag=tag.replace(/\s{2,}/g,' ');tag=tag.replace(/^\s+|\s+$/g,' ');var suffix='';if(tag.match(/\/$/))
{suffix='/';tag=tag.replace(/\/+$/,'')}
var m;while(m=/\s*([^= ]+)(?:=((['"']).*?\3|[^ ]+))?/.exec(tag))
{if(m[2]){tagout+=m[1].toLowerCase()+'='+m[2]}else{if(m[1]){tagout+=m[1].toLowerCase()}}
tagout+=' ';tag=tag.substr(m[0].length)}
return tagout.replace(/\s*$/,'')+suffix+'>'},placeTag:function(tag,out)
{var nl=tag.match(this.tabifier.newLevel);if(tag.match(this.tabifier.lineBefore)||nl)
{out=out.replace(/\s*$/,'');out+='\n'}
if(nl&&'/'==tag.charAt(1)){this.tabifier.cleanlevel--}
if('\n'==out.charAt(out.length-1)){out+=this.tabifier.getTabs()}
if(nl&&'/'!=tag.charAt(1)){this.tabifier.cleanlevel++}
out+=tag;if(tag.match(this.tabifier.lineAfter)||tag.match(this.tabifier.newLevel))
{out=out.replace(/ *$/,'');out+='\n'}
return out}}},tidy:function()
{return{setupAllowed:function()
{if(this.opts.allowedTags){this.opts.deniedTags=!1}
if(this.opts.allowedAttr){this.opts.removeAttr=!1}
if(this.opts.linebreaks){return}
var tags=['p','section'];if(this.opts.allowedTags){this.tidy.addToAllowed(tags)}
if(this.opts.deniedTags){this.tidy.removeFromDenied(tags)}},addToAllowed:function(tags)
{var len=tags.length;for(var i=0;i<len;i++)
{if($.inArray(tags[i],this.opts.allowedTags)==-1)
{this.opts.allowedTags.push(tags[i])}}},removeFromDenied:function(tags)
{var len=tags.length;for(var i=0;i<len;i++)
{var pos=$.inArray(tags[i],this.opts.deniedTags);if(pos!=-1)
{this.opts.deniedTags.splice(pos,1)}}},load:function(html,options)
{this.tidy.settings={deniedTags:this.opts.deniedTags,allowedTags:this.opts.allowedTags,removeComments:this.opts.removeComments,replaceTags:this.opts.replaceTags,replaceStyles:this.opts.replaceStyles,removeDataAttr:this.opts.removeDataAttr,removeAttr:this.opts.removeAttr,allowedAttr:this.opts.allowedAttr,removeWithoutAttr:this.opts.removeWithoutAttr,removeEmpty:this.opts.removeEmpty};$.extend(this.tidy.settings,options);html=this.tidy.removeComments(html);this.tidy.$div=$('<div />').append(html);this.tidy.replaceTags();this.tidy.replaceStyles();this.tidy.removeTags();this.tidy.removeAttr();this.tidy.removeEmpty();this.tidy.removeParagraphsInLists();this.tidy.removeDataAttr();this.tidy.removeWithoutAttr();html=this.tidy.$div.html();this.tidy.$div.remove();return html},removeComments:function(html)
{if(!this.tidy.settings.removeComments){return html}
return html.replace(/<!--[\s\S]*?-->/gi,'')},replaceTags:function(html)
{if(!this.tidy.settings.replaceTags){return html}
var len=this.tidy.settings.replaceTags.length;var replacement=[],rTags=[];for(var i=0;i<len;i++)
{rTags.push(this.tidy.settings.replaceTags[i][1]);replacement.push(this.tidy.settings.replaceTags[i][0])}
this.tidy.$div.find(replacement.join(',')).each($.proxy(function(n,s)
{var tag=rTags[n];$(s).replaceWith(function()
{var replaced=$('<'+tag+' />').append($(this).contents());for(var i=0;i<this.attributes.length;i++)
{replaced.attr(this.attributes[i].name,this.attributes[i].value)}
return replaced})},this));return html},replaceStyles:function()
{if(!this.tidy.settings.replaceStyles){return}
var len=this.tidy.settings.replaceStyles.length;this.tidy.$div.find('span').each($.proxy(function(n,s)
{var $el=$(s);var style=$el.attr('style');for(var i=0;i<len;i++)
{if(style&&style.match(new RegExp('^'+this.tidy.settings.replaceStyles[i][0],'i')))
{var tagName=this.tidy.settings.replaceStyles[i][1];$el.replaceWith(function()
{var tag=document.createElement(tagName);return $(tag).append($(this).contents())})}}},this))},removeTags:function()
{if(!this.tidy.settings.deniedTags&&this.tidy.settings.allowedTags)
{this.tidy.$div.find('*').not(this.tidy.settings.allowedTags.join(',')).each(function(i,s)
{if(s.innerHTML===''){$(s).remove()}
else{$(s).contents().unwrap()}})}
if(this.tidy.settings.deniedTags)
{this.tidy.$div.find(this.tidy.settings.deniedTags.join(',')).each(function(i,s)
{if(s.innerHTML===''){$(s).remove()}
else{$(s).contents().unwrap()}})}},removeAttr:function()
{var len;if(!this.tidy.settings.removeAttr&&this.tidy.settings.allowedAttr)
{var allowedAttrTags=[],allowedAttrData=[];len=this.tidy.settings.allowedAttr.length;for(var i=0;i<len;i++)
{allowedAttrTags.push(this.tidy.settings.allowedAttr[i][0]);allowedAttrData.push(this.tidy.settings.allowedAttr[i][1])}
this.tidy.$div.find('*').each($.proxy(function(n,s)
{var $el=$(s);var pos=$.inArray($el[0].tagName.toLowerCase(),allowedAttrTags);var attributesRemove=this.tidy.removeAttrGetRemoves(pos,allowedAttrData,$el);if(attributesRemove)
{$.each(attributesRemove,function(z,f){$el.removeAttr(f)})}},this))}
if(this.tidy.settings.removeAttr)
{len=this.tidy.settings.removeAttr.length;for(var i=0;i<len;i++)
{var attrs=this.tidy.settings.removeAttr[i][1];if($.isArray(attrs)){attrs=attrs.join(' ')}
this.tidy.$div.find(this.tidy.settings.removeAttr[i][0]).removeAttr(attrs)}}},removeAttrGetRemoves:function(pos,allowed,$el)
{var attributesRemove=[];if(pos==-1)
{$.each($el[0].attributes,function(i,item)
{attributesRemove.push(item.name)})}
else{if(allowed[pos]=='*')
{attributesRemove=[]}
else{$.each($el[0].attributes,function(i,item)
{if($.isArray(allowed[pos]))
{if($.inArray(item.name,allowed[pos])==-1)
{attributesRemove.push(item.name)}}
else{if(allowed[pos]!=item.name)
{attributesRemove.push(item.name)}}})}}
return attributesRemove},removeAttrs:function(el,regex)
{regex=new RegExp(regex,"g");return el.each(function()
{var self=$(this);var len=this.attributes.length-1;for(var i=len;i>=0;i--)
{var item=this.attributes[i];if(item&&item.specified&&item.name.search(regex)>=0)
{self.removeAttr(item.name)}}})},removeEmpty:function()
{if(!this.tidy.settings.removeEmpty){return}
this.tidy.$div.find(this.tidy.settings.removeEmpty.join(',')).each(function()
{var $el=$(this);var text=$el.text();text=text.replace(/[\u200B-\u200D\uFEFF]/g,'');text=text.replace(/&nbsp;/gi,'');text=text.replace(/\s/g,'');if(text===''&&$el.children().length===0)
{$el.remove()}})},removeParagraphsInLists:function()
{this.tidy.$div.find('li p').contents().unwrap()},removeDataAttr:function()
{if(!this.tidy.settings.removeDataAttr){return}
var tags=this.tidy.settings.removeDataAttr;if($.isArray(this.tidy.settings.removeDataAttr)){tags=this.tidy.settings.removeDataAttr.join(',')}
this.tidy.removeAttrs(this.tidy.$div.find(tags),'^(data-)')},removeWithoutAttr:function()
{if(!this.tidy.settings.removeWithoutAttr){return}
this.tidy.$div.find(this.tidy.settings.removeWithoutAttr.join(',')).each(function()
{if(this.attributes.length===0)
{$(this).contents().unwrap()}})}}},toolbar:function()
{return{init:function()
{return{html:{title:this.lang.get('html'),func:'code.toggle'},formatting:{title:this.lang.get('formatting'),dropdown:{p:{title:this.lang.get('paragraph'),func:'block.format'},blockquote:{title:this.lang.get('quote'),func:'block.format'},pre:{title:this.lang.get('code'),func:'block.format'},h1:{title:this.lang.get('header1'),func:'block.format'},h2:{title:this.lang.get('header2'),func:'block.format'},h3:{title:this.lang.get('header3'),func:'block.format'},h4:{title:this.lang.get('header4'),func:'block.format'},h5:{title:this.lang.get('header5'),func:'block.format'}}},bold:{title:this.lang.get('bold'),func:'inline.format'},italic:{title:this.lang.get('italic'),func:'inline.format'},deleted:{title:this.lang.get('deleted'),func:'inline.format'},underline:{title:this.lang.get('underline'),func:'inline.format'},unorderedlist:{title:'&bull; '+this.lang.get('unorderedlist'),func:'list.toggle'},orderedlist:{title:'1. '+this.lang.get('orderedlist'),func:'list.toggle'},outdent:{title:'< '+this.lang.get('outdent'),func:'indent.decrease'},indent:{title:'> '+this.lang.get('indent'),func:'indent.increase'},image:{title:this.lang.get('image'),func:'image.show'},file:{title:this.lang.get('file'),func:'file.show'},link:{title:this.lang.get('link'),dropdown:{link:{title:this.lang.get('link_insert'),func:'link.show'},unlink:{title:this.lang.get('unlink'),func:'link.unlink'}}},alignment:{title:this.lang.get('alignment'),dropdown:{left:{title:this.lang.get('align_left'),func:'alignment.left'},center:{title:this.lang.get('align_center'),func:'alignment.center'},right:{title:this.lang.get('align_right'),func:'alignment.right'},justify:{title:this.lang.get('align_justify'),func:'alignment.justify'}}},horizontalrule:{title:this.lang.get('horizontalrule'),func:'line.insert'}}},build:function()
{this.toolbar.hideButtons();this.toolbar.hideButtonsOnMobile();this.toolbar.isButtonSourceNeeded();if(this.opts.buttons.length===0){return}
this.$toolbar=this.toolbar.createContainer();this.toolbar.setOverflow();this.toolbar.append();this.toolbar.setFormattingTags();this.toolbar.loadButtons();this.toolbar.setFixed();if(this.opts.activeButtons)
{this.$editor.on('mouseup.redactor keyup.redactor focus.redactor',$.proxy(this.observe.buttons,this))}},createContainer:function()
{return $('<ul>').addClass('redactor-toolbar').attr('id','redactor-toolbar-'+this.uuid)},setFormattingTags:function()
{$.each(this.opts.toolbar.formatting.dropdown,$.proxy(function(i,s)
{if($.inArray(i,this.opts.formatting)==-1){delete this.opts.toolbar.formatting.dropdown[i]}},this))},loadButtons:function()
{$.each(this.opts.buttons,$.proxy(function(i,btnName)
{if(!this.opts.toolbar[btnName]){return}
if(this.opts.fileUpload===!1&&btnName==='file'){return!0}
if((this.opts.imageUpload===!1&&this.opts.s3===!1)&&btnName==='image'){return!0}
var btnObject=this.opts.toolbar[btnName];this.$toolbar.append($('<li>').append(this.button.build(btnName,btnObject)))},this))},append:function()
{if(this.opts.toolbarExternal)
{this.$toolbar.addClass('redactor-toolbar-external');$(this.opts.toolbarExternal).html(this.$toolbar)}
else{this.$box.prepend(this.$toolbar)}},setFixed:function()
{if(this.utils.isMobile()){return}
if(this.opts.toolbarExternal){return}
if(!this.opts.toolbarFixed){return}
this.toolbar.observeScroll();$(this.opts.toolbarFixedTarget).on('scroll.redactor',$.proxy(this.toolbar.observeScroll,this))},setOverflow:function()
{if(this.utils.isMobile()&&this.opts.toolbarOverflow)
{this.$toolbar.addClass('redactor-toolbar-overflow')}},isButtonSourceNeeded:function()
{if(this.opts.buttonSource){return}
var index=this.opts.buttons.indexOf('html');if(index!==-1)
{this.opts.buttons.splice(index,1)}},hideButtons:function()
{if(this.opts.buttonsHide.length===0){return}
$.each(this.opts.buttonsHide,$.proxy(function(i,s)
{var index=this.opts.buttons.indexOf(s);this.opts.buttons.splice(index,1)},this))},hideButtonsOnMobile:function()
{if(!this.utils.isMobile()||this.opts.buttonsHideOnMobile.length===0){return}
$.each(this.opts.buttonsHideOnMobile,$.proxy(function(i,s)
{var index=this.opts.buttons.indexOf(s);this.opts.buttons.splice(index,1)},this))},observeScroll:function()
{var scrollTop=$(this.opts.toolbarFixedTarget).scrollTop();var boxTop=1;if(this.opts.toolbarFixedTarget===document)
{boxTop=this.$box.offset().top}
if(scrollTop>boxTop)
{this.toolbar.observeScrollEnable(scrollTop,boxTop)}
else{this.toolbar.observeScrollDisable()}},observeScrollEnable:function(scrollTop,boxTop)
{var top=this.opts.toolbarFixedTopOffset+scrollTop-boxTop;var left=0;var end=boxTop+this.$box.height()+30;var width=this.$box.innerWidth();this.$toolbar.addClass('toolbar-fixed-box');this.$toolbar.css({position:'absolute',width:width,top:top+'px',left:left});this.toolbar.setDropdownsFixed();this.$toolbar.css('visibility',(scrollTop<end)?'visible':'hidden')},observeScrollDisable:function()
{this.$toolbar.css({position:'relative',width:'auto',top:0,left:0,visibility:'visible'});this.toolbar.unsetDropdownsFixed();this.$toolbar.removeClass('toolbar-fixed-box')},setDropdownsFixed:function()
{var top=this.$toolbar.innerHeight()+this.opts.toolbarFixedTopOffset;var position='fixed';if(this.opts.toolbarFixedTarget!==document)
{top=(this.$toolbar.innerHeight()+this.$toolbar.offset().top)+this.opts.toolbarFixedTopOffset;position='absolute'}
$('.redactor-dropdown').each(function()
{$(this).css({position:position,top:top+'px'})})},unsetDropdownsFixed:function()
{var top=(this.$toolbar.innerHeight()+this.$toolbar.offset().top);$('.redactor-dropdown').each(function()
{$(this).css({position:'absolute',top:top+'px'})})}}},upload:function()
{return{init:function(id,url,callback)
{this.upload.direct=!1;this.upload.callback=callback;this.upload.url=url;this.upload.$el=$(id);this.upload.$droparea=$('<div id="redactor-droparea" />');this.upload.$placeholdler=$('<div id="redactor-droparea-placeholder" />').text('Drop file here or ');this.upload.$input=$('<input type="file" name="file" />');this.upload.$placeholdler.append(this.upload.$input);this.upload.$droparea.append(this.upload.$placeholdler);this.upload.$el.append(this.upload.$droparea);this.upload.$droparea.off('redactor.upload');this.upload.$input.off('redactor.upload');this.upload.$droparea.on('dragover.redactor.upload',$.proxy(this.upload.onDrag,this));this.upload.$droparea.on('dragleave.redactor.upload',$.proxy(this.upload.onDragLeave,this));this.upload.$input.on('change.redactor.upload',$.proxy(function(e)
{e=e.originalEvent||e;this.upload.traverseFile(this.upload.$input[0].files[0],e)},this));this.upload.$droparea.on('drop.redactor.upload',$.proxy(function(e)
{e.preventDefault();this.upload.$droparea.removeClass('drag-hover').addClass('drag-drop');this.upload.onDrop(e)},this))},directUpload:function(file,e)
{this.upload.direct=!0;this.upload.traverseFile(file,e)},onDrop:function(e)
{e=e.originalEvent||e;var files=e.dataTransfer.files;this.upload.traverseFile(files[0],e)},traverseFile:function(file,e)
{if(this.opts.s3)
{this.upload.setConfig(file);this.upload.s3uploadFile(file);return}
var formData=!!window.FormData?new FormData():null;if(window.FormData)
{this.upload.setConfig(file);var name=(this.upload.type=='image')?this.opts.imageUploadParam:this.opts.fileUploadParam;formData.append(name,file)}
this.progress.show();this.upload.sendData(formData,e)},setConfig:function(file)
{this.upload.getType(file);if(this.upload.direct)
{this.upload.url=(this.upload.type=='image')?this.opts.imageUpload:this.opts.fileUpload;this.upload.callback=(this.upload.type=='image')?this.image.insert:this.file.insert}},getType:function(file)
{this.upload.type='image';if(this.opts.imageTypes.indexOf(file.type)==-1)
{this.upload.type='file'}},getHiddenFields:function(obj,fd)
{if(obj===!1||typeof obj!=='object'){return fd}
$.each(obj,$.proxy(function(k,v)
{if(v!==null&&v.toString().indexOf('#')===0){v=$(v).val()}
fd.append(k,v)},this));return fd},sendData:function(formData,e)
{if(this.upload.type=='image')
{formData=this.upload.getHiddenFields(this.opts.uploadImageFields,formData);formData=this.upload.getHiddenFields(this.upload.imageFields,formData)}
else{formData=this.upload.getHiddenFields(this.opts.uploadFileFields,formData);formData=this.upload.getHiddenFields(this.upload.fileFields,formData)}
var xhr=new XMLHttpRequest();xhr.open('POST',this.upload.url);xhr.onreadystatechange=$.proxy(function()
{if(xhr.readyState==4)
{var data=xhr.responseText;data=data.replace(/^\[/,'');data=data.replace(/\]$/,'');var json;try
{json=(typeof data==='string'?$.parseJSON(data):data)}
catch(err)
{json={error:!0}}
this.progress.hide();if(!this.upload.direct)
{this.upload.$droparea.removeClass('drag-drop')}
this.upload.callback(json,this.upload.direct,e)}},this);xhr.send(formData)},onDrag:function(e)
{e.preventDefault();this.upload.$droparea.addClass('drag-hover')},onDragLeave:function(e)
{e.preventDefault();this.upload.$droparea.removeClass('drag-hover')},clearImageFields:function()
{this.upload.imageFields={}},addImageFields:function(name,value)
{this.upload.imageFields[name]=value},removeImageFields:function(name)
{delete this.upload.imageFields[name]},clearFileFields:function()
{this.upload.fileFields={}},addFileFields:function(name,value)
{this.upload.fileFields[name]=value},removeFileFields:function(name)
{delete this.upload.fileFields[name]},s3uploadFile:function(file)
{this.upload.s3executeOnSignedUrl(file,$.proxy(function(signedURL)
{this.upload.s3uploadToS3(file,signedURL)},this))},s3executeOnSignedUrl:function(file,callback)
{var xhr=new XMLHttpRequest();var mark='?';if(this.opts.s3.search(/\?/)!='-1'){mark='&'}
xhr.open('GET',this.opts.s3+mark+'name='+file.name+'&type='+file.type,!0);if(xhr.overrideMimeType){xhr.overrideMimeType('text/plain; charset=x-user-defined')}
var that=this;xhr.onreadystatechange=function(e)
{if(this.readyState==4&&this.status==200)
{that.progress.show();callback(decodeURIComponent(this.responseText))}
else{if(this.readyState==4&&this.status!=200)
{}}};xhr.send()},s3createCORSRequest:function(method,url)
{var xhr=new XMLHttpRequest();if("withCredentials" in xhr)
{xhr.open(method,url,!0)}
else{if(typeof XDomainRequest!="undefined")
{xhr=new XDomainRequest();xhr.open(method,url)}
else{xhr=null}}
return xhr},s3uploadToS3:function(file,url)
{var xhr=this.upload.s3createCORSRequest('PUT',url);if(!xhr)
{}
else{xhr.onload=$.proxy(function()
{if(xhr.status==200)
{this.progress.hide();var s3file=url.split('?');if(!s3file[0])
{return!1}
if(!this.upload.direct)
{this.upload.$droparea.removeClass('drag-drop')}
var json={filelink:s3file[0]};if(this.upload.type=='file')
{var arr=s3file[0].split('/');json.filename=arr[arr.length-1]}
this.upload.callback(json,this.upload.direct,!1)}
else{}},this);xhr.onerror=function()
{};xhr.upload.onprogress=function(e)
{};xhr.setRequestHeader('Content-Type',file.type);xhr.setRequestHeader('x-amz-acl','public-read');xhr.send(file)}}}},utils:function()
{return{isMobile:function()
{return/(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent)},isDesktop:function()
{return!/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)},isString:function(obj)
{return Object.prototype.toString.call(obj)=='[object String]'},isEmpty:function(html,removeEmptyTags)
{html=html.replace(/[\u200B-\u200D\uFEFF]/g,'');html=html.replace(/&nbsp;/gi,'');html=html.replace(/<\/?br\s?\/?>/g,'');html=html.replace(/\s/g,'');html=html.replace(/^<p>[^\W\w\D\d]*?<\/p>$/i,'');if(removeEmptyTags!==!1)
{html=html.replace(/<[^\/>][^>]*><\/[^>]+>/gi,'');html=html.replace(/<[^\/>][^>]*><\/[^>]+>/gi,'')}
html=$.trim(html);return html===''},normalize:function(str)
{if(typeof(str)==='undefined'){return 0}
return parseInt(str.replace('px',''),10)},hexToRgb:function(hex)
{if(typeof hex=='undefined'){return}
if(hex.search(/^#/)==-1){return hex}
var shorthandRegex=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;hex=hex.replace(shorthandRegex,function(m,r,g,b)
{return r+r+g+g+b+b});var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return 'rgb('+parseInt(result[1],16)+', '+parseInt(result[2],16)+', '+parseInt(result[3],16)+')'},getOuterHtml:function(el)
{return $('<div>').append($(el).eq(0).clone()).html()},getAlignmentElement:function(el)
{if($.inArray(el.tagName,this.opts.alignmentTags)!==-1)
{return $(el)}
else{return $(el).closest(this.opts.alignmentTags.toString().toLowerCase(),this.$editor[0])}},removeEmptyAttr:function(el,attr)
{var $el=$(el);if(typeof $el.attr(attr)=='undefined')
{return!0}
if($el.attr(attr)==='')
{$el.removeAttr(attr);return!0}
return!1},removeEmpty:function(i,s)
{var $s=$(s);$s.find('.redactor-invisible-space').removeAttr('style').removeAttr('class');if($s.find('hr, br, img, iframe').length!==0){return}
var text=$.trim($s.text());if(this.utils.isEmpty(text,!1))
{$s.remove()}},saveScroll:function()
{if(this.utils.isSelectAll()){return}
this.saveEditorScroll=this.$editor.scrollTop();this.saveBodyScroll=$(window).scrollTop();if(this.opts.scrollTarget){this.saveTargetScroll=$(this.opts.scrollTarget).scrollTop()}},restoreScroll:function()
{if(typeof this.saveScroll==='undefined'&&typeof this.saveBodyScroll==='undefined'){return}
$(window).scrollTop(this.saveBodyScroll);this.$editor.scrollTop(this.saveEditorScroll);if(this.opts.scrollTarget){$(this.opts.scrollTarget).scrollTop(this.saveTargetScroll)}},createSpaceElement:function()
{var space=document.createElement('span');space.className='redactor-invisible-space';space.innerHTML=this.opts.invisibleSpace;return space},removeInlineTags:function(node)
{var tags=this.opts.inlineTags;tags.push('span');if(node.tagName=='PRE'){tags.push('a')}
$(node).find(tags.join(',')).not('span.redactor-selection-marker').contents().unwrap()},replaceWithContents:function(node,removeInlineTags)
{var self=this;$(node).replaceWith(function()
{if(removeInlineTags===!0){self.utils.removeInlineTags(this)}
return $(this).contents()})},replaceToTag:function(node,tag,removeInlineTags)
{var replacement;var self=this;$(node).replaceWith(function()
{replacement=$('<'+tag+' />').append($(this).contents());for(var i=0;i<this.attributes.length;i++)
{replacement.attr(this.attributes[i].name,this.attributes[i].value)}
if(removeInlineTags===!0){self.utils.removeInlineTags(replacement)}
return replacement});return replacement},isStartOfElement:function()
{var block=this.selection.getBlock();if(!block){return!1}
var offset=this.caret.getOffsetOfElement(block);return(offset===0)?!0:!1},isEndOfElement:function()
{var block=this.selection.getBlock();if(!block){return!1}
var offset=this.caret.getOffsetOfElement(block);var text=$.trim($(block).text()).replace(/\n\r\n/g,'');return(offset==text.length)?!0:!1},isBlock:function(block)
{block=block[0]||block;return block&&this.utils.isBlockTag(block.tagName)},isBlockTag:function(tag)
{if(typeof tag=='undefined'){return!1}
return this.reIsBlock.test(tag)},isTag:function(current,tag)
{var element=$(current).closest(tag);if(element.size()==1)
{return element[0]}
return!1},isSelectAll:function()
{return this.selectAll},enableSelectAll:function()
{this.selectAll=!0},disableSelectAll:function()
{this.selectAll=!1},isRedactorParent:function(el)
{if(!el)
{return!1}
if($(el).parents('.redactor-editor').length===0||$(el).hasClass('redactor-editor'))
{return!1}
return el},isCurrentOrParent:function(tagName)
{var parent=this.selection.getParent();var current=this.selection.getCurrent();if($.isArray(tagName))
{var matched=0;$.each(tagName,$.proxy(function(i,s)
{if(this.utils.isCurrentOrParentOne(current,parent,s))
{matched++}},this));return(matched===0)?!1:!0}
else{return this.utils.isCurrentOrParentOne(current,parent,tagName)}},isCurrentOrParentOne:function(current,parent,tagName)
{return parent&&parent.tagName===tagName?parent:current&&current.tagName===tagName?current:!1},isOldIe:function()
{return(this.utils.browser('msie')&&parseInt(this.utils.browser('version'),10)<9)?!0:!1},isLessIe10:function()
{return(this.utils.browser('msie')&&parseInt(this.utils.browser('version'),10)<10)?!0:!1},isIe11:function()
{return!!navigator.userAgent.match(/Trident\/7\./)},browser:function(browser)
{var ua=navigator.userAgent.toLowerCase();var match=/(opr)[\/]([\w.]+)/.exec(ua)||/(chrome)[ \/]([\w.]+)/.exec(ua)||/(webkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(ua)||/(webkit)[ \/]([\w.]+)/.exec(ua)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(ua)||/(msie) ([\w.]+)/.exec(ua)||ua.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(ua)||ua.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(ua)||[];if(browser=='version'){return match[2]}
if(browser=='webkit'){return(match[1]=='chrome'||match[1]=='webkit')}
if(match[1]=='rv'){return browser=='msie'}
if(match[1]=='opr'){return browser=='webkit'}
return browser==match[1]}}}};Redactor.prototype.init.prototype=Redactor.prototype;$.Redactor.fn.formatLinkify=function(protocol,convertLinks,convertUrlLinks,convertImageLinks,convertVideoLinks,linkSize)
{var urlCheck='((?:http[s]?:\\/\\/(?:www\\.)?|www\\.){1}(?:[0-9A-Za-z\\-%_]+\\.)+[a-zA-Z]{2,}(?::[0-9]+)?(?:(?:/[0-9A-Za-z\\-\\.%\+_]*)+)?(?:\\?(?:[0-9A-Za-z\\-\\.%_]+(?:=[0-9A-Za-z\\-\\.%_\\+]*)?)?(?:&(?:[0-9A-Za-z\\-\\.%_]+(?:=[0-9A-Za-z\\-\\.%_\\+]*)?)?)*)?(?:#[0-9A-Za-z\\-\\.%_\\+=\\?&;]*)?)';var regex=new RegExp(urlCheck,'gi');var rProtocol=/(https?|ftp|tel):\/\//i;var urlImage=/(https?:\/\/.*\.(?:png|jpg|jpeg|gif))/gi;var childNodes=(this.$editor?this.$editor[0]:this).childNodes,i=childNodes.length;while(i--)
{var n=childNodes[i];if(n.nodeType===3)
{var html=n.nodeValue;if(convertVideoLinks&&html)
{var iframeStart='<iframe width="500" height="281" src="',iframeEnd='" frameborder="0" allowfullscreen></iframe>';if(html.match(reUrlYoutube))
{html=html.replace(reUrlYoutube,iframeStart+'//www.youtube.com/embed/$1'+iframeEnd);$(n).after(html).remove()}
else{if(html.match(reUrlVimeo))
{html=html.replace(reUrlVimeo,iframeStart+'//player.vimeo.com/video/$2'+iframeEnd);$(n).after(html).remove()}}}
if(convertImageLinks&&html&&html.match(urlImage))
{html=html.replace(urlImage,'<img src="$1" />');$(n).after(html).remove();return}
if(html.search(/\$/g)!=-1){html=html.replace(/\$/g,'&#36;')}
var matches=html.match(regex);if(convertUrlLinks&&html&&matches)
{var len=matches.length;for(var z=0;z<len;z++)
{if(matches[z].match(/\.$/)!==null){matches[z]=matches[z].replace(/\.$/,'')}
var href=matches[z];var text=href;var space='';if(href.match(/\s$/)!==null){space=' '}
var addProtocol=protocol+'://';if(href.match(rProtocol)!==null){addProtocol=''}
if(text.length>linkSize){text=text.substring(0,linkSize)+'...'}
text=text.replace(/&#36;/g,'$').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');html=html.replace(href,'<a href=\"'+addProtocol+$.trim(href)+'\">'+$.trim(text)+'</a>'+space)}
$(n).after(html).remove()}}
else{if(n.nodeType===1&&!/^(a|button|textarea)$/i.test(n.tagName))
{$.Redactor.fn.formatLinkify.call(n,protocol,convertLinks,convertUrlLinks,convertImageLinks,convertVideoLinks,linkSize)}}}}})(jQuery)